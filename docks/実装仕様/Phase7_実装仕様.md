# Phase 7 å®Ÿè£…ä»•æ§˜æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: LlmMultiChat3  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 7 - 3Då¯è¦–åŒ– + è‡ªå¾‹ã‚µãƒ¼ãƒ  
**æœŸé–“**: 4é€±é–“  
**ä½œæˆæ—¥**: 2025-11-20  
**Phase 6å®Œäº†å‰æ**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ãƒ»MCP Serverå®Ÿè£…æ¸ˆã¿

---

## ç›®æ¬¡

1. [Phase 7æ¦‚è¦](#1-phase-7æ¦‚è¦)
2. [å‰ææ¡ä»¶](#2-å‰ææ¡ä»¶)
3. [Week 1-2: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«](#3-week-1-2-3då¯è¦–åŒ–ãƒ‘ãƒãƒ«)
4. [Week 3-4: è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ](#4-week-3-4-è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ)
5. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#5-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
6. [ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆTDDå®Ÿè£…ï¼‰](#6-ãƒ†ã‚¹ãƒˆè¨ˆç”»tddå®Ÿè£…)
   - [TDDå®Ÿè£…ä»•æ§˜ã‚µãƒãƒªãƒ¼](#60-tddå®Ÿè£…ä»•æ§˜ã‚µãƒãƒªãƒ¼)
   - [ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™](#61-ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™)
   - [ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•](#62-ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•)
   - [Week 1-2: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ« - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰](#week-1-2-3då¯è¦–åŒ–ãƒ‘ãƒãƒ«---ãƒ†ã‚¹ãƒˆä»•æ§˜tdd)
   - [Week 3-4: è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰](#week-3-4-è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ---ãƒ†ã‚¹ãƒˆä»•æ§˜tdd)
   - [çµ±åˆãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰](#çµ±åˆãƒ†ã‚¹ãƒˆä»•æ§˜tdd)
   - [ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜](#ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜)
   - [ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥)
7. [æˆæœç‰©](#7-æˆæœç‰©)
8. [Phase 7æˆåŠŸåŸºæº–](#8-phase-7æˆåŠŸåŸºæº–)

---

## 1. Phase 7æ¦‚è¦

### 1.1 ç›®çš„

é€£æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®3Då¯è¦–åŒ–ã¨è‡ªå¾‹æƒ…å ±åé›†ã«ã‚ˆã‚Šã€**è¦–è¦šçš„ç†è§£ã¨çŸ¥è­˜ã®è‡ªå‹•æ‹¡å¼µ**ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### 1.2 TDDå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

Phase 7ã¯**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰**ã§å®Ÿè£…ã—ã¾ã™ã€‚å„æ©Ÿèƒ½ã¯ä»¥ä¸‹ã®ã‚µã‚¤ã‚¯ãƒ«ã§é–‹ç™ºã—ã¾ã™ï¼š

```
1. ğŸ”´ RED: ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆå¤±æ•—ã™ã‚‹ï¼‰
2. ğŸŸ¢ GREEN: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™
3. ğŸ”µ REFACTOR: ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆãƒ†ã‚¹ãƒˆã¯å¸¸ã«æˆåŠŸï¼‰
```

**TDDã®åŸå‰‡**:
- âœ… å®Ÿè£…å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- âœ… 1ã¤ã®ãƒ†ã‚¹ãƒˆ â†’ 1ã¤ã®å®Ÿè£… â†’ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«
- âœ… Given-When-Thenå½¢å¼ã§ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°
- âœ… å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… å¤–éƒ¨ä¾å­˜ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

### 1.3 ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | Priority |
|-------------|------|----------|
| **3Då¯è¦–åŒ–** | é€£æƒ³è¨˜æ†¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å¯è¦–åŒ– | ğŸŸ¡ Medium |
| **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ“ä½œ** | ãƒ‰ãƒ©ãƒƒã‚°ãƒ»ã‚ºãƒ¼ãƒ ãƒ»ã‚¯ãƒªãƒƒã‚¯ | ğŸŸ¡ Medium |
| **è‡ªå¾‹ã‚µãƒ¼ãƒ** | è‡ªå‹•Webæ¤œç´¢ãƒ»KBä¿å­˜ | ğŸ”´ High |
| **å®šæœŸæ›´æ–°** | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ | ğŸ”´ High |

### 1.3 é”æˆç›®æ¨™

âœ… 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«å‹•ä½œç¢ºèª  
âœ… è‡ªå¾‹ã‚µãƒ¼ãƒå®šæœŸå®Ÿè¡Œãƒ†ã‚¹ãƒˆæˆåŠŸ  
âœ… KBè‡ªå‹•æ›´æ–°ç¢ºèª  
âœ… Plotly.jsçµ±åˆå®Œäº†

---

## 2. å‰ææ¡ä»¶

### 2.1 Phase 1-6å®Œäº†äº‹é …

âœ… **Phase 1**: LangGraphã‚³ã‚¢ãƒ»5éšå±¤è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ   
âœ… **Phase 2**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£  
âœ… **Phase 3**: REST/WebSocket APIï¼ˆ23ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰  
âœ… **Phase 4**: é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ãƒ»æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«åŸºç›¤  
âœ… **Phase 5**: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œãƒ»è‡ªå·±çœå¯Ÿ  
âœ… **Phase 6**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ãƒ»MCP Server

**å‚ç…§**: [`docks/å®Ÿè£…ä»•æ§˜/Phase6_å®Ÿè£…ä»•æ§˜.md`](Phase6_å®Ÿè£…ä»•æ§˜.md:1)

### 2.2 åˆ©ç”¨å¯èƒ½ãªPhase 4æ©Ÿèƒ½

- **é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ **: [`memory/associative.py`](../../memory/associative.py)
- **SQLite Graph**: å†å¸°CTEé€£æƒ³æ¤œç´¢

---

## 3. Week 1-2: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«

### 3.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: [`docks/ä»•æ§˜æ›¸/06_ä¼šè©±LLM_3Då¯è¦–åŒ–ä»•æ§˜.md`](../ä»•æ§˜æ›¸/06_ä¼šè©±LLM_3Då¯è¦–åŒ–ä»•æ§˜.md)

#### 3.1.1 Plotly.js 3Dã‚°ãƒ©ãƒ•

**ä¸»è¦æ©Ÿèƒ½**:
1. **ãƒãƒ¼ãƒ‰æç”»**: æ¦‚å¿µã‚’çƒä½“ã§è¡¨ç¾
2. **ã‚¨ãƒƒã‚¸æç”»**: é–¢é€£æ€§ã‚’ç·šã§è¡¨ç¾
3. **Force-Directed Layout**: ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é…ç½®
4. **è‰²ãƒ»ã‚µã‚¤ã‚ºã«ã‚ˆã‚‹æƒ…å ±è¡¨ç¾**:
   - ãƒãƒ¼ãƒ‰è‰²: è·é›¢ï¼ˆé’â†’ç·‘â†’é»„â†’èµ¤ï¼‰
   - ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚º: æ´»æ€§åŒ–å›æ•°
   - ã‚¨ãƒƒã‚¸è‰²: é–¢é€£æ€§å¼·åº¦ï¼ˆè–„ç°â†’æ¿ƒç°ï¼‰

#### 3.1.2 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ“ä½œ

- **ãƒ‰ãƒ©ãƒƒã‚°å›è»¢**: ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°ã§3Dç©ºé–“å›è»¢
- **ãƒ›ã‚¤ãƒ¼ãƒ«ã‚ºãƒ¼ãƒ **: ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ 
- **ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯**: ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º

#### 3.1.3 ON/OFFåˆ‡ã‚Šæ›¿ãˆ

- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆOFF**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: ä¼šè©±ä¸­ã«è‡ªå‹•æ›´æ–°ï¼ˆONæ™‚ï¼‰

### 3.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### visualization/association_3d.py (500è¡Œ)

```python
"""é€£æƒ³è¨˜æ†¶3Då¯è¦–åŒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«."""

from typing import Dict, List, Any, Optional
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from memory.associative import AssociativeMemory


class AssociationVisualizationPanel:
    """é€£æƒ³è¨˜æ†¶3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«."""
    
    def __init__(self, associative_memory: AssociativeMemory):
        """
        åˆæœŸåŒ–.
        
        Args:
            associative_memory: é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        """
        self.associative_memory = associative_memory
        self.is_enabled = False
        self.current_center = None
        self.max_nodes = 50  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ¶é™
    
    def toggle(self) -> bool:
        """
        ON/OFFåˆ‡ã‚Šæ›¿ãˆ.
        
        Returns:
            bool: æ–°ã—ã„çŠ¶æ…‹ï¼ˆTrue=ON, False=OFFï¼‰
        """
        self.is_enabled = not self.is_enabled
        return self.is_enabled
    
    def update_center(self, concept: str) -> None:
        """
        ä¸­å¿ƒæ¦‚å¿µæ›´æ–°.
        
        Args:
            concept: ä¸­å¿ƒã¨ãªã‚‹æ¦‚å¿µ
        """
        self.current_center = concept
        if self.is_enabled:
            self._render_graph()
    
    def _render_graph(self) -> go.Figure:
        """
        3Dã‚°ãƒ©ãƒ•æç”».
        
        Returns:
            go.Figure: Plotly Figure
        """
        if not self.current_center:
            return go.Figure()
        
        # é€£æƒ³æ¦‚å¿µå–å¾—
        associated = self.associative_memory.retrieve_associated_concepts(
            trigger=self.current_center,
            depth=3,
            threshold=0.3
        )
        
        # æœ€å¤§ãƒãƒ¼ãƒ‰æ•°åˆ¶é™
        if len(associated) > self.max_nodes:
            associated = associated[:self.max_nodes]
        
        # ãƒãƒ¼ãƒ‰åº§æ¨™è¨ˆç®—ï¼ˆForce-Directed Layoutç°¡æ˜“ç‰ˆï¼‰
        node_positions = self._calculate_positions(associated)
        
        # ã‚¨ãƒƒã‚¸å–å¾—
        edges = self._get_edges(associated)
        
        # ãƒãƒ¼ãƒ‰ãƒˆãƒ¬ãƒ¼ã‚¹ä½œæˆ
        node_trace = self._create_node_trace(associated, node_positions)
        
        # ã‚¨ãƒƒã‚¸ãƒˆãƒ¬ãƒ¼ã‚¹ä½œæˆ
        edge_traces = self._create_edge_traces(edges, node_positions)
        
        # Figureä½œæˆ
        fig = go.Figure(data=edge_traces + [node_trace])
        
        fig.update_layout(
            title=f"é€£æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ - ä¸­å¿ƒ: {self.current_center}",
            showlegend=False,
            hovermode='closest',
            scene=dict(
                xaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
                yaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
                zaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
            ),
            margin=dict(l=0, r=0, b=0, t=40),
        )
        
        return fig
    
    def _calculate_positions(
        self,
        concepts: List[Dict[str, Any]]
    ) -> Dict[str, tuple]:
        """
        ãƒãƒ¼ãƒ‰åº§æ¨™è¨ˆç®—ï¼ˆForce-Directed Layoutç°¡æ˜“ç‰ˆï¼‰.
        
        Args:
            concepts: æ¦‚å¿µãƒªã‚¹ãƒˆ
        
        Returns:
            Dict[str, tuple]: {æ¦‚å¿µå: (x, y, z)}
        """
        import random
        import math
        
        positions = {}
        
        # ä¸­å¿ƒã‚’åŸç‚¹ã«é…ç½®
        positions[self.current_center] = (0.0, 0.0, 0.0)
        
        # ä»–ã®æ¦‚å¿µã‚’è·é›¢ã«å¿œã˜ã¦é…ç½®
        for concept in concepts:
            if concept['name'] == self.current_center:
                continue
            
            depth = concept.get('depth', 1)
            
            # çƒé¢åº§æ¨™ã§ãƒ©ãƒ³ãƒ€ãƒ é…ç½®
            theta = random.uniform(0, 2 * math.pi)
            phi = random.uniform(0, math.pi)
            radius = depth * 2.0  # è·é›¢ã«å¿œã˜ãŸåŠå¾„
            
            x = radius * math.sin(phi) * math.cos(theta)
            y = radius * math.sin(phi) * math.sin(theta)
            z = radius * math.cos(phi)
            
            positions[concept['name']] = (x, y, z)
        
        return positions
    
    def _get_edges(
        self,
        concepts: List[Dict[str, Any]]
    ) -> List[Dict[str, Any]]:
        """
        ã‚¨ãƒƒã‚¸å–å¾—.
        
        Args:
            concepts: æ¦‚å¿µãƒªã‚¹ãƒˆ
        
        Returns:
            List[Dict]: ã‚¨ãƒƒã‚¸ãƒªã‚¹ãƒˆ
        """
        edges = []
        
        # å„æ¦‚å¿µé–“ã®ã‚¨ãƒƒã‚¸ã‚’å–å¾—ï¼ˆå®Ÿéš›ã¯DBã‹ã‚‰å–å¾—ï¼‰
        concept_names = [c['name'] for c in concepts]
        
        # ç°¡æ˜“å®Ÿè£…: éš£æ¥æ¦‚å¿µã¨ã®ã¿æ¥ç¶š
        for i, concept in enumerate(concepts):
            if i == 0:
                continue
            edges.append({
                'from': self.current_center if concept.get('depth', 1) == 1 else concepts[i-1]['name'],
                'to': concept['name'],
                'strength': concept.get('strength', 0.5)
            })
        
        return edges
    
    def _create_node_trace(
        self,
        concepts: List[Dict[str, Any]],
        positions: Dict[str, tuple]
    ) -> go.Scatter3d:
        """
        ãƒãƒ¼ãƒ‰ãƒˆãƒ¬ãƒ¼ã‚¹ä½œæˆ.
        
        Args:
            concepts: æ¦‚å¿µãƒªã‚¹ãƒˆ
            positions: åº§æ¨™è¾æ›¸
        
        Returns:
            go.Scatter3d: ãƒãƒ¼ãƒ‰ãƒˆãƒ¬ãƒ¼ã‚¹
        """
        node_x, node_y, node_z = [], [], []
        node_text, node_color, node_size = [], [], []
        
        for concept in concepts:
            name = concept['name']
            if name not in positions:
                continue
            
            x, y, z = positions[name]
            node_x.append(x)
            node_y.append(y)
            node_z.append(z)
            
            node_text.append(name)
            node_color.append(self._get_node_color(concept.get('depth', 0)))
            node_size.append(10 + concept.get('activation_count', 0))
        
        return go.Scatter3d(
            x=node_x, y=node_y, z=node_z,
            mode='markers+text',
            text=node_text,
            textposition="top center",
            marker=dict(
                size=node_size,
                color=node_color,
                colorscale='Viridis',
                line=dict(color='white', width=0.5)
            ),
            hoverinfo='text'
        )
    
    def _create_edge_traces(
        self,
        edges: List[Dict[str, Any]],
        positions: Dict[str, tuple]
    ) -> List[go.Scatter3d]:
        """
        ã‚¨ãƒƒã‚¸ãƒˆãƒ¬ãƒ¼ã‚¹ä½œæˆ.
        
        Args:
            edges: ã‚¨ãƒƒã‚¸ãƒªã‚¹ãƒˆ
            positions: åº§æ¨™è¾æ›¸
        
        Returns:
            List[go.Scatter3d]: ã‚¨ãƒƒã‚¸ãƒˆãƒ¬ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ
        """
        edge_traces = []
        
        for edge in edges:
            from_name = edge['from']
            to_name = edge['to']
            
            if from_name not in positions or to_name not in positions:
                continue
            
            x0, y0, z0 = positions[from_name]
            x1, y1, z1 = positions[to_name]
            
            edge_trace = go.Scatter3d(
                x=[x0, x1, None],
                y=[y0, y1, None],
                z=[z0, z1, None],
                mode='lines',
                line=dict(
                    color=self._get_edge_color(edge['strength']),
                    width=2
                ),
                hoverinfo='none'
            )
            
            edge_traces.append(edge_trace)
        
        return edge_traces
    
    def _get_edge_color(self, strength: float) -> str:
        """
        ã‚¨ãƒƒã‚¸è‰²å–å¾—.
        
        Args:
            strength: é–¢é€£æ€§å¼·åº¦ (0.0-1.0)
        
        Returns:
            str: è‰²ã‚³ãƒ¼ãƒ‰
        """
        # è–„ç° â†’ æ¿ƒç°
        gray_value = int(200 - strength * 100)
        return f'rgb({gray_value}, {gray_value}, {gray_value})'
    
    def _get_node_color(self, distance: int) -> int:
        """
        ãƒãƒ¼ãƒ‰è‰²å–å¾—ï¼ˆè·é›¢ãƒ™ãƒ¼ã‚¹ï¼‰.
        
        Args:
            distance: ä¸­å¿ƒã‹ã‚‰ã®è·é›¢
        
        Returns:
            int: è‰²å€¤ï¼ˆ0-3ï¼‰
        """
        # 0=é’, 1=ç·‘, 2=é»„, 3=èµ¤
        return min(distance, 3)
    
    def export_html(self, filename: str) -> None:
        """
        HTMLå‡ºåŠ›.
        
        Args:
            filename: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å
        """
        fig = self._render_graph()
        fig.write_html(filename)
    
    def export_png(self, filename: str) -> None:
        """
        PNGå‡ºåŠ›.
        
        Args:
            filename: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å
        """
        fig = self._render_graph()
        fig.write_image(filename)


class VisualizationControls:
    """å¯è¦–åŒ–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«UI."""
    
    def render_controls(self) -> str:
        """
        ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«HTMLç”Ÿæˆ.
        
        Returns:
            str: HTMLæ–‡å­—åˆ—
        """
        return """
        <div id="viz-controls">
            <button onclick="toggleVisualization()">å¯è¦–åŒ– ON/OFF</button>
            <input type="text" id="center-concept" placeholder="ä¸­å¿ƒæ¦‚å¿µ">
            <button onclick="updateCenter()">æ›´æ–°</button>
        </div>
        """
```

### 3.3 ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

**æ³¨æ„**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å®Ÿè£…å‰ã®ãƒ†ã‚¹ãƒˆä»•æ§˜ã§ã™ã€‚å®Ÿè£…ã¯å¿…ãšãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§è¡Œã„ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

- `tests/test_visualization.py`: AssociationVisualizationPanelã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ30ä»¶ï¼‰
- `tests/test_integration_visualization.py`: é€£æƒ³è¨˜æ†¶é€£æºã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

#### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©

```python
# tests/fixtures/visualization_fixtures.py

TEST_CONCEPTS = [
    "æ©Ÿæ¢°å­¦ç¿’",
    "Python",
    "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "Webé–‹ç™º",
    "è‡ªç„¶è¨€èªå‡¦ç†"
]

TEST_CONCEPT_PAIRS = [
    ("æ©Ÿæ¢°å­¦ç¿’", "Python", 0.8),
    ("Python", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", 0.6),
    ("Webé–‹ç™º", "Python", 0.7),
]

TEST_DEPTHS = [1, 2, 3]
TEST_THRESHOLDS = [0.1, 0.3, 0.5, 0.7, 0.9]
TEST_MAX_NODES = [10, 50, 100, 1000]
```

---

## 4. Week 3-4: è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

### 4.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: [`docks/ä»•æ§˜æ›¸/01_ä¼šè©±LLM_ä»•æ§˜.md:531-561`](../ä»•æ§˜æ›¸/01_ä¼šè©±LLM_ä»•æ§˜.md:531)

#### 4.1.1 ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶åˆ¤å®š

**3ã¤ã®ãƒˆãƒªã‚¬ãƒ¼**:
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è³ªå•æ™‚**: KBæ¤œç´¢ã§å›ç­”ãªã—
2. **å®šæœŸå®Ÿè¡Œ**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
3. **æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ˜ç¤ºçš„æŒ‡ç¤º

#### 4.1.2 æ¤œç´¢ãƒ„ãƒ¼ãƒ«çµ±åˆ

```python
# 1. Serper APIï¼ˆGoogleæ¤œç´¢ï¼‰
{
    "url": "https://google.serper.dev/search",
    "headers": {"X-API-KEY": "YOUR_SERPER_API_KEY"},
    "params": {"q": "æœ€æ–°AIæŠ€è¡“", "gl": "jp", "hl": "ja"}
}

# 2. Wikipediaæ¤œç´¢
{
    "library": "wikipedia",
    "lang": "ja",
    "query": "æ©Ÿæ¢°å­¦ç¿’"
}
```

#### 4.1.3 å®šæœŸæ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©

| é »åº¦ | æ™‚åˆ» | ãƒˆãƒ”ãƒƒã‚¯ |
|------|------|---------|
| æ¯æ—¥ | 06:00 | ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ |
| æ¯é€±æ—¥æ›œ | 10:00 | æ˜ ç”»æƒ…å ± |
| æ¯æœˆ1æ—¥ | 00:00 | æŠ€è¡“æƒ…å ± |

### 4.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### agents/autonomous_search.py (350è¡Œ)

```python
"""è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ."""

from typing import Dict, List, Any, Optional
import requests
import wikipedia
from memory.knowledge_base import KnowledgeBase


class AutonomousSearchAgent:
    """è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ."""
    
    def __init__(self, serper_api_key: Optional[str] = None):
        """
        åˆæœŸåŒ–.
        
        Args:
            serper_api_key: Serper API KEY
        """
        self.serper_api_key = serper_api_key
        self.kb = KnowledgeBase()
        wikipedia.set_lang("ja")
    
    def should_search(
        self,
        user_question: str,
        kb_results: List[Dict[str, Any]]
    ) -> bool:
        """
        æ¤œç´¢å¿…è¦æ€§åˆ¤å®š.
        
        Args:
            user_question: ãƒ¦ãƒ¼ã‚¶ãƒ¼è³ªå•
            kb_results: KBæ¤œç´¢çµæœ
        
        Returns:
            bool: True=æ¤œç´¢å®Ÿè¡Œ
        """
        # KBçµæœãªã— ã¾ãŸã¯ ä¿¡é ¼åº¦ä½ã„
        if not kb_results:
            return True
        
        if kb_results[0].get('similarity', 0.0) < 0.6:
            return True
        
        return False
    
    def web_search(self, query: str, max_results: int = 5) -> List[Dict[str, Any]]:
        """
        Webæ¤œç´¢ï¼ˆSerper APIï¼‰.
        
        Args:
            query: æ¤œç´¢ã‚¯ã‚¨ãƒª
            max_results: æœ€å¤§çµæœæ•°
        
        Returns:
            List[Dict]: æ¤œç´¢çµæœ
        """
        if not self.serper_api_key:
            return []
        
        url = "https://google.serper.dev/search"
        headers = {
            "X-API-KEY": self.serper_api_key,
            "Content-Type": "application/json"
        }
        payload = {
            "q": query,
            "gl": "jp",
            "hl": "ja",
            "num": max_results
        }
        
        try:
            response = requests.post(url, json=payload, headers=headers, timeout=10)
            response.raise_for_status()
            
            data = response.json()
            results = []
            
            for item in data.get("organic", [])[:max_results]:
                results.append({
                    "title": item.get("title"),
                    "snippet": item.get("snippet"),
                    "link": item.get("link")
                })
            
            return results
        
        except requests.RequestException as e:
            print(f"Webæ¤œç´¢ã‚¨ãƒ©ãƒ¼: {e}")
            return []
    
    def wikipedia_search(self, query: str) -> Optional[Dict[str, Any]]:
        """
        Wikipediaæ¤œç´¢.
        
        Args:
            query: æ¤œç´¢ã‚¯ã‚¨ãƒª
        
        Returns:
            Optional[Dict]: Wikipediaè¨˜äº‹
        """
        try:
            page = wikipedia.page(query, auto_suggest=True)
            
            return {
                "title": page.title,
                "summary": wikipedia.summary(query, sentences=3),
                "content": page.content,
                "url": page.url
            }
        
        except wikipedia.exceptions.PageError:
            print(f"Wikipediaè¨˜äº‹ãªã—: {query}")
            return None
        
        except wikipedia.exceptions.DisambiguationError as e:
            print(f"æ›–æ˜§æ€§è§£æ¶ˆå¿…è¦: {e.options[:3]}")
            # æœ€åˆã®å€™è£œã§å†è©¦è¡Œ
            if e.options:
                return self.wikipedia_search(e.options[0])
            return None
    
    def save_to_kb(
        self,
        content: str,
        category: str,
        source: str = "autonomous_search"
    ) -> None:
        """
        KBä¿å­˜.
        
        Args:
            content: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            category: ã‚«ãƒ†ã‚´ãƒª
            source: ã‚½ãƒ¼ã‚¹
        """
        self.kb.store(
            content=content,
            category=category,
            metadata={"source": source}
        )
```

#### scheduler/update_scheduler.py (200è¡Œ)

```python
"""å®šæœŸæ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©."""

from typing import Callable
import schedule
import time
from agents.autonomous_search import AutonomousSearchAgent


class UpdateScheduler:
    """å®šæœŸæ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©."""
    
    def __init__(self, search_agent: AutonomousSearchAgent):
        """
        åˆæœŸåŒ–.
        
        Args:
            search_agent: ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
        """
        self.search_agent = search_agent
    
    def schedule_daily_news(self) -> None:
        """æ¯æœ6æ™‚: ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰."""
        schedule.every().day.at("06:00").do(self._fetch_news)
    
    def schedule_weekly_movies(self) -> None:
        """æ¯é€±æ—¥æ›œ10æ™‚: æ˜ ç”»æƒ…å ±."""
        schedule.every().sunday.at("10:00").do(self._fetch_movies)
    
    def schedule_monthly_tech(self) -> None:
        """æ¯æœˆ1æ—¥0æ™‚: æŠ€è¡“æƒ…å ±."""
        schedule.every().month.at("00:00").do(self._fetch_tech)
    
    def _fetch_news(self) -> None:
        """ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—."""
        results = self.search_agent.web_search("æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹", max_results=5)
        
        for result in results:
            self.search_agent.save_to_kb(
                content=f"{result['title']}: {result['snippet']}",
                category="news"
            )
    
    def _fetch_movies(self) -> None:
        """æ˜ ç”»æƒ…å ±å–å¾—."""
        results = self.search_agent.web_search("ä»Šé€±å…¬é–‹æ˜ ç”»", max_results=3)
        
        for result in results:
            self.search_agent.save_to_kb(
                content=f"{result['title']}: {result['snippet']}",
                category="movies"
            )
    
    def _fetch_tech(self) -> None:
        """æŠ€è¡“æƒ…å ±å–å¾—."""
        topics = ["Pythonæœ€æ–°æƒ…å ±", "æ©Ÿæ¢°å­¦ç¿’ãƒˆãƒ¬ãƒ³ãƒ‰", "Webé–‹ç™ºæŠ€è¡“"]
        
        for topic in topics:
            wiki = self.search_agent.wikipedia_search(topic)
            if wiki:
                self.search_agent.save_to_kb(
                    content=wiki['summary'],
                    category="tech"
                )
    
    def run(self) -> None:
        """ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å®Ÿè¡Œ."""
        while True:
            schedule.run_pending()
            time.sleep(60)
```

### 4.3 ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

**æ³¨æ„**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å®Ÿè£…å‰ã®ãƒ†ã‚¹ãƒˆä»•æ§˜ã§ã™ã€‚å®Ÿè£…ã¯å¿…ãšãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§è¡Œã„ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

- `tests/test_autonomous_search.py`: AutonomousSearchAgentã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ30ä»¶ï¼‰
- `tests/test_scheduler.py`: UpdateSchedulerã‚¯ãƒ©ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰
- `tests/test_integration_search.py`: KBé€£æºãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

#### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©

```python
# tests/fixtures/autonomous_search_fixtures.py

TEST_QUERIES = [
    "æ©Ÿæ¢°å­¦ç¿’",
    "Python",
    "æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹",
    "",  # ç©ºã‚¯ã‚¨ãƒªï¼ˆã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼‰
    "a" * 1000,  # é•·ã„ã‚¯ã‚¨ãƒªï¼ˆã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼‰
]

TEST_KB_RESULTS = [
    [],  # ç©ºã®çµæœ
    [{"similarity": 0.5}],  # ä½ä¿¡é ¼åº¦
    [{"similarity": 0.6}],  # å¢ƒç•Œå€¤
    [{"similarity": 0.9}],  # é«˜ä¿¡é ¼åº¦
]

TEST_MAX_RESULTS = [1, 5, 10, 0, -1, 1000]  # æ­£å¸¸å€¤ã¨ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹

TEST_CATEGORIES = ["news", "movies", "tech", "general"]
TEST_SOURCES = ["autonomous_search", "manual", "scheduled"]
```

---

## 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 5.1 Pythonä¾å­˜

```txt
# requirements.txt ã«è¿½åŠ 
plotly==5.17.0          # 3Då¯è¦–åŒ–
kaleido==0.2.1          # ç”»åƒå‡ºåŠ›
wikipedia==1.4.0        # Wikipediaæ¤œç´¢
requests==2.31.0        # HTTPé€šä¿¡
schedule==1.2.0         # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
```

### 5.2 æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- **visualization/association_3d.py**: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«
- **agents/autonomous_search.py**: è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- **scheduler/update_scheduler.py**: å®šæœŸæ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©

---

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆTDDå®Ÿè£…ï¼‰

### 6.0 TDDå®Ÿè£…ä»•æ§˜ã‚µãƒãƒªãƒ¼

**Phase 7ã¯å®Œå…¨ãªTDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å®Ÿè£…ã—ã¾ã™ã€‚**

#### TDDå®Ÿè£…ã®åŸå‰‡

1. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã™ã¹ã¦ã®æ©Ÿèƒ½ã¯å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **RED-GREEN-REFACTORã‚µã‚¤ã‚¯ãƒ«**: å¤±æ•—â†’æˆåŠŸâ†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å¾¹åº•
3. **Given-When-Thenå½¢å¼**: ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’æ˜ç¢ºãªå½¢å¼ã§è¨˜è¿°
4. **ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
5. **ãƒ¢ãƒƒã‚¯åˆ†é›¢**: å¤–éƒ¨ä¾å­˜ï¼ˆAPIã€Wikipediaç­‰ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

#### ãƒ†ã‚¹ãƒˆæ§‹æˆ

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ | å„ªå…ˆåº¦ |
|---------|--------------|---------|--------------|--------|
| **3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«** |
| AssociationVisualizationPanel | `test_visualization.py` | 30ä»¶ + ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹10ä»¶ + ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–5ä»¶ | 90%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ** |
| AutonomousSearchAgent | `test_autonomous_search.py` | 30ä»¶ + ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹10ä»¶ + ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–5ä»¶ | 90%ä»¥ä¸Š | ğŸ”´ High |
| UpdateScheduler | `test_scheduler.py` | 15ä»¶ + ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹5ä»¶ | 85%ä»¥ä¸Š | ğŸ”´ High |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** |
| é€£æƒ³è¨˜æ†¶é€£æº | `test_integration_visualization.py` | 10ä»¶ | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| KBé€£æºãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© | `test_integration_search.py` | 10ä»¶ | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **åˆè¨ˆ** | **5ãƒ•ã‚¡ã‚¤ãƒ« + ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£2ãƒ•ã‚¡ã‚¤ãƒ«** | **120ä»¶ä»¥ä¸Š** | **å¹³å‡88%ä»¥ä¸Š** | - |

#### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥

- **Week 1-2**: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«ï¼ˆ6æ—¥é–“ã§æ®µéšçš„ã«å®Ÿè£…ï¼‰
- **Week 3-4**: è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ6æ—¥é–“ã§æ®µéšçš„ã«å®Ÿè£…ï¼‰
- **å„æ©Ÿèƒ½**: RED â†’ GREEN â†’ REFACTORã‚µã‚¤ã‚¯ãƒ«ã§å®Ÿè£…
- **å“è³ªåŸºæº–**: ãƒ†ã‚¹ãƒˆæˆåŠŸç‡100%ã€ã‚«ãƒãƒ¬ãƒƒã‚¸88%ä»¥ä¸Šã€å®Ÿè¡Œæ™‚é–“5åˆ†ä»¥å†…

### 6.1 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ | å„ªå…ˆåº¦ |
|---------|---------|---------|--------------|--------|
| **3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«** |
| AssociationVisualizationPanel | `test_visualization.py` | 45ä»¶ | 90%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ** |
| AutonomousSearchAgent | `test_autonomous_search.py` | 45ä»¶ | 90%ä»¥ä¸Š | ğŸ”´ High |
| UpdateScheduler | `test_scheduler.py` | 20ä»¶ | 85%ä»¥ä¸Š | ğŸ”´ High |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** |
| é€£æƒ³è¨˜æ†¶é€£æº | `test_integration_visualization.py` | 10ä»¶ | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| KBé€£æºãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ© | `test_integration_search.py` | 10ä»¶ | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **åˆè¨ˆ** | **5ãƒ•ã‚¡ã‚¤ãƒ«** | **130ä»¶ä»¥ä¸Š** | **å¹³å‡88%ä»¥ä¸Š** | - |

### 6.2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

#### åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/test_visualization.py tests/test_autonomous_search.py tests/test_scheduler.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ \
  --cov=visualization.association_3d \
  --cov=agents.autonomous_search \
  --cov=scheduler.update_scheduler \
  --cov-report=html \
  --cov-report=term-missing \
  --cov-fail-under=88

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿
pytest tests/test_visualization.py::test_panel_init -v

# ãƒãƒ¼ã‚«ãƒ¼ã§å®Ÿè¡Œ
pytest -m unit -v              # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
pytest -m integration -v      # çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
pytest -m slow -v             # é…ã„ãƒ†ã‚¹ãƒˆã®ã¿ï¼ˆAPIå‘¼ã³å‡ºã—ãªã©ï¼‰
pytest -m "not slow" -v       # é…ã„ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–
```

#### TDDã‚µã‚¤ã‚¯ãƒ«ã§ã®å®Ÿè¡Œ

```bash
# 1. ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸå¾Œï¼ˆREDï¼‰
pytest tests/test_visualization.py::test_panel_init -v
# â†’ æœŸå¾…: FAILEDï¼ˆå®Ÿè£…å‰ï¼‰

# 2. æœ€å°é™ã®å®Ÿè£…å¾Œï¼ˆGREENï¼‰
pytest tests/test_visualization.py::test_panel_init -v
# â†’ æœŸå¾…: PASSED

# 3. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œï¼ˆREFACTORï¼‰
pytest tests/test_visualization.py -v
# â†’ æœŸå¾…: å…¨ãƒ†ã‚¹ãƒˆ PASSED
```

---

## Week 1-2: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ« - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_visualization.py`

**ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹**: `TestAssociationVisualizationPanel`, `TestVisualizationControls`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ45ä»¶ï¼‰**:

#### 1. åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_panel_init_default_state():
    """
    Given: AssociativeMemoryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    When: AssociationVisualizationPanelã‚’åˆæœŸåŒ–
    Then: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ï¼ˆis_enabled=False, current_center=Noneï¼‰
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    assert panel.is_enabled is False
    assert panel.current_center is None
    assert panel.max_nodes == 50
    assert panel.associative_memory is memory

def test_panel_init_with_custom_max_nodes():
    """
    Given: ã‚«ã‚¹ã‚¿ãƒ max_nodeså€¤
    When: AssociationVisualizationPanelã‚’åˆæœŸåŒ–
    Then: max_nodesãŒè¨­å®šã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.max_nodes = 100
    
    assert panel.max_nodes == 100

def test_panel_init_with_none_memory():
    """
    Given: Noneã®AssociativeMemory
    When: AssociationVisualizationPanelã‚’åˆæœŸåŒ–
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
    """
    with pytest.raises((TypeError, ValueError)):
        AssociationVisualizationPanel(None)
```

#### 2. ON/OFFåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_toggle_from_off_to_on():
    """
    Given: ãƒ‘ãƒãƒ«ãŒOFFçŠ¶æ…‹
    When: toggle()ã‚’å‘¼ã³å‡ºã™
    Then: ONçŠ¶æ…‹ã«ãªã‚Šã€TrueãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    result = panel.toggle()
    
    assert result is True
    assert panel.is_enabled is True

def test_toggle_from_on_to_off():
    """
    Given: ãƒ‘ãƒãƒ«ãŒONçŠ¶æ…‹
    When: toggle()ã‚’å‘¼ã³å‡ºã™
    Then: OFFçŠ¶æ…‹ã«ãªã‚Šã€FalseãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.is_enabled = True
    
    result = panel.toggle()
    
    assert result is False
    assert panel.is_enabled is False

def test_toggle_multiple_times():
    """
    Given: ãƒ‘ãƒãƒ«
    When: toggle()ã‚’è¤‡æ•°å›å‘¼ã³å‡ºã™
    Then: çŠ¶æ…‹ãŒäº¤äº’ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    assert panel.toggle() is True
    assert panel.toggle() is False
    assert panel.toggle() is True
    assert panel.toggle() is False
```

#### 3. ä¸­å¿ƒæ¦‚å¿µæ›´æ–°ãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_update_center_sets_center():
    """
    Given: æ¦‚å¿µå
    When: update_center()ã‚’å‘¼ã³å‡ºã™
    Then: current_centerãŒè¨­å®šã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    panel.update_center("æ©Ÿæ¢°å­¦ç¿’")
    
    assert panel.current_center == "æ©Ÿæ¢°å­¦ç¿’"

def test_update_center_triggers_render_when_enabled():
    """
    Given: ãƒ‘ãƒãƒ«ãŒONçŠ¶æ…‹
    When: update_center()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.is_enabled = True
    
    # ãƒ¢ãƒƒã‚¯ã§_render_graphãŒå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    with patch.object(panel, '_render_graph') as mock_render:
        panel.update_center("æ©Ÿæ¢°å­¦ç¿’")
        mock_render.assert_called_once()

def test_update_center_empty_concept():
    """
    Given: ç©ºã®æ¦‚å¿µå
    When: update_center()ã‚’å‘¼ã³å‡ºã™
    Then: current_centerãŒç©ºæ–‡å­—åˆ—ã«è¨­å®šã•ã‚Œã‚‹ï¼ˆã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ï¼‰
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    panel.update_center("")
    
    assert panel.current_center == ""
```

#### 4. ã‚°ãƒ©ãƒ•æç”»ãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

```python
def test_render_graph_with_no_center():
    """
    Given: current_centerãŒNone
    When: _render_graph()ã‚’å‘¼ã³å‡ºã™
    Then: ç©ºã®FigureãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    fig = panel._render_graph()
    
    assert fig is not None
    assert len(fig.data) == 0

def test_render_graph_with_concepts():
    """
    Given: æ¦‚å¿µãŒå­˜åœ¨ã™ã‚‹
    When: _render_graph()ã‚’å‘¼ã³å‡ºã™
    Then: ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’å«ã‚€FigureãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    # æ¦‚å¿µè¿½åŠ 
    memory.add_concept("æ©Ÿæ¢°å­¦ç¿’", embedding=[0.1]*128, metadata={})
    memory.add_concept("Python", embedding=[0.2]*128, metadata={})
    memory.link_concepts("æ©Ÿæ¢°å­¦ç¿’", "Python", "related", strength=0.8)
    
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    fig = panel._render_graph()
    
    assert fig is not None
    assert len(fig.data) > 0

def test_render_graph_max_nodes_limit():
    """
    Given: max_nodesã‚’è¶…ãˆã‚‹æ¦‚å¿µæ•°
    When: _render_graph()ã‚’å‘¼ã³å‡ºã™
    Then: max_nodesæ•°ã¾ã§ã«åˆ¶é™ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.max_nodes = 5
    
    # 10å€‹ã®æ¦‚å¿µã‚’è¿½åŠ 
    for i in range(10):
        memory.add_concept(f"æ¦‚å¿µ{i}", embedding=[0.1]*128, metadata={})
    
    panel.current_center = "æ¦‚å¿µ0"
    
    with patch.object(memory, 'retrieve_associated_concepts') as mock_retrieve:
        mock_retrieve.return_value = [{"name": f"æ¦‚å¿µ{i}"} for i in range(10)]
        fig = panel._render_graph()
        
        # max_nodesã¾ã§ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        # å®Ÿéš›ã®å®Ÿè£…ã«å¿œã˜ã¦æ¤œè¨¼
```

#### 5. åº§æ¨™è¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_calculate_positions_center_at_origin():
    """
    Given: ä¸­å¿ƒæ¦‚å¿µ
    When: _calculate_positions()ã‚’å‘¼ã³å‡ºã™
    Then: ä¸­å¿ƒãŒåŸç‚¹(0,0,0)ã«é…ç½®ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    concepts = [{"name": "æ©Ÿæ¢°å­¦ç¿’"}]
    positions = panel._calculate_positions(concepts)
    
    assert positions["æ©Ÿæ¢°å­¦ç¿’"] == (0.0, 0.0, 0.0)

def test_calculate_positions_depth_based_radius():
    """
    Given: ç•°ãªã‚‹depthã®æ¦‚å¿µ
    When: _calculate_positions()ã‚’å‘¼ã³å‡ºã™
    Then: depthã«å¿œã˜ãŸåŠå¾„ã§é…ç½®ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    concepts = [
        {"name": "æ©Ÿæ¢°å­¦ç¿’", "depth": 0},
        {"name": "Python", "depth": 1},
        {"name": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "depth": 2}
    ]
    positions = panel._calculate_positions(concepts)
    
    # depth=1ã®æ¦‚å¿µã¯åŠå¾„2.0ã€depth=2ã®æ¦‚å¿µã¯åŠå¾„4.0ã®ç¯„å›²å†…
    # å®Ÿéš›ã®åº§æ¨™å€¤ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªã®ã§ã€ç¯„å›²ãƒã‚§ãƒƒã‚¯
    assert "Python" in positions
    assert "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" in positions
```

#### 6. ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ä½œæˆãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰

```python
def test_create_node_trace_with_concepts():
    """
    Given: æ¦‚å¿µãƒªã‚¹ãƒˆã¨åº§æ¨™
    When: _create_node_trace()ã‚’å‘¼ã³å‡ºã™
    Then: Scatter3dãƒˆãƒ¬ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    concepts = [
        {"name": "æ©Ÿæ¢°å­¦ç¿’", "depth": 0, "activation_count": 5}
    ]
    positions = {"æ©Ÿæ¢°å­¦ç¿’": (0.0, 0.0, 0.0)}
    
    trace = panel._create_node_trace(concepts, positions)
    
    assert isinstance(trace, go.Scatter3d)
    assert len(trace.x) == 1

def test_create_edge_traces_with_edges():
    """
    Given: ã‚¨ãƒƒã‚¸ãƒªã‚¹ãƒˆã¨åº§æ¨™
    When: _create_edge_traces()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚¨ãƒƒã‚¸ãƒˆãƒ¬ãƒ¼ã‚¹ãƒªã‚¹ãƒˆãŒä½œæˆã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    edges = [
        {"from": "æ©Ÿæ¢°å­¦ç¿’", "to": "Python", "strength": 0.8}
    ]
    positions = {
        "æ©Ÿæ¢°å­¦ç¿’": (0.0, 0.0, 0.0),
        "Python": (1.0, 1.0, 1.0)
    }
    
    traces = panel._create_edge_traces(edges, positions)
    
    assert len(traces) == 1
    assert isinstance(traces[0], go.Scatter3d)
```

#### 7. è‰²ãƒ»ã‚µã‚¤ã‚ºè¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_get_node_color_by_distance():
    """
    Given: ç•°ãªã‚‹è·é›¢
    When: _get_node_color()ã‚’å‘¼ã³å‡ºã™
    Then: è·é›¢ã«å¿œã˜ãŸè‰²å€¤ãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    assert panel._get_node_color(0) == 0  # é’
    assert panel._get_node_color(1) == 1  # ç·‘
    assert panel._get_node_color(2) == 2  # é»„
    assert panel._get_node_color(3) == 3  # èµ¤
    assert panel._get_node_color(10) == 3  # ä¸Šé™

def test_get_edge_color_by_strength():
    """
    Given: ç•°ãªã‚‹å¼·åº¦
    When: _get_edge_color()ã‚’å‘¼ã³å‡ºã™
    Then: å¼·åº¦ã«å¿œã˜ãŸè‰²ã‚³ãƒ¼ãƒ‰ãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    color1 = panel._get_edge_color(0.0)  # è–„ç°
    color2 = panel._get_edge_color(1.0)  # æ¿ƒç°
    
    assert color1 != color2
    assert "rgb" in color1
```

#### 8. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆï¼ˆ2ä»¶ï¼‰

```python
def test_export_html():
    """
    Given: ã‚°ãƒ©ãƒ•ãŒæç”»å¯èƒ½
    When: export_html()ã‚’å‘¼ã³å‡ºã™
    Then: HTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹
    """
    import tempfile
    import os
    
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    with tempfile.NamedTemporaryFile(suffix='.html', delete=False) as tmp:
        filename = tmp.name
    
    try:
        panel.export_html(filename)
        assert os.path.exists(filename)
    finally:
        if os.path.exists(filename):
            os.remove(filename)

def test_export_png():
    """
    Given: ã‚°ãƒ©ãƒ•ãŒæç”»å¯èƒ½
    When: export_png()ã‚’å‘¼ã³å‡ºã™
    Then: PNGãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹
    """
    import tempfile
    import os
    
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    with tempfile.NamedTemporaryFile(suffix='.png', delete=False) as tmp:
        filename = tmp.name
    
    try:
        panel.export_png(filename)
        assert os.path.exists(filename)
    finally:
        if os.path.exists(filename):
            os.remove(filename)
```

#### 9. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ : 10ä»¶ï¼‰

```python
def test_render_graph_with_empty_concepts():
    """
    Given: ç©ºã®æ¦‚å¿µãƒªã‚¹ãƒˆ
    When: _render_graph()ã‚’å‘¼ã³å‡ºã™
    Then: ç©ºã®FigureãŒè¿”ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    with patch.object(memory, 'retrieve_associated_concepts', return_value=[]):
        fig = panel._render_graph()
        assert fig is not None

def test_calculate_positions_with_duplicate_concepts():
    """
    Given: é‡è¤‡ã™ã‚‹æ¦‚å¿µå
    When: _calculate_positions()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ï¼ˆã¾ãŸã¯é‡è¤‡ãŒå‡¦ç†ã•ã‚Œã‚‹ï¼‰
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    concepts = [
        {"name": "æ©Ÿæ¢°å­¦ç¿’"},
        {"name": "æ©Ÿæ¢°å­¦ç¿’"}  # é‡è¤‡
    ]
    
    positions = panel._calculate_positions(concepts)
    # é‡è¤‡å‡¦ç†ã®å®Ÿè£…ã«å¿œã˜ã¦æ¤œè¨¼
```

#### 10. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ : 5ä»¶ï¼‰

```python
@pytest.mark.parametrize("concept", ["æ©Ÿæ¢°å­¦ç¿’", "Python", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹"])
def test_update_center_various_concepts(concept):
    """
    Given: æ§˜ã€…ãªæ¦‚å¿µå
    When: update_center()ã‚’å‘¼ã³å‡ºã™
    Then: ã™ã¹ã¦ã®æ¦‚å¿µåãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    panel.update_center(concept)
    
    assert panel.current_center == concept

@pytest.mark.parametrize("max_nodes", [10, 50, 100, 1000])
def test_render_graph_various_max_nodes(max_nodes):
    """
    Given: æ§˜ã€…ãªmax_nodeså€¤
    When: _render_graph()ã‚’å‘¼ã³å‡ºã™
    Then: max_nodesæ•°ã¾ã§ã«åˆ¶é™ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    panel.max_nodes = max_nodes
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    
    # å®Ÿè£…ã«å¿œã˜ã¦æ¤œè¨¼
```

---

## Week 3-4: è‡ªå¾‹çš„å¤–éƒ¨ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_autonomous_search.py`

**ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹**: `TestAutonomousSearchAgent`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ45ä»¶ï¼‰**:

#### 1. åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆ3ä»¶ï¼‰

```python
def test_agent_init_without_api_key():
    """
    Given: APIã‚­ãƒ¼ãªã—
    When: AutonomousSearchAgentã‚’åˆæœŸåŒ–
    Then: serper_api_keyãŒNoneã§åˆæœŸåŒ–ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    assert agent.serper_api_key is None
    assert agent.kb is not None

def test_agent_init_with_api_key():
    """
    Given: APIã‚­ãƒ¼
    When: AutonomousSearchAgentã‚’åˆæœŸåŒ–
    Then: serper_api_keyãŒè¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    assert agent.serper_api_key == "test_key"

def test_agent_init_wikipedia_lang_set():
    """
    Given: AutonomousSearchAgent
    When: åˆæœŸåŒ–
    Then: Wikipediaã®è¨€èªãŒæ—¥æœ¬èªã«è¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    import wikipedia
    assert wikipedia.language == "ja"
```

#### 2. æ¤œç´¢åˆ¤å®šãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰

```python
def test_should_search_no_kb_results():
    """
    Given: KBæ¤œç´¢çµæœãŒç©º
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: TrueãŒè¿”ã•ã‚Œã‚‹ï¼ˆæ¤œç´¢å®Ÿè¡Œï¼‰
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("è³ªå•", [])
    
    assert result is True

def test_should_search_low_similarity():
    """
    Given: ä¿¡é ¼åº¦ãŒ0.6æœªæº€
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: TrueãŒè¿”ã•ã‚Œã‚‹ï¼ˆæ¤œç´¢å®Ÿè¡Œï¼‰
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("è³ªå•", [{"similarity": 0.5}])
    
    assert result is True

def test_should_search_threshold_boundary():
    """
    Given: ä¿¡é ¼åº¦ãŒ0.6ï¼ˆå¢ƒç•Œå€¤ï¼‰
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: FalseãŒè¿”ã•ã‚Œã‚‹ï¼ˆæ¤œç´¢ä¸è¦ï¼‰
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("è³ªå•", [{"similarity": 0.6}])
    
    assert result is False

def test_should_search_high_similarity():
    """
    Given: ä¿¡é ¼åº¦ãŒ0.6ä»¥ä¸Š
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: FalseãŒè¿”ã•ã‚Œã‚‹ï¼ˆæ¤œç´¢ä¸è¦ï¼‰
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("è³ªå•", [{"similarity": 0.9}])
    
    assert result is False

def test_should_search_empty_question():
    """
    Given: ç©ºã®è³ªå•
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("", [])
    
    assert isinstance(result, bool)
```

#### 3. Webæ¤œç´¢ãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

```python
def test_web_search_without_api_key():
    """
    Given: APIã‚­ãƒ¼ãªã—
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: ç©ºã®ãƒªã‚¹ãƒˆãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    results = agent.web_search("test query")
    
    assert results == []

@pytest.mark.asyncio
async def test_web_search_success():
    """
    Given: æœ‰åŠ¹ãªAPIã‚­ãƒ¼ã¨ã‚¯ã‚¨ãƒª
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: æ¤œç´¢çµæœãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    with patch('requests.post') as mock_post:
        mock_response = Mock()
        mock_response.json.return_value = {
            "organic": [
                {"title": "çµæœ1", "snippet": "èª¬æ˜1", "link": "http://example.com/1"},
                {"title": "çµæœ2", "snippet": "èª¬æ˜2", "link": "http://example.com/2"}
            ]
        }
        mock_response.raise_for_status = Mock()
        mock_post.return_value = mock_response
        
        results = agent.web_search("test query", max_results=5)
        
        assert len(results) == 2
        assert results[0]["title"] == "çµæœ1"

def test_web_search_max_results_limit():
    """
    Given: max_resultsãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: æŒ‡å®šã•ã‚ŒãŸä»¶æ•°ã¾ã§ã«åˆ¶é™ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    with patch('requests.post') as mock_post:
        mock_response = Mock()
        mock_response.json.return_value = {
            "organic": [{"title": f"çµæœ{i}"} for i in range(10)]
        }
        mock_response.raise_for_status = Mock()
        mock_post.return_value = mock_response
        
        results = agent.web_search("test", max_results=3)
        
        assert len(results) == 3

def test_web_search_request_exception():
    """
    Given: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: ç©ºã®ãƒªã‚¹ãƒˆãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    with patch('requests.post', side_effect=requests.RequestException("Error")):
        results = agent.web_search("test query")
        
        assert results == []
```

#### 4. Wikipediaæ¤œç´¢ãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

```python
def test_wikipedia_search_success():
    """
    Given: æœ‰åŠ¹ãªã‚¯ã‚¨ãƒª
    When: wikipedia_search()ã‚’å‘¼ã³å‡ºã™
    Then: Wikipediaè¨˜äº‹ãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch('wikipedia.page') as mock_page:
        mock_page_instance = Mock()
        mock_page_instance.title = "Python"
        mock_page_instance.url = "https://ja.wikipedia.org/wiki/Python"
        mock_page.return_value = mock_page_instance
        
        with patch('wikipedia.summary', return_value="Pythonã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã™"):
            result = agent.wikipedia_search("Python")
            
            assert result is not None
            assert result["title"] == "Python"
            assert "summary" in result

def test_wikipedia_search_page_error():
    """
    Given: å­˜åœ¨ã—ãªã„ãƒšãƒ¼ã‚¸
    When: wikipedia_search()ã‚’å‘¼ã³å‡ºã™
    Then: NoneãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch('wikipedia.page', side_effect=wikipedia.exceptions.PageError("Page not found")):
        result = agent.wikipedia_search("å­˜åœ¨ã—ãªã„ãƒšãƒ¼ã‚¸")
        
        assert result is None

def test_wikipedia_search_disambiguation():
    """
    Given: æ›–æ˜§æ€§è§£æ¶ˆãŒå¿…è¦ãªã‚¯ã‚¨ãƒª
    When: wikipedia_search()ã‚’å‘¼ã³å‡ºã™
    Then: æœ€åˆã®å€™è£œã§å†è©¦è¡Œã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch('wikipedia.page') as mock_page:
        # æœ€åˆã®å‘¼ã³å‡ºã—ã§DisambiguationError
        mock_page.side_effect = [
            wikipedia.exceptions.DisambiguationError("æ›–æ˜§", ["Python (è¨€èª)", "Python (è›‡)"]),
            Mock(title="Python (è¨€èª)", url="https://ja.wikipedia.org/wiki/Python_(è¨€èª)")
        ]
        
        with patch('wikipedia.summary', return_value="Pythonã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã™"):
            result = agent.wikipedia_search("Python")
            
            assert result is not None
            assert mock_page.call_count == 2
```

#### 5. KBä¿å­˜ãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_save_to_kb():
    """
    Given: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã‚«ãƒ†ã‚´ãƒª
    When: save_to_kb()ã‚’å‘¼ã³å‡ºã™
    Then: KBã«ä¿å­˜ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch.object(agent.kb, 'store') as mock_store:
        agent.save_to_kb("ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", "news")
        
        mock_store.assert_called_once_with(
            content="ã‚³ãƒ³ãƒ†ãƒ³ãƒ„",
            category="news",
            metadata={"source": "autonomous_search"}
        )

def test_save_to_kb_custom_source():
    """
    Given: ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹
    When: save_to_kb()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚½ãƒ¼ã‚¹ãŒè¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch.object(agent.kb, 'store') as mock_store:
        agent.save_to_kb("ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", "news", source="manual")
        
        mock_store.assert_called_once_with(
            content="ã‚³ãƒ³ãƒ†ãƒ³ãƒ„",
            category="news",
            metadata={"source": "manual"}
        )
```

#### 6. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ : 10ä»¶ï¼‰

```python
def test_web_search_timeout():
    """
    Given: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: ç©ºã®ãƒªã‚¹ãƒˆãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    with patch('requests.post', side_effect=requests.Timeout("Timeout")):
        results = agent.web_search("test")
        
        assert results == []

def test_wikipedia_search_empty_query():
    """
    Given: ç©ºã®ã‚¯ã‚¨ãƒª
    When: wikipedia_search()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ï¼ˆã¾ãŸã¯NoneãŒè¿”ã•ã‚Œã‚‹ï¼‰
    """
    agent = AutonomousSearchAgent()
    
    result = agent.wikipedia_search("")
    
    # å®Ÿè£…ã«å¿œã˜ã¦ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯None
    assert result is None or isinstance(result, dict)
```

#### 7. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ : 5ä»¶ï¼‰

```python
@pytest.mark.parametrize("similarity,expected", [
    (0.0, True),
    (0.5, True),
    (0.6, False),
    (0.9, False),
])
def test_should_search_parametrized(similarity, expected):
    """
    Given: æ§˜ã€…ãªä¿¡é ¼åº¦
    When: should_search()ã‚’å‘¼ã³å‡ºã™
    Then: æœŸå¾…ã•ã‚Œã‚‹çµæœãŒè¿”ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    result = agent.should_search("è³ªå•", [{"similarity": similarity}])
    
    assert result == expected

@pytest.mark.parametrize("max_results", [1, 5, 10, 20])
def test_web_search_various_max_results(max_results):
    """
    Given: æ§˜ã€…ãªmax_resultså€¤
    When: web_search()ã‚’å‘¼ã³å‡ºã™
    Then: æŒ‡å®šã•ã‚ŒãŸä»¶æ•°ã¾ã§ã«åˆ¶é™ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent(serper_api_key="test_key")
    
    with patch('requests.post') as mock_post:
        mock_response = Mock()
        mock_response.json.return_value = {
            "organic": [{"title": f"çµæœ{i}"} for i in range(20)]
        }
        mock_response.raise_for_status = Mock()
        mock_post.return_value = mock_response
        
        results = agent.web_search("test", max_results=max_results)
        
        assert len(results) == max_results
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_scheduler.py`

**ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹**: `TestUpdateScheduler`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ20ä»¶ï¼‰**:

#### 1. åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆ2ä»¶ï¼‰

```python
def test_scheduler_init():
    """
    Given: AutonomousSearchAgentã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    When: UpdateSchedulerã‚’åˆæœŸåŒ–
    Then: search_agentãŒè¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    assert scheduler.search_agent is agent
```

#### 2. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šãƒ†ã‚¹ãƒˆï¼ˆ6ä»¶ï¼‰

```python
def test_schedule_daily_news():
    """
    Given: UpdateScheduler
    When: schedule_daily_news()ã‚’å‘¼ã³å‡ºã™
    Then: æ¯æœ6æ™‚ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch('schedule.every') as mock_every:
        mock_day = Mock()
        mock_day.day = Mock()
        mock_day.day.at = Mock(return_value=mock_day)
        mock_every.return_value = mock_day
        
        scheduler.schedule_daily_news()
        
        mock_day.day.at.assert_called_with("06:00")

def test_schedule_weekly_movies():
    """
    Given: UpdateScheduler
    When: schedule_weekly_movies()ã‚’å‘¼ã³å‡ºã™
    Then: æ¯é€±æ—¥æ›œ10æ™‚ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch('schedule.every') as mock_every:
        mock_sunday = Mock()
        mock_sunday.sunday = Mock()
        mock_sunday.sunday.at = Mock(return_value=mock_sunday)
        mock_every.return_value = mock_sunday
        
        scheduler.schedule_weekly_movies()
        
        mock_sunday.sunday.at.assert_called_with("10:00")
```

#### 3. ãƒ•ã‚§ãƒƒãƒé–¢æ•°ãƒ†ã‚¹ãƒˆï¼ˆ6ä»¶ï¼‰

```python
def test_fetch_news():
    """
    Given: UpdateScheduler
    When: _fetch_news()ã‚’å‘¼ã³å‡ºã™
    Then: ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒæ¤œç´¢ã•ã‚Œã€KBã«ä¿å­˜ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch.object(agent, 'web_search', return_value=[
        {"title": "ãƒ‹ãƒ¥ãƒ¼ã‚¹1", "snippet": "èª¬æ˜1"}
    ]) as mock_search:
        with patch.object(agent, 'save_to_kb') as mock_save:
            scheduler._fetch_news()
            
            mock_search.assert_called_once_with("æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹", max_results=5)
            mock_save.assert_called()

def test_fetch_movies():
    """
    Given: UpdateScheduler
    When: _fetch_movies()ã‚’å‘¼ã³å‡ºã™
    Then: æ˜ ç”»æƒ…å ±ãŒæ¤œç´¢ã•ã‚Œã€KBã«ä¿å­˜ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch.object(agent, 'web_search', return_value=[
        {"title": "æ˜ ç”»1", "snippet": "èª¬æ˜1"}
    ]) as mock_search:
        with patch.object(agent, 'save_to_kb') as mock_save:
            scheduler._fetch_movies()
            
            mock_search.assert_called_once_with("ä»Šé€±å…¬é–‹æ˜ ç”»", max_results=3)
            mock_save.assert_called()
```

#### 4. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆ4ä»¶ï¼‰

```python
def test_run_executes_pending():
    """
    Given: UpdateScheduler
    When: run()ã‚’å‘¼ã³å‡ºã™
    Then: ä¿ç•™ä¸­ã®ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch('schedule.run_pending') as mock_run:
        with patch('time.sleep', side_effect=KeyboardInterrupt):
            try:
                scheduler.run()
            except KeyboardInterrupt:
                pass
            
            mock_run.assert_called()
```

#### 5. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ : 5ä»¶ï¼‰

```python
def test_fetch_news_empty_results():
    """
    Given: æ¤œç´¢çµæœãŒç©º
    When: _fetch_news()ã‚’å‘¼ã³å‡ºã™
    Then: KBä¿å­˜ãŒå‘¼ã°ã‚Œãªã„
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    with patch.object(agent, 'web_search', return_value=[]):
        with patch.object(agent, 'save_to_kb') as mock_save:
            scheduler._fetch_news()
            
            mock_save.assert_not_called()
```

---

## çµ±åˆãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_integration_visualization.py`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ10ä»¶ï¼‰**:

```python
"""3Då¯è¦–åŒ–ã®çµ±åˆãƒ†ã‚¹ãƒˆ."""

import pytest
from visualization.association_3d import AssociationVisualizationPanel
from memory.associative import AssociativeMemory


@pytest.mark.integration
def test_visualization_with_associative_memory():
    """
    Given: é€£æƒ³è¨˜æ†¶ã«æ¦‚å¿µãŒå­˜åœ¨
    When: å¯è¦–åŒ–ãƒ‘ãƒãƒ«ã§ã‚°ãƒ©ãƒ•ã‚’æç”»
    Then: é€£æƒ³è¨˜æ†¶ã‹ã‚‰æ¦‚å¿µãŒå–å¾—ã•ã‚Œã€ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã‚‹
    """
    memory = AssociativeMemory(db_path=":memory:")
    panel = AssociationVisualizationPanel(memory)
    
    # æ¦‚å¿µè¿½åŠ 
    memory.add_concept("æ©Ÿæ¢°å­¦ç¿’", embedding=[0.1]*128, metadata={})
    memory.add_concept("Python", embedding=[0.2]*128, metadata={})
    memory.link_concepts("æ©Ÿæ¢°å­¦ç¿’", "Python", "related", strength=0.8)
    
    panel.current_center = "æ©Ÿæ¢°å­¦ç¿’"
    panel.is_enabled = True
    fig = panel._render_graph()
    
    assert fig is not None
    assert len(fig.data) > 0

# ... ä»–9ä»¶ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€å¤§é‡ãƒ‡ãƒ¼ã‚¿ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãªã©ï¼‰
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_integration_search.py`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ10ä»¶ï¼‰**:

```python
"""è‡ªå¾‹ã‚µãƒ¼ãƒã®çµ±åˆãƒ†ã‚¹ãƒˆ."""

import pytest
from agents.autonomous_search import AutonomousSearchAgent
from memory.knowledge_base import KnowledgeBase
from scheduler.update_scheduler import UpdateScheduler


@pytest.mark.integration
def test_search_and_save_to_kb():
    """
    Given: æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨KB
    When: æ¤œç´¢ã—ã¦KBã«ä¿å­˜
    Then: KBã«æ­£ã—ãä¿å­˜ã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    
    with patch.object(agent, 'web_search', return_value=[
        {"title": "çµæœ", "snippet": "èª¬æ˜", "link": "http://example.com"}
    ]):
        agent.save_to_kb("ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„", "news")
        
        # KBã‹ã‚‰æ¤œç´¢ã—ã¦ç¢ºèª
        results = agent.kb.search("ãƒ†ã‚¹ãƒˆ", top_k=1)
        assert len(results) > 0

@pytest.mark.integration
def test_scheduler_integration():
    """
    Given: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¨æ¤œç´¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    When: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¦å®Ÿè¡Œ
    Then: æ¤œç´¢ã¨KBä¿å­˜ãŒå®Ÿè¡Œã•ã‚Œã‚‹
    """
    agent = AutonomousSearchAgent()
    scheduler = UpdateScheduler(agent)
    
    scheduler.schedule_daily_news()
    
    # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    # å®Ÿéš›ã®å®Ÿè¡Œã¯æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šã®ã¿ç¢ºèª

# ... ä»–8ä»¶ï¼ˆå®šæœŸå®Ÿè¡Œã€ã‚¨ãƒ©ãƒ¼å›å¾©ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãªã©ï¼‰
```

---

## ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜

### conftest.py ã®æ‹¡å¼µ

```python
# tests/conftest.pyï¼ˆæ‹¡å¼µï¼‰

import pytest
import tempfile
from unittest.mock import Mock, patch

from visualization.association_3d import AssociationVisualizationPanel
from memory.associative import AssociativeMemory
from agents.autonomous_search import AutonomousSearchAgent
from scheduler.update_scheduler import UpdateScheduler

@pytest.fixture
def associative_memory():
    """AssociativeMemoryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return AssociativeMemory(db_path=":memory:")

@pytest.fixture
def visualization_panel(associative_memory):
    """AssociationVisualizationPanelã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return AssociationVisualizationPanel(associative_memory)

@pytest.fixture
def search_agent():
    """AutonomousSearchAgentã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return AutonomousSearchAgent()

@pytest.fixture
def scheduler(search_agent):
    """UpdateSchedulerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return UpdateScheduler(search_agent)

@pytest.fixture
def mock_requests():
    """requests.postã®ãƒ¢ãƒƒã‚¯"""
    with patch('requests.post') as mock:
        yield mock

@pytest.fixture
def mock_wikipedia():
    """wikipediaã®ãƒ¢ãƒƒã‚¯"""
    with patch('wikipedia.page') as mock_page, \
         patch('wikipedia.summary') as mock_summary:
        yield mock_page, mock_summary
```

---

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥

### TDDå®Ÿè£…é †åºï¼ˆè©³ç´°ç‰ˆï¼‰

#### Week 1-2: 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«

**Day 1: åˆæœŸåŒ–ãƒ»ON/OFFåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰â†’ å®Ÿè£…**
- åˆæœŸåŒ–: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã€ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ON/OFFåˆ‡ã‚Šæ›¿ãˆ: çŠ¶æ…‹å¤‰æ›´ã€è¤‡æ•°å›åˆ‡ã‚Šæ›¿ãˆ

**Day 2: ä¸­å¿ƒæ¦‚å¿µæ›´æ–°ãƒ»ã‚°ãƒ©ãƒ•æç”»ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰â†’ å®Ÿè£…**
- ä¸­å¿ƒæ¦‚å¿µæ›´æ–°: è¨­å®šã€æç”»ãƒˆãƒªã‚¬ãƒ¼ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- ã‚°ãƒ©ãƒ•æç”»: åŸºæœ¬æç”»ã€ç©ºãƒ‡ãƒ¼ã‚¿ã€max_nodesåˆ¶é™

**Day 3: åº§æ¨™è¨ˆç®—ãƒ»ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ä½œæˆãƒ†ã‚¹ãƒˆï¼ˆ13ä»¶ï¼‰â†’ å®Ÿè£…**
- åº§æ¨™è¨ˆç®—: ä¸­å¿ƒé…ç½®ã€depthãƒ™ãƒ¼ã‚¹é…ç½®
- ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ä½œæˆ: ãƒˆãƒ¬ãƒ¼ã‚¹ä½œæˆã€è‰²ãƒ»ã‚µã‚¤ã‚ºè¨ˆç®—

**Day 4: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ12ä»¶ï¼‰â†’ å®Ÿè£…**
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: HTMLã€PNGå‡ºåŠ›
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºãƒ‡ãƒ¼ã‚¿ã€é‡è¤‡ã€ç•°å¸¸å€¤

**Day 5-6: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰â†’ å®Ÿè£…ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
- é€£æƒ³è¨˜æ†¶é€£æºã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

#### Week 3-4: è‡ªå¾‹ã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

**Day 1-2: æ¤œç´¢åˆ¤å®šãƒ»Webæ¤œç´¢ãƒ†ã‚¹ãƒˆï¼ˆ18ä»¶ï¼‰â†’ å®Ÿè£…**
- æ¤œç´¢åˆ¤å®š: KBçµæœãªã—ã€ä½ä¿¡é ¼åº¦ã€å¢ƒç•Œå€¤
- Webæ¤œç´¢: APIã‚­ãƒ¼ãªã—ã€æˆåŠŸã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**Day 3: Wikipediaæ¤œç´¢ãƒ»KBä¿å­˜ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰â†’ å®Ÿè£…**
- Wikipediaæ¤œç´¢: æˆåŠŸã€PageErrorã€DisambiguationError
- KBä¿å­˜: åŸºæœ¬ä¿å­˜ã€ã‚«ã‚¹ã‚¿ãƒ ã‚½ãƒ¼ã‚¹

**Day 4: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ†ã‚¹ãƒˆï¼ˆ20ä»¶ï¼‰â†’ å®Ÿè£…**
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š: æ¯æ—¥ã€æ¯é€±ã€æ¯æœˆ
- ãƒ•ã‚§ãƒƒãƒé–¢æ•°: ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€æ˜ ç”»ã€æŠ€è¡“æƒ…å ±
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å®Ÿè¡Œ: ä¿ç•™ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ

**Day 5-6: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰â†’ å®Ÿè£…ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
- KBé€£æºã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©çµ±åˆã€ã‚¨ãƒ©ãƒ¼å›å¾©

### ãƒ†ã‚¹ãƒˆå“è³ªåŸºæº–

**å¿…é ˆè¦ä»¶**:
- âœ… **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100%ï¼ˆå…¨130ä»¶ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼‰
- âœ… **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: 88%ä»¥ä¸Šï¼ˆå¹³å‡ï¼‰
- âœ… **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: å…¨ãƒ†ã‚¹ãƒˆ5åˆ†ä»¥å†…
- âœ… **ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ï¼ˆAPIã€Wikipediaç­‰ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

**TDDã‚µã‚¤ã‚¯ãƒ«éµå®ˆ**:
- âœ… **RED**: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã‚‹
- âœ… **GREEN**: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ã„ã‚‹
- âœ… **REFACTOR**: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã‚‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹

---

## 7. æˆæœç‰©

### 7.1 å®Ÿè£…ã‚³ãƒ¼ãƒ‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `visualization/association_3d.py` (500è¡Œ)
- `agents/autonomous_search.py` (350è¡Œ)
- `scheduler/update_scheduler.py` (200è¡Œ)
- **åˆè¨ˆ**: 1,050è¡Œ

### 7.2 ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `tests/test_visualization.py` (45ä»¶)
  - åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ON/OFFåˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ä¸­å¿ƒæ¦‚å¿µæ›´æ–°ãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ã‚°ãƒ©ãƒ•æç”»ãƒ†ã‚¹ãƒˆ: 10ä»¶
  - åº§æ¨™è¨ˆç®—ãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ä½œæˆãƒ†ã‚¹ãƒˆ: 8ä»¶
  - è‰²ãƒ»ã‚µã‚¤ã‚ºè¨ˆç®—ãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ: 2ä»¶
  - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ: 10ä»¶
  - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆ: 5ä»¶
- `tests/test_autonomous_search.py` (45ä»¶)
  - åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ: 3ä»¶
  - æ¤œç´¢åˆ¤å®šãƒ†ã‚¹ãƒˆ: 8ä»¶
  - Webæ¤œç´¢ãƒ†ã‚¹ãƒˆ: 10ä»¶
  - Wikipediaæ¤œç´¢ãƒ†ã‚¹ãƒˆ: 10ä»¶
  - KBä¿å­˜ãƒ†ã‚¹ãƒˆ: 5ä»¶
  - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ: 10ä»¶
  - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆ: 5ä»¶
- `tests/test_scheduler.py` (20ä»¶)
  - åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ: 2ä»¶
  - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šãƒ†ã‚¹ãƒˆ: 6ä»¶
  - ãƒ•ã‚§ãƒƒãƒé–¢æ•°ãƒ†ã‚¹ãƒˆ: 6ä»¶
  - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å®Ÿè¡Œãƒ†ã‚¹ãƒˆ: 4ä»¶
  - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ: 5ä»¶
- `tests/test_integration_visualization.py` (10ä»¶)
- `tests/test_integration_search.py` (10ä»¶)
- `tests/fixtures/visualization_fixtures.py`: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©
- `tests/fixtures/autonomous_search_fixtures.py`: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©
- **åˆè¨ˆ**: 130ä»¶ä»¥ä¸Šï¼ˆã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰

### 7.3 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docks/å®Œäº†å ±å‘Š/Phase7_å®Œäº†ã‚µãƒãƒªãƒ¼.md`
- 3Då¯è¦–åŒ–æ“ä½œã‚¬ã‚¤ãƒ‰
- è‡ªå¾‹ã‚µãƒ¼ãƒè¨­å®šã‚¬ã‚¤ãƒ‰

### 7.4 ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

- [ ] 3Då¯è¦–åŒ–ãƒ‘ãƒãƒ«å‹•ä½œç¢ºèª
- [ ] è‡ªå¾‹ã‚µãƒ¼ãƒå®šæœŸå®Ÿè¡Œãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] KBè‡ªå‹•æ›´æ–°ç¢ºèª
- [ ] å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ130ä»¶ä»¥ä¸Šï¼‰
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ > 88%

---

## 8. Phase 7æˆåŠŸåŸºæº–

### TDDå®Ÿè£…ã®æˆåŠŸåŸºæº–

**å¿…é ˆè¦ä»¶**:
- âœ… **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å…¨æ©Ÿèƒ½ãŒãƒ†ã‚¹ãƒˆé§†å‹•ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- âœ… **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100%ï¼ˆå…¨130ä»¶ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼‰
- âœ… **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: 88%ä»¥ä¸Šï¼ˆå¹³å‡ï¼‰
- âœ… **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: å…¨ãƒ†ã‚¹ãƒˆ5åˆ†ä»¥å†…
- âœ… **ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ï¼ˆAPIã€Wikipediaç­‰ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

**TDDã‚µã‚¤ã‚¯ãƒ«éµå®ˆ**:
- âœ… RED: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã‚‹
- âœ… GREEN: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ã„ã‚‹
- âœ… REFACTOR: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã‚‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹

### å®šé‡ç›®æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|----------|
| **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡** | **100%** | pytestï¼ˆå…¨130ä»¶ä»¥ä¸Šï¼‰ |
| **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸** | **88%ä»¥ä¸Š** | pytest-cov |
| **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“** | **< 5åˆ†** | pytest --durations |
| 3Då¯è¦–åŒ–ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚é–“ | < 1ç§’ | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ |
| Webæ¤œç´¢å¿œç­”æ™‚é–“ | < 2ç§’ | APIå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ |
| Wikipediaæ¤œç´¢å¿œç­”æ™‚é–“ | < 3ç§’ | APIå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ |

### å®šæ€§ç›®æ¨™

âœ… **TDDå®Ÿè£…å®Œäº†**: å…¨æ©Ÿèƒ½ãŒãƒ†ã‚¹ãƒˆé§†å‹•ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
âœ… **ãƒ†ã‚¹ãƒˆä»•æ§˜å®Œå‚™**: å…¨130ä»¶ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
âœ… **3Då¯è¦–åŒ–å‹•ä½œ**: é€£æƒ³è¨˜æ†¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å¯è¦–åŒ–
âœ… **è‡ªå¾‹ã‚µãƒ¼ãƒå‹•ä½œ**: è‡ªå‹•Webæ¤œç´¢ãƒ»KBä¿å­˜
âœ… **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å‹•ä½œ**: å®šæœŸæ›´æ–°å®Ÿè¡Œ

---

**Phase 7 å®Ÿè£…å®Œäº†**: è¦–è¦šçš„ç†è§£ã¨çŸ¥è­˜æ‹¡å¼µã®åŸºç›¤ãŒæ•´ã„ã¾ã—ãŸã€‚