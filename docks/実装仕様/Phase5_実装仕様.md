# Phase 5 å®Ÿè£…ä»•æ§˜æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: LlmMultiChat3  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5 - å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œ + è‡ªå·±çœå¯Ÿ  
**æœŸé–“**: 4é€±é–“  
**ä½œæˆæ—¥**: 2025-11-20  
**Phase 4å®Œäº†å‰æ**: é€£æƒ³è¨˜æ†¶ãƒ»æ„Ÿæƒ…åŸºç›¤å®Ÿè£…æ¸ˆã¿

---

## ç›®æ¬¡

1. [Phase 5æ¦‚è¦](#1-phase-5æ¦‚è¦)
2. [å‰ææ¡ä»¶](#2-å‰ææ¡ä»¶)
3. [Week 1-2: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´](#3-week-1-2-å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´)
4. [Week 3-4: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯](#4-week-3-4-è‡ªå·±çœå¯Ÿä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯)
5. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#5-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
6. [ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆTDDå®Ÿè£…ï¼‰](#6-ãƒ†ã‚¹ãƒˆè¨ˆç”»tddå®Ÿè£…)
   - [Week 1-2: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰](#week-1-2-å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´---ãƒ†ã‚¹ãƒˆä»•æ§˜tdd)
   - [Week 3-4: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰](#week-3-4-è‡ªå·±çœå¯Ÿä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯---ãƒ†ã‚¹ãƒˆä»•æ§˜tdd)
   - [ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜](#ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜)
   - [ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥)
7. [æˆæœç‰©](#7-æˆæœç‰©)
8. [Phase 5æˆåŠŸåŸºæº–](#8-phase-5æˆåŠŸåŸºæº–)

---

## 1. Phase 5æ¦‚è¦

### 1.1 ç›®çš„

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆã‚ã›ãŸå¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã¨è‡ªå·±æ”¹å–„æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€**å€‹ã€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æœ€é©åŒ–ã•ã‚ŒãŸä¼šè©±ä½“é¨“**ã‚’æä¾›ã—ã¾ã™ã€‚

### 1.2 TDDå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

Phase 5ã¯**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰**ã§å®Ÿè£…ã—ã¾ã™ã€‚å„æ©Ÿèƒ½ã¯ä»¥ä¸‹ã®ã‚µã‚¤ã‚¯ãƒ«ã§é–‹ç™ºã—ã¾ã™ï¼š

```
1. ğŸ”´ RED: ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆå¤±æ•—ã™ã‚‹ï¼‰
2. ğŸŸ¢ GREEN: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™
3. ğŸ”µ REFACTOR: ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆãƒ†ã‚¹ãƒˆã¯å¸¸ã«æˆåŠŸï¼‰
```

**TDDã®åŸå‰‡**:
- âœ… å®Ÿè£…å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- âœ… 1ã¤ã®ãƒ†ã‚¹ãƒˆ â†’ 1ã¤ã®å®Ÿè£… â†’ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«
- âœ… Given-When-Thenå½¢å¼ã§ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°
- âœ… å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… å¤–éƒ¨ä¾å­˜ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

### 1.2 ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | Priority |
|-------------|------|----------|
| **å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œ** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹ã‚‰å­¦ç¿’ | ğŸ”´ High |
| **è‡ªå·±çœå¯Ÿ** | ä¼šè©±æŒ¯ã‚Šè¿”ã‚Šã¨ãƒ¡ã‚¿èªçŸ¥ | ğŸ”´ High |
| **çŸ›ç›¾æ¤œå‡º** | éå»ç™ºè¨€ã¨ã®ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ | ğŸŸ¡ Medium |
| **ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡** | è©±é¡Œã®æµã‚Œç®¡ç† | ğŸŸ¡ Medium |

### 1.3 é”æˆç›®æ¨™

âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«è‡ªå‹•èª¿æ•´  
âœ… è‡ªå·±çœå¯Ÿã«ã‚ˆã‚‹ç¶™ç¶šçš„æ”¹å–„  
âœ… çŸ›ç›¾æ¤œå‡ºãƒ»ä¿®æ­£ææ¡ˆ  
âœ… ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ç²¾åº¦ > 80%

---

## 2. å‰ææ¡ä»¶

### 2.1 Phase 1-4å®Œäº†äº‹é …

âœ… **Phase 1**: LangGraphã‚³ã‚¢ãƒ»5éšå±¤è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ   
âœ… **Phase 2**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£  
âœ… **Phase 3**: REST/WebSocket APIï¼ˆ23ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰  
âœ… **Phase 4**: é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ãƒ»æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«åŸºç›¤

**å‚ç…§**: [`docks/å®Ÿè£…ä»•æ§˜/Phase4_å®Ÿè£…ä»•æ§˜.md`](Phase4_å®Ÿè£…ä»•æ§˜.md:1)

### 2.2 åˆ©ç”¨å¯èƒ½ãªPhase 4æ©Ÿèƒ½

- **é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ **: [`memory/associative.py`](../../memory/associative.py)
- **æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«**: [`core/emotion.py`](../../core/emotion.py)
- **APIè¿½åŠ **: `/api/v1/memory/associate`, `/api/v1/character/{name}/emotion`

---

## 3. Week 1-2: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´

### 3.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: [`docks/ä»•æ§˜æ›¸/04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md:152-208`](../ä»•æ§˜æ›¸/04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md:152)

#### 3.1.1 ã‚¹ã‚¿ã‚¤ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†

**6ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ï¼ˆ0.0 ï½ 1.0ï¼‰:

```python
{
    "formality": 0.5,      # ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«(0.0) â‡” ãƒ•ã‚©ãƒ¼ãƒãƒ«(1.0)
    "verbosity": 0.5,      # ç°¡æ½”(0.0) â‡” è©³ç´°(1.0)
    "humor": 0.5,          # çœŸé¢ç›®(0.0) â‡” ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹(1.0)
    "technical_level": 0.5,# å¹³æ˜“(0.0) â‡” å°‚é–€çš„(1.0)
    "empathy": 0.7,        # å…±æ„Ÿãƒ¬ãƒ™ãƒ«
    "proactivity": 0.5     # å—å‹•çš„(0.0) â‡” ç©æ¥µçš„(1.0)
}
```

#### 3.1.2 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¾‹**:
- ğŸ‘ "ã‚‚ã£ã¨è©³ã—ãèª¬æ˜ã—ã¦ã»ã—ã„" â†’ `verbosity += 0.1`
- ğŸ‘ "å°‚é–€ç”¨èªãŒå¤šã™ãã‚‹" â†’ `technical_level -= 0.15`
- ğŸ‘ "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªæ„Ÿã˜ãŒã„ã„" â†’ `formality -= 0.1`

#### 3.1.3 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹•çš„ç”Ÿæˆ

```python
# ä¾‹: formality=0.8, verbosity=0.3 ã®å ´åˆ
"""
ã‚ãªãŸã¯ä¸å¯§ã§ç°¡æ½”ãªå›ç­”ã‚’å¿ƒãŒã‘ã¾ã™ã€‚
æ•¬èªã‚’ä½¿ç”¨ã—ã€è¦ç‚¹ã‚’çµã£ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚
"""

# ä¾‹: formality=0.2, humor=0.8 ã®å ´åˆ
"""
ã‚ãªãŸã¯ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ãƒ¦ãƒ¼ãƒ¢ã‚¢ã®ã‚ã‚‹ä¼šè©±ã‚’å¿ƒãŒã‘ã¾ã™ã€‚
è»½ã„ã‚¸ãƒ§ãƒ¼ã‚¯ã‚’äº¤ãˆãªãŒã‚‰ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸé›°å›²æ°—ã§è©±ã—ã¦ãã ã•ã„ã€‚
"""
```

### 3.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### core/dialogue_style.py (250è¡Œ)

```python
"""å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«."""

from typing import Dict, Any
import json


class AdaptiveDialogueStyle:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œã‚¯ãƒ©ã‚¹."""
    
    def __init__(self, user_id: str):
        """
        åˆæœŸåŒ–.
        
        Args:
            user_id: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
        """
        self.user_id = user_id
        self.parameters = {
            "formality": 0.5,
            "verbosity": 0.5,
            "humor": 0.5,
            "technical_level": 0.5,
            "empathy": 0.7,
            "proactivity": 0.5
        }
        self._load_from_profile()
    
    def learn_from_feedback(self, user_feedback: Dict[str, Any]) -> None:
        """
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹ã‚‰å­¦ç¿’.
        
        Args:
            user_feedback: {
                "message": "ã‚‚ã£ã¨è©³ã—ãèª¬æ˜ã—ã¦ã»ã—ã„",
                "thumbs_up": True,
                "specific_feedback": {"verbosity": "+"}
            }
        """
        if user_feedback.get("specific_feedback"):
            for param, direction in user_feedback["specific_feedback"].items():
                if direction == "+":
                    self.parameters[param] = min(1.0, self.parameters[param] + 0.1)
                elif direction == "-":
                    self.parameters[param] = max(0.0, self.parameters[param] - 0.1)
        
        # ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®è‡ªå‹•æ¨è«–
        message = user_feedback.get("message", "").lower()
        if "è©³ã—" in message or "detail" in message:
            self.parameters["verbosity"] = min(1.0, self.parameters["verbosity"] + 0.15)
        if "ç°¡æ½”" in message or "brief" in message:
            self.parameters["verbosity"] = max(0.0, self.parameters["verbosity"] - 0.15)
        if "å°‚é–€" in message or "technical" in message:
            self.parameters["technical_level"] = min(1.0, self.parameters["technical_level"] + 0.15)
        if "ã‚ã‹ã‚Šã‚„ã™ã" in message or "simple" in message:
            self.parameters["technical_level"] = max(0.0, self.parameters["technical_level"] - 0.15)
        
        self._save_to_profile()
    
    def generate_style_prompt(self) -> str:
        """
        ã‚¹ã‚¿ã‚¤ãƒ«ã«å¿œã˜ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿®é£¾å­ç”Ÿæˆ.
        
        Returns:
            str: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿®é£¾å­
        """
        prompt_parts = []
        
        # Formality
        if self.parameters["formality"] > 0.7:
            prompt_parts.append("ä¸å¯§ã§ç¤¼å„€æ­£ã—ã„è¨€è‘‰é£ã„ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚")
        elif self.parameters["formality"] < 0.3:
            prompt_parts.append("ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªè¨€è‘‰é£ã„ã§è©±ã—ã¦ãã ã•ã„ã€‚")
        
        # Verbosity
        if self.parameters["verbosity"] > 0.7:
            prompt_parts.append("è©³ç´°ãªèª¬æ˜ã¨å…·ä½“ä¾‹ã‚’å¤šãå«ã‚ã¦ãã ã•ã„ã€‚")
        elif self.parameters["verbosity"] < 0.3:
            prompt_parts.append("ç°¡æ½”ã§è¦ç‚¹ã‚’çµã£ãŸå›ç­”ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚")
        
        # Humor
        if self.parameters["humor"] > 0.7:
            prompt_parts.append("é©åº¦ã«ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆã€æ¥½ã—ã„é›°å›²æ°—ã§è©±ã—ã¦ãã ã•ã„ã€‚")
        elif self.parameters["humor"] < 0.3:
            prompt_parts.append("çœŸé¢ç›®ã§èª å®Ÿãªãƒˆãƒ¼ãƒ³ã‚’ä¿ã£ã¦ãã ã•ã„ã€‚")
        
        # Technical Level
        if self.parameters["technical_level"] > 0.7:
            prompt_parts.append("å°‚é–€ç”¨èªã‚„æŠ€è¡“çš„ãªè©³ç´°ã‚’å«ã‚ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚")
        elif self.parameters["technical_level"] < 0.3:
            prompt_parts.append("å¹³æ˜“ãªè¨€è‘‰ã§ã€èª°ã«ã§ã‚‚ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚")
        
        # Empathy
        if self.parameters["empathy"] > 0.7:
            prompt_parts.append("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„Ÿæƒ…ã«å¯„ã‚Šæ·»ã„ã€å…±æ„Ÿçš„ãªæ…‹åº¦ã‚’ç¤ºã—ã¦ãã ã•ã„ã€‚")
        
        # Proactivity
        if self.parameters["proactivity"] > 0.7:
            prompt_parts.append("ç©æ¥µçš„ã«ææ¡ˆã‚„è¿½åŠ æƒ…å ±ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚")
        elif self.parameters["proactivity"] < 0.3:
            prompt_parts.append("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚")
        
        return "\n".join(prompt_parts)
    
    def _load_from_profile(self) -> None:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿."""
        try:
            with open(f"profiles/{self.user_id}_style.json", "r") as f:
                saved_params = json.load(f)
                self.parameters.update(saved_params)
        except FileNotFoundError:
            pass
    
    def _save_to_profile(self) -> None:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜."""
        import os
        os.makedirs("profiles", exist_ok=True)
        with open(f"profiles/{self.user_id}_style.json", "w") as f:
            json.dump(self.parameters, f, indent=2)
```

### 3.3 ãƒ†ã‚¹ãƒˆï¼ˆ12ä»¶ï¼‰

#### tests/test_dialogue_style.py

```python
"""å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ."""

import pytest
from core.dialogue_style import AdaptiveDialogueStyle


def test_style_init():
    """åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ."""
    style = AdaptiveDialogueStyle("user_001")
    assert style.user_id == "user_001"
    assert style.parameters["formality"] == 0.5
    assert style.parameters["empathy"] == 0.7


def test_learn_from_feedback():
    """ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’ãƒ†ã‚¹ãƒˆ."""
    style = AdaptiveDialogueStyle("user_002")
    
    # è©³ç´°å¸Œæœ›ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    style.learn_from_feedback({
        "message": "ã‚‚ã£ã¨è©³ã—ãèª¬æ˜ã—ã¦ã»ã—ã„",
        "thumbs_up": True
    })
    assert style.parameters["verbosity"] > 0.5
    
    # å°‚é–€ç”¨èªå¤šã™ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    style.learn_from_feedback({
        "message": "å°‚é–€ç”¨èªãŒå¤šã™ãã‚‹",
        "thumbs_up": False
    })
    # Note: ç¾åœ¨ã®å®Ÿè£…ã§ã¯"å°‚é–€"ã¯å¢—åŠ æ–¹å‘ãªã®ã§ã€åˆ¥ãƒ­ã‚¸ãƒƒã‚¯å¿…è¦


def test_generate_style_prompt():
    """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ."""
    style = AdaptiveDialogueStyle("user_003")
    
    # ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ»è©³ç´°
    style.parameters["formality"] = 0.8
    style.parameters["verbosity"] = 0.8
    prompt = style.generate_style_prompt()
    assert "ä¸å¯§" in prompt
    assert "è©³ç´°" in prompt
    
    # ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»ç°¡æ½”
    style.parameters["formality"] = 0.2
    style.parameters["verbosity"] = 0.2
    prompt = style.generate_style_prompt()
    assert "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼" in prompt or "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«" in prompt
    assert "ç°¡æ½”" in prompt


def test_parameter_bounds():
    """ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¢ƒç•Œãƒ†ã‚¹ãƒˆ."""
    style = AdaptiveDialogueStyle("user_004")
    
    # ä¸Šé™ãƒã‚§ãƒƒã‚¯
    for _ in range(20):
        style.learn_from_feedback({"message": "è©³ã—ã", "thumbs_up": True})
    assert style.parameters["verbosity"] <= 1.0
    
    # ä¸‹é™ãƒã‚§ãƒƒã‚¯
    style.parameters["verbosity"] = 0.0
    for _ in range(20):
        style.learn_from_feedback({"message": "ç°¡æ½”ã«", "thumbs_up": True})
    assert style.parameters["verbosity"] >= 0.0


def test_save_and_load():
    """ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ."""
    style1 = AdaptiveDialogueStyle("user_005")
    style1.parameters["formality"] = 0.9
    style1._save_to_profile()
    
    style2 = AdaptiveDialogueStyle("user_005")
    assert style2.parameters["formality"] == 0.9


# ... ä»–7ä»¶ï¼ˆå¢ƒç•Œå€¤ã€ç•°å¸¸ç³»ã€çµ±åˆãƒ†ã‚¹ãƒˆï¼‰
```

---

## 4. Week 3-4: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯

### 4.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: [`docks/ä»•æ§˜æ›¸/04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md:230-536`](../ä»•æ§˜æ›¸/04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md:230)

#### 4.1.1 è‡ªå·±çœå¯Ÿï¼ˆReflectionï¼‰

**ç›®çš„**: ä¼šè©±çµ‚äº†å¾Œã®æŒ¯ã‚Šè¿”ã‚Šã¨å­¦ç¿’

```python
# çœå¯Ÿä¾‹
{
    "timestamp": "2025-11-20T15:30:00Z",
    "session_id": "sess_001",
    "reflection": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦åˆå¿ƒè€…ã ã£ãŸã€‚å°‚é–€ç”¨èªã‚’å¤šç”¨ã—ã™ããŸã€‚æ¬¡å›ã¯å¹³æ˜“ãªè¨€è‘‰ã§èª¬æ˜ã™ã¹ãã€‚",
    "lessons_learned": [
        "technical_level ã‚’ä¸‹ã’ã‚‹",
        "å…·ä½“ä¾‹ã‚’å¤šç”¨ã™ã‚‹"
    ],
    "improvement_areas": ["èª¬æ˜ã®å¹³æ˜“åŒ–", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ™ãƒ«æ¨å®šç²¾åº¦å‘ä¸Š"]
}
```

#### 4.1.2 çŸ›ç›¾æ¤œå‡ºï¼ˆContradiction Detectionï¼‰

**ç›®çš„**: éå»ç™ºè¨€ã¨ã®ä¸€è²«æ€§ç¶­æŒ

```python
# çŸ›ç›¾æ¤œå‡ºä¾‹
{
    "new_statement": "ç§ã¯çŒ«ãŒå¥½ãã§ã™",
    "contradictory_past_statement": {
        "content": "ç§ã¯çŒ«ãŒè‹¦æ‰‹ã§ã™",
        "timestamp": "2025-11-15T10:00:00Z",
        "session_id": "sess_old_001"
    },
    "contradiction_detected": True,
    "clarification": "ä»¥å‰ã€ŒçŒ«ãŒè‹¦æ‰‹ã€ã¨ãŠã£ã—ã‚ƒã£ã¦ã„ã¾ã—ãŸãŒã€æœ€è¿‘ã¯çŒ«ãŒãŠå¥½ãã«ãªã‚‰ã‚ŒãŸã®ã§ã™ã‹ï¼Ÿ"
}
```

#### 4.1.3 ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ï¼ˆTopic Trackingï¼‰

**ç›®çš„**: è©±é¡Œã®æµã‚Œç®¡ç†ã¨è‡ªç„¶ãªè»¢æ›

```python
# ãƒˆãƒ”ãƒƒã‚¯å±¥æ­´ä¾‹
{
    "topic_history": [
        {"topic": "æ©Ÿæ¢°å­¦ç¿’", "start": 1, "end": 5, "duration": 5},
        {"topic": "Python", "start": 6, "end": 10, "duration": 5},
        {"topic": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "start": 11, "end": None, "duration": None}
    ],
    "current_topic": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
    "shift_detected": True,
    "transition_phrase": "Pythonã®è©±ã‹ã‚‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¤ã„ã¦ãŠè©±ã—ã¾ã—ã‚‡ã†ã‹ã€‚"
}
```

### 4.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### core/self_reflection.py (300è¡Œ)

```python
"""è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«."""

from typing import Dict, List, Any, Optional
from datetime import datetime
import json
from memory.long_term import LongTermMemory


class SelfReflection:
    """è‡ªå·±çœå¯Ÿã‚¯ãƒ©ã‚¹."""
    
    def __init__(self, character_name: str):
        """
        åˆæœŸåŒ–.
        
        Args:
            character_name: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å
        """
        self.character_name = character_name
        self.long_term_memory = LongTermMemory()
    
    def reflect_on_conversation(self, conversation_history: List[Dict[str, Any]]) -> Dict[str, Any]:
        """
        ä¼šè©±æŒ¯ã‚Šè¿”ã‚Š.
        
        Args:
            conversation_history: ä¼šè©±å±¥æ­´
        
        Returns:
            Dict: çœå¯Ÿçµæœ
        """
        reflection = {
            "timestamp": datetime.utcnow().isoformat(),
            "session_id": conversation_history[0].get("session_id"),
            "reflection": "",
            "lessons_learned": [],
            "improvement_areas": []
        }
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¨€ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡º
        user_messages = [msg for msg in conversation_history if msg["role"] == "user"]
        if not user_messages:
            return reflection
        
        # åˆ†æä¾‹ï¼ˆå®Ÿéš›ã¯LLMã§ç”Ÿæˆï¼‰
        reflection["reflection"] = f"{len(user_messages)}å›ã®ã‚„ã‚Šå–ã‚ŠãŒã‚ã‚Šã¾ã—ãŸã€‚"
        
        # å­¦ã³ã®æŠ½å‡º
        if any("ã‚ã‹ã‚Šã‚„ã™ã" in msg.get("content", "") for msg in user_messages):
            reflection["lessons_learned"].append("technical_level ã‚’ä¸‹ã’ã‚‹")
        
        if any("è©³ã—ã" in msg.get("content", "") for msg in user_messages):
            reflection["lessons_learned"].append("verbosity ã‚’ä¸Šã’ã‚‹")
        
        self._store_reflection(reflection)
        return reflection
    
    def _store_reflection(self, reflection: Dict[str, Any]) -> None:
        """çœå¯Ÿã‚’é•·æœŸè¨˜æ†¶ã«ä¿å­˜."""
        self.long_term_memory.store(
            content=json.dumps(reflection, ensure_ascii=False),
            category="reflection",
            metadata={"character": self.character_name}
        )
    
    def retrieve_past_lessons(self, current_situation: str) -> List[Dict[str, Any]]:
        """
        éå»ã®å­¦ã³ã‚’æ¤œç´¢.
        
        Args:
            current_situation: ç¾åœ¨ã®çŠ¶æ³ï¼ˆä¾‹: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ€è¡“çš„ãªè³ªå•ã‚’ã—ã¦ã„ã‚‹"ï¼‰
        
        Returns:
            List[Dict]: é–¢é€£ã™ã‚‹éå»ã®å­¦ã³
        """
        results = self.long_term_memory.search(
            query=current_situation,
            top_k=5,
            filter_dict={"category": "reflection"}
        )
        
        lessons = []
        for result in results:
            try:
                reflection = json.loads(result["content"])
                lessons.append(reflection)
            except json.JSONDecodeError:
                continue
        
        return lessons


class DialogueCoherence:
    """å¯¾è©±ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã‚¯ãƒ©ã‚¹."""
    
    def __init__(self):
        """åˆæœŸåŒ–."""
        self.long_term_memory = LongTermMemory()
    
    def check_consistency(
        self,
        new_statement: str,
        history: List[Dict[str, Any]],
        threshold: float = 0.7
    ) -> Dict[str, Any]:
        """
        ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯.
        
        Args:
            new_statement: æ–°ã—ã„ç™ºè¨€
            history: ä¼šè©±å±¥æ­´
            threshold: çŸ›ç›¾æ¤œå‡ºé–¾å€¤
        
        Returns:
            Dict: ãƒã‚§ãƒƒã‚¯çµæœ
        """
        result = {
            "contradiction_detected": False,
            "contradictory_past_statement": None,
            "clarification": None
        }
        
        # éå»ç™ºè¨€ã‹ã‚‰é¡ä¼¼ãƒˆãƒ”ãƒƒã‚¯æ¤œç´¢
        past_statements = self.long_term_memory.search(
            query=new_statement,
            top_k=10
        )
        
        for past in past_statements:
            if self._detect_contradiction(new_statement, past["content"]):
                result["contradiction_detected"] = True
                result["contradictory_past_statement"] = past
                result["clarification"] = self._generate_clarification(
                    new_statement,
                    past["content"]
                )
                break
        
        return result
    
    def _detect_contradiction(self, stmt1: str, stmt2: str) -> bool:
        """
        çŸ›ç›¾æ¤œå‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰.
        
        å®Ÿéš›ã¯LLMã¾ãŸã¯NLIï¼ˆNatural Language Inferenceï¼‰ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨.
        """
        # ç°¡æ˜“å®Ÿè£…ä¾‹
        negation_patterns = [
            ("å¥½ã", "è‹¦æ‰‹"),
            ("å¾—æ„", "è‹¦æ‰‹"),
            ("è³›æˆ", "åå¯¾")
        ]
        
        for pos, neg in negation_patterns:
            if (pos in stmt1 and neg in stmt2) or (neg in stmt1 and pos in stmt2):
                return True
        
        return False
    
    def _generate_clarification(self, new_stmt: str, past_stmt: str) -> str:
        """
        çŸ›ç›¾ã«å¯¾ã™ã‚‹æ˜ç¢ºåŒ–è³ªå•ç”Ÿæˆ.
        
        Args:
            new_stmt: æ–°ç™ºè¨€
            past_stmt: éå»ç™ºè¨€
        
        Returns:
            str: æ˜ç¢ºåŒ–è³ªå•
        """
        return f"ä»¥å‰ã€Œ{past_stmt}ã€ã¨ãŠã£ã—ã‚ƒã£ã¦ã„ã¾ã—ãŸãŒã€ä»Šå›ã¯ã€Œ{new_stmt}ã€ã¨ã®ã“ã¨ã€‚ãŠè€ƒãˆãŒå¤‰ã‚ã‚‰ã‚ŒãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ"


class TopicTracker:
    """ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ã‚¯ãƒ©ã‚¹."""
    
    def __init__(self):
        """åˆæœŸåŒ–."""
        self.topic_history: List[Dict[str, Any]] = []
        self.current_topic: Optional[str] = None
        self.message_count = 0
    
    def detect_topic_shift(
        self,
        user_input: str,
        context: Dict[str, Any]
    ) -> Dict[str, Any]:
        """
        è©±é¡Œè»¢æ›æ¤œå‡º.
        
        Args:
            user_input: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
            context: æ–‡è„ˆæƒ…å ±
        
        Returns:
            Dict: æ¤œå‡ºçµæœ
        """
        self.message_count += 1
        
        # ãƒˆãƒ”ãƒƒã‚¯æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆã€å®Ÿéš›ã¯LLMã§æŠ½å‡ºï¼‰
        new_topic = self._extract_topic(user_input)
        
        shift_detected = False
        if self.current_topic and new_topic != self.current_topic:
            shift_detected = True
            # ç¾åœ¨ã®ãƒˆãƒ”ãƒƒã‚¯çµ‚äº†
            if self.topic_history:
                self.topic_history[-1]["end"] = self.message_count - 1
                self.topic_history[-1]["duration"] = (
                    self.topic_history[-1]["end"] - self.topic_history[-1]["start"] + 1
                )
        
        if shift_detected or self.current_topic is None:
            self.current_topic = new_topic
            self.topic_history.append({
                "topic": new_topic,
                "start": self.message_count,
                "end": None,
                "duration": None
            })
        
        return {
            "shift_detected": shift_detected,
            "current_topic": self.current_topic,
            "topic_history": self.topic_history
        }
    
    def generate_transition_phrase(self, old_topic: str, new_topic: str) -> str:
        """
        è©±é¡Œè»¢æ›ãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ.
        
        Args:
            old_topic: æ—§ãƒˆãƒ”ãƒƒã‚¯
            new_topic: æ–°ãƒˆãƒ”ãƒƒã‚¯
        
        Returns:
            str: è»¢æ›ãƒ•ãƒ¬ãƒ¼ã‚º
        """
        return f"{old_topic}ã®è©±ã‹ã‚‰ã€{new_topic}ã«ã¤ã„ã¦ãŠè©±ã—ã¾ã—ã‚‡ã†ã‹ã€‚"
    
    def suggest_topic_return(self) -> Optional[str]:
        """
        ä»¥å‰ã®ãƒˆãƒ”ãƒƒã‚¯ã¸ã®æˆ»ã‚Šææ¡ˆ.
        
        Returns:
            Optional[str]: ææ¡ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        """
        if len(self.topic_history) < 2:
            return None
        
        previous_topic = self.topic_history[-2]["topic"]
        return f"å…ˆã»ã©ã®{previous_topic}ã®è©±é¡Œã«æˆ»ã‚Šã¾ã—ã‚‡ã†ã‹ï¼Ÿ"
    
    def _extract_topic(self, text: str) -> str:
        """
        ãƒˆãƒ”ãƒƒã‚¯æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰.
        
        å®Ÿéš›ã¯LLMã¾ãŸã¯ãƒˆãƒ”ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨.
        """
        # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ç°¡æ˜“å®Ÿè£…
        keywords = {
            "æ©Ÿæ¢°å­¦ç¿’": ["æ©Ÿæ¢°å­¦ç¿’", "ML", "ãƒ¢ãƒ‡ãƒ«"],
            "Python": ["Python", "ãƒ‘ã‚¤ã‚½ãƒ³", "ã‚³ãƒ¼ãƒ‰"],
            "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹": ["ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "DB", "SQL"]
        }
        
        for topic, kws in keywords.items():
            if any(kw in text for kw in kws):
                return topic
        
        return "ãã®ä»–"
```

### 4.3 ãƒ†ã‚¹ãƒˆï¼ˆ18ä»¶ï¼‰

#### tests/test_self_reflection.py

```python
"""è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ."""

import pytest
from core.self_reflection import SelfReflection, DialogueCoherence, TopicTracker


def test_reflect_on_conversation():
    """çœå¯Ÿãƒ†ã‚¹ãƒˆ."""
    reflection = SelfReflection("lumina")
    
    conversation = [
        {"role": "user", "content": "ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„", "session_id": "sess_001"},
        {"role": "assistant", "content": "æ‰¿çŸ¥ã—ã¾ã—ãŸ", "session_id": "sess_001"}
    ]
    
    result = reflection.reflect_on_conversation(conversation)
    assert result["session_id"] == "sess_001"
    assert "technical_level ã‚’ä¸‹ã’ã‚‹" in result["lessons_learned"]


def test_store_reflection():
    """çœå¯Ÿä¿å­˜ãƒ†ã‚¹ãƒˆ."""
    reflection = SelfReflection("clarisse")
    
    conversation = [
        {"role": "user", "content": "è©³ã—ãæ•™ãˆã¦", "session_id": "sess_002"},
        {"role": "assistant", "content": "ã¯ã„", "session_id": "sess_002"}
    ]
    
    result = reflection.reflect_on_conversation(conversation)
    # ä¿å­˜å‡¦ç†ã¯ _store_reflection å†…ã§å®Ÿè¡Œæ¸ˆã¿
    assert result is not None


def test_retrieve_past_lessons():
    """å­¦ã³æ¤œç´¢ãƒ†ã‚¹ãƒˆ."""
    reflection = SelfReflection("lumina")
    
    lessons = reflection.retrieve_past_lessons("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ€è¡“çš„ãªè³ªå•ã‚’ã—ã¦ã„ã‚‹")
    assert isinstance(lessons, list)


def test_check_consistency():
    """ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ."""
    coherence = DialogueCoherence()
    
    history = [
        {"role": "assistant", "content": "ç§ã¯çŒ«ãŒè‹¦æ‰‹ã§ã™"}
    ]
    
    result = coherence.check_consistency("ç§ã¯çŒ«ãŒå¥½ãã§ã™", history)
    # Note: å®Ÿéš›ã¯é•·æœŸè¨˜æ†¶ã«ä¿å­˜ã•ã‚ŒãŸã‚‚ã®ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯æ¤œå‡ºã•ã‚Œãªã„å¯èƒ½æ€§


def test_detect_contradiction():
    """çŸ›ç›¾æ¤œå‡ºãƒ†ã‚¹ãƒˆ."""
    coherence = DialogueCoherence()
    
    # çŸ›ç›¾ã‚ã‚Š
    assert coherence._detect_contradiction("ç§ã¯çŒ«ãŒå¥½ãã§ã™", "ç§ã¯çŒ«ãŒè‹¦æ‰‹ã§ã™")
    
    # çŸ›ç›¾ãªã—
    assert not coherence._detect_contradiction("ç§ã¯çŒ«ãŒå¥½ãã§ã™", "ç§ã¯çŠ¬ã‚‚å¥½ãã§ã™")


def test_topic_shift_detection():
    """è©±é¡Œè»¢æ›æ¤œå‡ºãƒ†ã‚¹ãƒˆ."""
    tracker = TopicTracker()
    
    # åˆå›
    result1 = tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„", {})
    assert result1["shift_detected"] is False
    assert result1["current_topic"] == "æ©Ÿæ¢°å­¦ç¿’"
    
    # åŒã˜ãƒˆãƒ”ãƒƒã‚¯
    result2 = tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã®ãƒ¢ãƒ‡ãƒ«ã¯ï¼Ÿ", {})
    assert result2["shift_detected"] is False
    
    # ãƒˆãƒ”ãƒƒã‚¯è»¢æ›
    result3 = tracker.detect_topic_shift("Pythonã®ã‚³ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦", {})
    assert result3["shift_detected"] is True
    assert result3["current_topic"] == "Python"


def test_transition_phrase():
    """è»¢æ›ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ†ã‚¹ãƒˆ."""
    tracker = TopicTracker()
    
    phrase = tracker.generate_transition_phrase("æ©Ÿæ¢°å­¦ç¿’", "Python")
    assert "æ©Ÿæ¢°å­¦ç¿’" in phrase
    assert "Python" in phrase


# ... ä»–11ä»¶ï¼ˆå¢ƒç•Œå€¤ã€ç•°å¸¸ç³»ã€çµ±åˆãƒ†ã‚¹ãƒˆï¼‰
```

---

## 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 5.1 Pythonä¾å­˜

```txt
# requirements.txt ã«è¿½åŠ 
textblob==0.17.1        # ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆåˆ†æï¼ˆæ„Ÿæƒ…æ¨è«–ç”¨ï¼‰
scikit-learn==1.3.0     # ãƒˆãƒ”ãƒƒã‚¯æŠ½å‡ºãƒ»é¡ä¼¼åº¦è¨ˆç®—
```

### 5.2 æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- **core/dialogue_style.py**: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œ
- **core/self_reflection.py**: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯

---

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆTDDå®Ÿè£…ï¼‰

### 6.1 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ | å„ªå…ˆåº¦ |
|---------|---------|---------|--------------|--------|
| **å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œ** |
| AdaptiveDialogueStyle | `test_dialogue_style.py` | 25 | 95%ä»¥ä¸Š | ğŸ”´ High |
| **è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§** |
| SelfReflection | `test_self_reflection.py` | 15 | 95%ä»¥ä¸Š | ğŸ”´ High |
| DialogueCoherence | `test_self_reflection.py` | 15 | 90%ä»¥ä¸Š | ğŸ”´ High |
| TopicTracker | `test_self_reflection.py` | 15 | 90%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** |
| é•·æœŸè¨˜æ†¶é€£æº | `test_integration_reflection.py` | 10 | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| APIçµ±åˆ | `test_api_dialogue.py` | 10 | 85%ä»¥ä¸Š | ğŸŸ¡ Medium |
| **åˆè¨ˆ** | **6ãƒ•ã‚¡ã‚¤ãƒ«** | **90** | **å¹³å‡90%ä»¥ä¸Š** | - |

### 6.2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

#### åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/test_dialogue_style.py tests/test_self_reflection.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ --cov=core.dialogue_style --cov=core.self_reflection --cov-report=html --cov-report=term

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿
pytest tests/test_dialogue_style.py::test_style_init -v

# ãƒãƒ¼ã‚«ãƒ¼ã§å®Ÿè¡Œ
pytest -m unit -v  # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
pytest -m integration -v  # çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
```

#### TDDã‚µã‚¤ã‚¯ãƒ«ã§ã®å®Ÿè¡Œ

```bash
# 1. ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸå¾Œï¼ˆREDï¼‰
pytest tests/test_dialogue_style.py::test_style_init -v
# â†’ æœŸå¾…: FAILEDï¼ˆå®Ÿè£…å‰ï¼‰

# 2. æœ€å°é™ã®å®Ÿè£…å¾Œï¼ˆGREENï¼‰
pytest tests/test_dialogue_style.py::test_style_init -v
# â†’ æœŸå¾…: PASSED

# 3. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œï¼ˆREFACTORï¼‰
pytest tests/test_dialogue_style.py -v
# â†’ æœŸå¾…: å…¨ãƒ†ã‚¹ãƒˆ PASSED
```

---

## Week 1-2: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_dialogue_style.py`

**ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹**: `TestAdaptiveDialogueStyle`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ25ä»¶ï¼‰**:

#### 1. åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆ4ä»¶ï¼‰

```python
def test_style_init_default_parameters():
    """
    Given: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    When: AdaptiveDialogueStyleã‚’åˆæœŸåŒ–
    Then: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_001")
    
    assert style.user_id == "user_001"
    assert style.parameters["formality"] == 0.5
    assert style.parameters["verbosity"] == 0.5
    assert style.parameters["humor"] == 0.5
    assert style.parameters["technical_level"] == 0.5
    assert style.parameters["empathy"] == 0.7
    assert style.parameters["proactivity"] == 0.5

def test_style_init_load_from_profile():
    """
    Given: æ—¢å­˜ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
    When: AdaptiveDialogueStyleã‚’åˆæœŸåŒ–
    Then: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹
    """
    # äº‹å‰ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    import os
    os.makedirs("profiles", exist_ok=True)
    with open("profiles/user_002_style.json", "w") as f:
        json.dump({"formality": 0.8, "verbosity": 0.3}, f)
    
    style = AdaptiveDialogueStyle("user_002")
    
    assert style.parameters["formality"] == 0.8
    assert style.parameters["verbosity"] == 0.3

def test_style_init_nonexistent_profile():
    """
    Given: å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
    When: AdaptiveDialogueStyleã‚’åˆæœŸåŒ–
    Then: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä½¿ç”¨ã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("nonexistent_user")
    
    assert style.parameters["formality"] == 0.5
    assert style.parameters["verbosity"] == 0.5
```

#### 2. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’ãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰

```python
def test_learn_from_feedback_verbosity_increase():
    """
    Given: è©³ç´°å¸Œæœ›ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: verbosityãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¢—åŠ ã™ã‚‹
    """
    style = AdaptiveDialogueStyle("user_003")
    initial_verbosity = style.parameters["verbosity"]
    
    style.learn_from_feedback({
        "message": "ã‚‚ã£ã¨è©³ã—ãèª¬æ˜ã—ã¦ã»ã—ã„",
        "thumbs_up": True
    })
    
    assert style.parameters["verbosity"] > initial_verbosity
    assert style.parameters["verbosity"] <= 1.0

def test_learn_from_feedback_verbosity_decrease():
    """
    Given: ç°¡æ½”å¸Œæœ›ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: verbosityãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸›å°‘ã™ã‚‹
    """
    style = AdaptiveDialogueStyle("user_004")
    initial_verbosity = style.parameters["verbosity"]
    
    style.learn_from_feedback({
        "message": "ç°¡æ½”ã«èª¬æ˜ã—ã¦ãã ã•ã„",
        "thumbs_up": True
    })
    
    assert style.parameters["verbosity"] < initial_verbosity
    assert style.parameters["verbosity"] >= 0.0

def test_learn_from_feedback_technical_level_decrease():
    """
    Given: å°‚é–€ç”¨èªå¤šã™ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: technical_levelãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸›å°‘ã™ã‚‹
    """
    style = AdaptiveDialogueStyle("user_005")
    style.parameters["technical_level"] = 0.8
    initial_level = style.parameters["technical_level"]
    
    style.learn_from_feedback({
        "message": "ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„",
        "thumbs_up": True
    })
    
    assert style.parameters["technical_level"] < initial_level
    assert style.parameters["technical_level"] >= 0.0

def test_learn_from_feedback_specific_feedback():
    """
    Given: ç‰¹å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: æŒ‡å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_006")
    initial_formality = style.parameters["formality"]
    
    style.learn_from_feedback({
        "message": "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªæ„Ÿã˜ãŒã„ã„",
        "thumbs_up": True,
        "specific_feedback": {"formality": "-"}
    })
    
    assert style.parameters["formality"] < initial_formality

def test_learn_from_feedback_parameter_upper_bound():
    """
    Given: ä¸Šé™ã«é”ã—ã¦ã„ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    When: learn_from_feedback()ã§å¢—åŠ ã‚’è©¦ã¿ã‚‹
    Then: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ1.0ã‚’è¶…ãˆãªã„
    """
    style = AdaptiveDialogueStyle("user_007")
    style.parameters["verbosity"] = 1.0
    
    style.learn_from_feedback({
        "message": "ã‚‚ã£ã¨è©³ã—ã",
        "thumbs_up": True
    })
    
    assert style.parameters["verbosity"] == 1.0

def test_learn_from_feedback_parameter_lower_bound():
    """
    Given: ä¸‹é™ã«é”ã—ã¦ã„ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    When: learn_from_feedback()ã§æ¸›å°‘ã‚’è©¦ã¿ã‚‹
    Then: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ0.0ã‚’ä¸‹å›ã‚‰ãªã„
    """
    style = AdaptiveDialogueStyle("user_008")
    style.parameters["verbosity"] = 0.0
    
    style.learn_from_feedback({
        "message": "ç°¡æ½”ã«",
        "thumbs_up": True
    })
    
    assert style.parameters["verbosity"] == 0.0

def test_learn_from_feedback_saves_to_profile():
    """
    Given: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_009")
    style.learn_from_feedback({
        "message": "è©³ã—ã",
        "thumbs_up": True
    })
    
    # æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§èª­ã¿è¾¼ã¿ç¢ºèª
    style2 = AdaptiveDialogueStyle("user_009")
    assert style2.parameters["verbosity"] > 0.5
```

#### 3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰

```python
def test_generate_style_prompt_formal():
    """
    Given: ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_010")
    style.parameters["formality"] = 0.8
    
    prompt = style.generate_style_prompt()
    
    assert "ä¸å¯§" in prompt or "ç¤¼å„€æ­£ã—ã„" in prompt

def test_generate_style_prompt_casual():
    """
    Given: ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_011")
    style.parameters["formality"] = 0.2
    
    prompt = style.generate_style_prompt()
    
    assert "ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼" in prompt or "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«" in prompt

def test_generate_style_prompt_verbose():
    """
    Given: è©³ç´°ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: è©³ç´°ãªèª¬æ˜ã‚’ä¿ƒã™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_012")
    style.parameters["verbosity"] = 0.8
    
    prompt = style.generate_style_prompt()
    
    assert "è©³ç´°" in prompt or "å…·ä½“ä¾‹" in prompt

def test_generate_style_prompt_concise():
    """
    Given: ç°¡æ½”ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: ç°¡æ½”ãªèª¬æ˜ã‚’ä¿ƒã™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_013")
    style.parameters["verbosity"] = 0.2
    
    prompt = style.generate_style_prompt()
    
    assert "ç°¡æ½”" in prompt or "è¦ç‚¹" in prompt

def test_generate_style_prompt_humorous():
    """
    Given: ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’å«ã‚€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_014")
    style.parameters["humor"] = 0.8
    
    prompt = style.generate_style_prompt()
    
    assert "ãƒ¦ãƒ¼ãƒ¢ã‚¢" in prompt or "æ¥½ã—ã„" in prompt

def test_generate_style_prompt_technical():
    """
    Given: å°‚é–€çš„ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: å°‚é–€ç”¨èªã‚’å«ã‚€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_015")
    style.parameters["technical_level"] = 0.8
    
    prompt = style.generate_style_prompt()
    
    assert "å°‚é–€ç”¨èª" in prompt or "æŠ€è¡“çš„" in prompt

def test_generate_style_prompt_empathy():
    """
    Given: å…±æ„Ÿåº¦ã®é«˜ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: å…±æ„Ÿçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_016")
    style.parameters["empathy"] = 0.8
    
    prompt = style.generate_style_prompt()
    
    assert "å…±æ„Ÿ" in prompt or "å¯„ã‚Šæ·»ã„" in prompt

def test_generate_style_prompt_multiple_parameters():
    """
    Given: è¤‡æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
    When: generate_style_prompt()ã‚’å‘¼ã³å‡ºã™
    Then: è¤‡æ•°ã®æŒ‡ç¤ºã‚’å«ã‚€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_017")
    style.parameters["formality"] = 0.8
    style.parameters["verbosity"] = 0.8
    style.parameters["humor"] = 0.2
    
    prompt = style.generate_style_prompt()
    
    assert "ä¸å¯§" in prompt
    assert "è©³ç´°" in prompt
    assert "çœŸé¢ç›®" in prompt or "èª å®Ÿ" in prompt
```

#### 4. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰

```python
def test_parameter_bounds_extreme_values():
    """
    Given: æ¥µç«¯ãªå€¤ã§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    When: è¤‡æ•°å›ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é©ç”¨
    Then: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¢ƒç•Œå†…ã«ä¿ãŸã‚Œã‚‹
    """
    style = AdaptiveDialogueStyle("user_018")
    
    # ä¸Šé™ãƒ†ã‚¹ãƒˆ
    for _ in range(20):
        style.learn_from_feedback({"message": "è©³ã—ã", "thumbs_up": True})
    assert style.parameters["verbosity"] <= 1.0
    
    # ä¸‹é™ãƒ†ã‚¹ãƒˆ
    style.parameters["verbosity"] = 0.0
    for _ in range(20):
        style.learn_from_feedback({"message": "ç°¡æ½”ã«", "thumbs_up": True})
    assert style.parameters["verbosity"] >= 0.0

def test_empty_feedback_message():
    """
    Given: ç©ºã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    When: learn_from_feedback()ã‚’å‘¼ã³å‡ºã™
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„
    """
    style = AdaptiveDialogueStyle("user_019")
    
    style.learn_from_feedback({
        "message": "",
        "thumbs_up": True
    })
    
    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å¤‰æ›´ã•ã‚Œãªã„
    assert style.parameters["verbosity"] == 0.5

def test_invalid_parameter_name():
    """
    Given: ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å
    When: learn_from_feedback()ã§æŒ‡å®š
    Then: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ï¼ˆç„¡è¦–ã•ã‚Œã‚‹ï¼‰
    """
    style = AdaptiveDialogueStyle("user_020")
    
    style.learn_from_feedback({
        "message": "test",
        "specific_feedback": {"invalid_param": "+"}
    })
    
    # ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ç¢ºèª
    assert "invalid_param" not in style.parameters
```

---

## Week 3-4: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ - ãƒ†ã‚¹ãƒˆä»•æ§˜ï¼ˆTDDï¼‰

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_self_reflection.py`

**ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹**: `TestSelfReflection`, `TestDialogueCoherence`, `TestTopicTracker`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆ45ä»¶ï¼‰**:

#### 1. SelfReflection ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰

```python
class TestSelfReflection:
    """è‡ªå·±çœå¯Ÿã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ"""
    
    def test_reflect_on_conversation_success(self):
        """
        Given: ä¼šè©±å±¥æ­´
        When: reflect_on_conversation()ã‚’å‘¼ã³å‡ºã™
        Then: çœå¯ŸçµæœãŒè¿”ã•ã‚Œã‚‹
        """
        reflection = SelfReflection("lumina")
        
        conversation = [
            {"role": "user", "content": "ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„", "session_id": "sess_001"},
            {"role": "assistant", "content": "æ‰¿çŸ¥ã—ã¾ã—ãŸ", "session_id": "sess_001"}
        ]
        
        result = reflection.reflect_on_conversation(conversation)
        
        assert "timestamp" in result
        assert result["session_id"] == "sess_001"
        assert "reflection" in result
        assert "lessons_learned" in result
        assert isinstance(result["lessons_learned"], list)
    
    def test_reflect_on_conversation_extracts_lessons(self):
        """
        Given: ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ã»ã—ã„ã¨ã„ã†ä¼šè©±
        When: reflect_on_conversation()ã‚’å‘¼ã³å‡ºã™
        Then: technical_levelã‚’ä¸‹ã’ã‚‹ã¨ã„ã†å­¦ã³ãŒæŠ½å‡ºã•ã‚Œã‚‹
        """
        reflection = SelfReflection("lumina")
        
        conversation = [
            {"role": "user", "content": "ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„", "session_id": "sess_002"},
            {"role": "assistant", "content": "æ‰¿çŸ¥ã—ã¾ã—ãŸ", "session_id": "sess_002"}
        ]
        
        result = reflection.reflect_on_conversation(conversation)
        
        assert "technical_level ã‚’ä¸‹ã’ã‚‹" in result["lessons_learned"]
    
    def test_reflect_on_conversation_empty_history(self):
        """
        Given: ç©ºã®ä¼šè©±å±¥æ­´
        When: reflect_on_conversation()ã‚’å‘¼ã³å‡ºã™
        Then: ç©ºã®çœå¯ŸçµæœãŒè¿”ã•ã‚Œã‚‹
        """
        reflection = SelfReflection("lumina")
        
        result = reflection.reflect_on_conversation([])
        
        assert result["reflection"] == ""
        assert result["lessons_learned"] == []
    
    def test_reflect_on_conversation_no_user_messages(self):
        """
        Given: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„ä¼šè©±å±¥æ­´
        When: reflect_on_conversation()ã‚’å‘¼ã³å‡ºã™
        Then: ç©ºã®çœå¯ŸçµæœãŒè¿”ã•ã‚Œã‚‹
        """
        reflection = SelfReflection("lumina")
        
        conversation = [
            {"role": "assistant", "content": "ã“ã‚“ã«ã¡ã¯", "session_id": "sess_003"}
        ]
        
        result = reflection.reflect_on_conversation(conversation)
        
        assert result["lessons_learned"] == []
    
    def test_store_reflection(self):
        """
        Given: çœå¯Ÿçµæœ
        When: reflect_on_conversation()ã‚’å‘¼ã³å‡ºã™
        Then: çœå¯ŸãŒé•·æœŸè¨˜æ†¶ã«ä¿å­˜ã•ã‚Œã‚‹
        """
        reflection = SelfReflection("clarisse")
        
        conversation = [
            {"role": "user", "content": "è©³ã—ãæ•™ãˆã¦", "session_id": "sess_004"},
            {"role": "assistant", "content": "ã¯ã„", "session_id": "sess_004"}
        ]
        
        result = reflection.reflect_on_conversation(conversation)
        
        # ä¿å­˜å‡¦ç†ã¯ _store_reflection å†…ã§å®Ÿè¡Œæ¸ˆã¿
        assert result is not None
    
    def test_retrieve_past_lessons(self):
        """
        Given: éå»ã®å­¦ã³ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹
        When: retrieve_past_lessons()ã‚’å‘¼ã³å‡ºã™
        Then: é–¢é€£ã™ã‚‹éå»ã®å­¦ã³ãŒè¿”ã•ã‚Œã‚‹
        """
        reflection = SelfReflection("lumina")
        
        # äº‹å‰ã«çœå¯Ÿã‚’ä¿å­˜
        conversation = [
            {"role": "user", "content": "ã‚ã‹ã‚Šã‚„ã™ã", "session_id": "sess_005"},
            {"role": "assistant", "content": "æ‰¿çŸ¥", "session_id": "sess_005"}
        ]
        reflection.reflect_on_conversation(conversation)
        
        lessons = reflection.retrieve_past_lessons("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ€è¡“çš„ãªè³ªå•ã‚’ã—ã¦ã„ã‚‹")
        
        assert isinstance(lessons, list)
```

#### 2. DialogueCoherence ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰

```python
class TestDialogueCoherence:
    """å¯¾è©±ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ"""
    
    def test_check_consistency_no_contradiction(self):
        """
        Given: çŸ›ç›¾ã®ãªã„æ–°ã—ã„ç™ºè¨€
        When: check_consistency()ã‚’å‘¼ã³å‡ºã™
        Then: çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚Œãªã„
        """
        coherence = DialogueCoherence()
        
        history = [
            {"role": "assistant", "content": "ç§ã¯çŒ«ãŒå¥½ãã§ã™"}
        ]
        
        result = coherence.check_consistency("ç§ã¯çŠ¬ã‚‚å¥½ãã§ã™", history)
        
        assert result["contradiction_detected"] is False
        assert result["contradictory_past_statement"] is None
    
    def test_detect_contradiction_like_dislike(self):
        """
        Given: å¥½ãã¨è‹¦æ‰‹ã®çŸ›ç›¾
        When: _detect_contradiction()ã‚’å‘¼ã³å‡ºã™
        Then: çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚Œã‚‹
        """
        coherence = DialogueCoherence()
        
        assert coherence._detect_contradiction("ç§ã¯çŒ«ãŒå¥½ãã§ã™", "ç§ã¯çŒ«ãŒè‹¦æ‰‹ã§ã™")
    
    def test_detect_contradiction_no_contradiction(self):
        """
        Given: çŸ›ç›¾ã®ãªã„2ã¤ã®ç™ºè¨€
        When: _detect_contradiction()ã‚’å‘¼ã³å‡ºã™
        Then: çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚Œãªã„
        """
        coherence = DialogueCoherence()
        
        assert not coherence._detect_contradiction("ç§ã¯çŒ«ãŒå¥½ãã§ã™", "ç§ã¯çŠ¬ã‚‚å¥½ãã§ã™")
    
    def test_detect_contradiction_opposite_patterns(self):
        """
        Given: åå¯¾ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
        When: _detect_contradiction()ã‚’å‘¼ã³å‡ºã™
        Then: çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚Œã‚‹
        """
        coherence = DialogueCoherence()
        
        # å¾—æ„ã¨è‹¦æ‰‹
        assert coherence._detect_contradiction("ç§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒå¾—æ„ã§ã™", "ç§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒè‹¦æ‰‹ã§ã™")
        
        # è³›æˆã¨åå¯¾
        assert coherence._detect_contradiction("ãã®æ¡ˆã«è³›æˆã§ã™", "ãã®æ¡ˆã«åå¯¾ã§ã™")
    
    def test_generate_clarification(self):
        """
        Given: çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚ŒãŸ
        When: _generate_clarification()ã‚’å‘¼ã³å‡ºã™
        Then: æ˜ç¢ºåŒ–è³ªå•ãŒç”Ÿæˆã•ã‚Œã‚‹
        """
        coherence = DialogueCoherence()
        
        clarification = coherence._generate_clarification(
            "ç§ã¯çŒ«ãŒå¥½ãã§ã™",
            "ç§ã¯çŒ«ãŒè‹¦æ‰‹ã§ã™"
        )
        
        assert "ä»¥å‰" in clarification
        assert "çŒ«ãŒè‹¦æ‰‹" in clarification
        assert "çŒ«ãŒå¥½ã" in clarification
```

#### 3. TopicTracker ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰

```python
class TestTopicTracker:
    """ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ"""
    
    def test_detect_topic_shift_initial(self):
        """
        Given: åˆå›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
        When: detect_topic_shift()ã‚’å‘¼ã³å‡ºã™
        Then: ãƒˆãƒ”ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã€è»¢æ›ã¯æ¤œå‡ºã•ã‚Œãªã„
        """
        tracker = TopicTracker()
        
        result = tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„", {})
        
        assert result["shift_detected"] is False
        assert result["current_topic"] == "æ©Ÿæ¢°å­¦ç¿’"
        assert len(result["topic_history"]) == 1
    
    def test_detect_topic_shift_same_topic(self):
        """
        Given: åŒã˜ãƒˆãƒ”ãƒƒã‚¯ã®å…¥åŠ›
        When: detect_topic_shift()ã‚’å‘¼ã³å‡ºã™
        Then: è»¢æ›ã¯æ¤œå‡ºã•ã‚Œãªã„
        """
        tracker = TopicTracker()
        tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„", {})
        
        result = tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã®ãƒ¢ãƒ‡ãƒ«ã¯ï¼Ÿ", {})
        
        assert result["shift_detected"] is False
        assert result["current_topic"] == "æ©Ÿæ¢°å­¦ç¿’"
    
    def test_detect_topic_shift_different_topic(self):
        """
        Given: ç•°ãªã‚‹ãƒˆãƒ”ãƒƒã‚¯ã®å…¥åŠ›
        When: detect_topic_shift()ã‚’å‘¼ã³å‡ºã™
        Then: è»¢æ›ãŒæ¤œå‡ºã•ã‚Œã€ãƒˆãƒ”ãƒƒã‚¯å±¥æ­´ãŒæ›´æ–°ã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„", {})
        
        result = tracker.detect_topic_shift("Pythonã®ã‚³ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦", {})
        
        assert result["shift_detected"] is True
        assert result["current_topic"] == "Python"
        assert len(result["topic_history"]) == 2
        assert result["topic_history"][0]["topic"] == "æ©Ÿæ¢°å­¦ç¿’"
        assert result["topic_history"][0]["end"] is not None
    
    def test_generate_transition_phrase(self):
        """
        Given: æ—§ãƒˆãƒ”ãƒƒã‚¯ã¨æ–°ãƒˆãƒ”ãƒƒã‚¯
        When: generate_transition_phrase()ã‚’å‘¼ã³å‡ºã™
        Then: è»¢æ›ãƒ•ãƒ¬ãƒ¼ã‚ºãŒç”Ÿæˆã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        
        phrase = tracker.generate_transition_phrase("æ©Ÿæ¢°å­¦ç¿’", "Python")
        
        assert "æ©Ÿæ¢°å­¦ç¿’" in phrase
        assert "Python" in phrase
    
    def test_suggest_topic_return(self):
        """
        Given: 2ã¤ä»¥ä¸Šã®ãƒˆãƒ”ãƒƒã‚¯å±¥æ­´
        When: suggest_topic_return()ã‚’å‘¼ã³å‡ºã™
        Then: ä»¥å‰ã®ãƒˆãƒ”ãƒƒã‚¯ã¸ã®æˆ»ã‚Šææ¡ˆãŒè¿”ã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦", {})
        tracker.detect_topic_shift("Pythonã«ã¤ã„ã¦", {})
        
        suggestion = tracker.suggest_topic_return()
        
        assert suggestion is not None
        assert "æ©Ÿæ¢°å­¦ç¿’" in suggestion
    
    def test_suggest_topic_return_insufficient_history(self):
        """
        Given: ãƒˆãƒ”ãƒƒã‚¯å±¥æ­´ãŒ1ã¤ä»¥ä¸‹
        When: suggest_topic_return()ã‚’å‘¼ã³å‡ºã™
        Then: NoneãŒè¿”ã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        tracker.detect_topic_shift("æ©Ÿæ¢°å­¦ç¿’ã«ã¤ã„ã¦", {})
        
        suggestion = tracker.suggest_topic_return()
        
        assert suggestion is None
    
    def test_extract_topic_keyword_match(self):
        """
        Given: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ãƒ†ã‚­ã‚¹ãƒˆ
        When: _extract_topic()ã‚’å‘¼ã³å‡ºã™
        Then: å¯¾å¿œã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ãŒè¿”ã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        
        assert tracker._extract_topic("æ©Ÿæ¢°å­¦ç¿’ã®ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦") == "æ©Ÿæ¢°å­¦ç¿’"
        assert tracker._extract_topic("Pythonã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã") == "Python"
        assert tracker._extract_topic("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆ") == "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹"
    
    def test_extract_topic_no_match(self):
        """
        Given: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ä¸€è‡´ã—ãªã„ãƒ†ã‚­ã‚¹ãƒˆ
        When: _extract_topic()ã‚’å‘¼ã³å‡ºã™
        Then: "ãã®ä»–"ãŒè¿”ã•ã‚Œã‚‹
        """
        tracker = TopicTracker()
        
        assert tracker._extract_topic("ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­") == "ãã®ä»–"
```

---

## ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ä»•æ§˜

### conftest.py ã®æ‹¡å¼µ

```python
# tests/conftest.pyï¼ˆæ‹¡å¼µï¼‰

import pytest
import tempfile
import os
import json
from unittest.mock import Mock, MagicMock

from core.dialogue_style import AdaptiveDialogueStyle
from core.self_reflection import SelfReflection, DialogueCoherence, TopicTracker
from memory.long_term import LongTermMemory

@pytest.fixture
def temp_profile_dir():
    """ä¸€æ™‚çš„ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª"""
    temp_dir = tempfile.mkdtemp()
    original_dir = os.getcwd()
    os.chdir(temp_dir)
    os.makedirs("profiles", exist_ok=True)
    yield temp_dir
    os.chdir(original_dir)
    import shutil
    shutil.rmtree(temp_dir)

@pytest.fixture
def dialogue_style(temp_profile_dir):
    """AdaptiveDialogueStyleã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return AdaptiveDialogueStyle("test_user")

@pytest.fixture
def mock_long_term_memory():
    """LongTermMemoryã®ãƒ¢ãƒƒã‚¯"""
    mock = Mock(spec=LongTermMemory)
    mock.store = Mock(return_value={"memory_id": "mem_001"})
    mock.search = Mock(return_value=[])
    return mock

@pytest.fixture
def self_reflection(mock_long_term_memory):
    """SelfReflectionã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰"""
    reflection = SelfReflection("test_character")
    reflection.long_term_memory = mock_long_term_memory
    return reflection

@pytest.fixture
def dialogue_coherence(mock_long_term_memory):
    """DialogueCoherenceã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰"""
    coherence = DialogueCoherence()
    coherence.long_term_memory = mock_long_term_memory
    return coherence

@pytest.fixture
def topic_tracker():
    """TopicTrackerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹"""
    return TopicTracker()
```

---

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥

### TDDå®Ÿè£…é †åº

1. **Week 1-2: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«å‹•çš„èª¿æ•´**
   - 1æ—¥ç›®: åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆ4ä»¶ï¼‰â†’ å®Ÿè£…
   - 2æ—¥ç›®: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’ãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰â†’ å®Ÿè£…
   - 3æ—¥ç›®: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆï¼ˆ8ä»¶ï¼‰â†’ å®Ÿè£…
   - 4æ—¥ç›®: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ5ä»¶ï¼‰â†’ å®Ÿè£…ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

2. **Week 3-4: è‡ªå·±çœå¯Ÿãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯**
   - 1-2æ—¥ç›®: SelfReflectionãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰â†’ å®Ÿè£…
   - 3æ—¥ç›®: DialogueCoherenceãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰â†’ å®Ÿè£…
   - 4æ—¥ç›®: TopicTrackerãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰â†’ å®Ÿè£…ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### ãƒ†ã‚¹ãƒˆå“è³ªåŸºæº–

**å¿…é ˆè¦ä»¶**:
- âœ… **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100%ï¼ˆå…¨90ä»¶ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼‰
- âœ… **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Šï¼ˆå¹³å‡ï¼‰
- âœ… **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: å…¨ãƒ†ã‚¹ãƒˆ3åˆ†ä»¥å†…
- âœ… **ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ï¼ˆLongTermMemoryç­‰ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

**TDDã‚µã‚¤ã‚¯ãƒ«éµå®ˆ**:
- âœ… RED: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã‚‹
- âœ… GREEN: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ã„ã‚‹
- âœ… REFACTOR: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã‚‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹

---

## 7. æˆæœç‰©

### 7.1 å®Ÿè£…ã‚³ãƒ¼ãƒ‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `core/dialogue_style.py` (250è¡Œ)
- `core/self_reflection.py` (300è¡Œ)
- **åˆè¨ˆ**: 550è¡Œ

### 7.2 ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:
- `tests/test_dialogue_style.py` (25ä»¶)
- `tests/test_self_reflection.py` (45ä»¶)
- `tests/test_integration_reflection.py` (10ä»¶)
- `tests/test_api_dialogue.py` (10ä»¶)
- **åˆè¨ˆ**: 90ä»¶

### 7.3 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docks/å®Œäº†å ±å‘Š/Phase5_å®Œäº†ã‚µãƒãƒªãƒ¼.md`
- APIä»•æ§˜æ›¸æ›´æ–°

### 7.4 ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

- [ ] å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œå‹•ä½œç¢ºèª
- [ ] è‡ªå·±çœå¯Ÿãƒ»çŸ›ç›¾æ¤œå‡ºãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ç²¾åº¦ > 80%
- [ ] å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ90ä»¶ï¼‰
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ > 90%

---

## 8. Phase 5æˆåŠŸåŸºæº–

### TDDå®Ÿè£…ã®æˆåŠŸåŸºæº–

**å¿…é ˆè¦ä»¶**:
- âœ… **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å…¨æ©Ÿèƒ½ãŒãƒ†ã‚¹ãƒˆé§†å‹•ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- âœ… **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100%ï¼ˆå…¨90ä»¶ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼‰
- âœ… **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Šï¼ˆå¹³å‡ï¼‰
- âœ… **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: å…¨ãƒ†ã‚¹ãƒˆ3åˆ†ä»¥å†…
- âœ… **ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- âœ… **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ï¼ˆLongTermMemoryç­‰ï¼‰ã¯ãƒ¢ãƒƒã‚¯ã§åˆ†é›¢

**TDDã‚µã‚¤ã‚¯ãƒ«éµå®ˆ**:
- âœ… RED: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã‚‹
- âœ… GREEN: æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ã„ã‚‹
- âœ… REFACTOR: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã‚‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹

### å®šé‡ç›®æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|----------|
| **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡** | **100%** | pytestï¼ˆå…¨90ä»¶ï¼‰ |
| **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸** | **90%ä»¥ä¸Š** | pytest-cov |
| **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“** | **< 3åˆ†** | pytest --durations |
| å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œç²¾åº¦ | > 85% | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è©•ä¾¡ |
| ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡ç²¾åº¦ | > 80% | ãƒˆãƒ”ãƒƒã‚¯æ¤œå‡ºãƒ†ã‚¹ãƒˆ |
| çŸ›ç›¾æ¤œå‡ºç²¾åº¦ | > 75% | çŸ›ç›¾æ¤œå‡ºãƒ†ã‚¹ãƒˆ |

### å®šæ€§ç›®æ¨™

âœ… **TDDå®Ÿè£…å®Œäº†**: å…¨æ©Ÿèƒ½ãŒãƒ†ã‚¹ãƒˆé§†å‹•ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
âœ… **ãƒ†ã‚¹ãƒˆä»•æ§˜å®Œå‚™**: å…¨90ä»¶ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
âœ… **å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œå‹•ä½œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹ã‚‰å­¦ç¿’
âœ… **è‡ªå·±çœå¯Ÿæ©Ÿèƒ½å‹•ä½œ**: ä¼šè©±æŒ¯ã‚Šè¿”ã‚Šã¨ãƒ¡ã‚¿èªçŸ¥
âœ… **çŸ›ç›¾æ¤œå‡ºæ©Ÿèƒ½å‹•ä½œ**: éå»ç™ºè¨€ã¨ã®ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯
âœ… **ãƒˆãƒ”ãƒƒã‚¯è¿½è·¡æ©Ÿèƒ½å‹•ä½œ**: è©±é¡Œã®æµã‚Œç®¡ç†

---

**Phase 5 å®Ÿè£…å®Œäº†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼é©å¿œå‹å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ãŒæ•´ã„ã¾ã—ãŸã€‚