# Phase 4 å®Ÿè£…ä»•æ§˜æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: LlmMultiChat3  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 4 - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£… + è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ  
**æœŸé–“**: 8é€±é–“ï¼ˆ2éƒ¨æ§‹æˆï¼‰  
**ä½œæˆæ—¥**: 2025-11-20  
**Phase 1-3çµ±åˆå®Œäº†**: å®Ÿæ–½ä¸­

---

## ç›®æ¬¡

1. [Phase 4æ¦‚è¦](#1-phase-4æ¦‚è¦)
2. [å‰ææ¡ä»¶](#2-å‰ææ¡ä»¶)
3. [Part A: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆWeek 1-4ï¼‰](#3-part-a-ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…week-1-4)
4. [Part B: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é«˜åº¦æ©Ÿèƒ½ï¼ˆWeek 5-8ï¼‰](#4-part-b-ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é«˜åº¦æ©Ÿèƒ½week-5-8)
5. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#5-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
6. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#6-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
7. [ãƒ†ã‚¹ãƒˆè¨ˆç”»](#7-ãƒ†ã‚¹ãƒˆè¨ˆç”»)
8. [ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥](#8-ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥)

---

## 1. Phase 4æ¦‚è¦

### 1.1 ç›®çš„

Phase 4ã¯**2ã¤ã®ãƒ‘ãƒ¼ãƒˆ**ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ï¼š

**Part Aï¼ˆWeek 1-4ï¼‰**: Phase 1-3çµ±åˆå¾Œã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- React SPA + WebSocket UIã®æ§‹ç¯‰
- JWTèªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¼šè©±UIãƒ»è¨˜æ†¶ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**Part Bï¼ˆWeek 5-8ï¼‰**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é«˜åº¦æ©Ÿèƒ½ã®è¿½åŠ 
- é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSQLite Graphï¼‰
- 8åŸºæœ¬æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«ï¼ˆPlutchikï¼‰

### 1.2 å…¨ä½“ç›®æ¨™

| ã‚«ãƒ†ã‚´ãƒª | ç›®æ¨™ | Priority |
|---------|------|----------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | React SPAå®Œå…¨å®Ÿè£… | ğŸ”´ High |
| **èªè¨¼UI** | JWTèªè¨¼ãƒ•ãƒ­ãƒ¼ | ğŸ”´ High |
| **ä¼šè©±UI** | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ | ğŸ”´ High |
| **è¨˜æ†¶æ‹¡å¼µ** | é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ  | ğŸŸ¡ Medium |
| **æ„Ÿæƒ…åŸºç›¤** | 8åŸºæœ¬æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ« | ğŸŸ¡ Medium |

### 1.3 æˆæœç‰©

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆPart Aï¼‰**:
- React SPAï¼ˆç´„3,000è¡Œ TypeScriptï¼‰
- 15ç”»é¢ãƒ»30ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- E2Eãƒ†ã‚¹ãƒˆï¼ˆCypressï¼‰

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPart Bï¼‰**:
- é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ400è¡Œ Pythonï¼‰
- æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«ï¼ˆ300è¡Œ Pythonï¼‰
- 35çµ±åˆãƒ†ã‚¹ãƒˆ

---

## 2. å‰ææ¡ä»¶

### 2.1 Phase 1-3çµ±åˆå®Œäº†

âœ… Phase 1: LangGraphã‚³ã‚¢ãƒ»5éšå±¤è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ   
âœ… Phase 2: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£  
âœ… Phase 3: REST/WebSocket APIï¼ˆ23ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰  
âœ… **Phase 1-3çµ±åˆ**: [`services/chat_service.py`](../../services/chat_service.py:1), [`services/memory_service.py`](../../services/memory_service.py:1)

### 2.2 åˆ©ç”¨å¯èƒ½ãªAPI

**èªè¨¼APIï¼ˆ6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰**:
- `POST /api/v1/auth/register`
- `POST /api/v1/auth/login`
- `POST /api/v1/auth/refresh`
- `GET /api/v1/auth/profile`
- `POST /api/v1/auth/change-password`
- `DELETE /api/v1/auth/delete`

**ä¼šè©±APIï¼ˆ6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰**:
- `POST /api/v1/chat/`
- `POST /api/v1/chat/stream`
- `GET /api/v1/chat/history`
- `GET /api/v1/chat/sessions`
- `GET /api/v1/chat/sessions/{session_id}`
- `DELETE /api/v1/chat/sessions/{session_id}/clear`

**è¨˜æ†¶APIï¼ˆ7ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰**:
- `POST /api/v1/memory/search`
- `POST /api/v1/memory/store`
- `DELETE /api/v1/memory/delete/{memory_id}`
- `GET /api/v1/memory/stats`
- `GET /api/v1/memory/sessions/{session_id}`
- `POST /api/v1/memory/flush` (admin)
- `GET /api/v1/memory/health`

**WebSocket API**:
- `WS /ws/chat`

---

## 3. Part A: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆWeek 1-4ï¼‰

### 3.1 Week 1: ReactåŸºç›¤ãƒ»èªè¨¼UI

#### 3.1.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ common/          # Button, Input, Card, Loading
â”‚   â”‚   â”œâ”€â”€ layout/          # Header, Sidebar, Footer
â”‚   â”‚   â””â”€â”€ auth/            # LoginForm, RegisterForm, ProfileCard
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ RegisterPage.tsx
â”‚   â”‚   â”œâ”€â”€ ChatPage.tsx
â”‚   â”‚   â””â”€â”€ DashboardPage.tsx
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts           # Axios client
â”‚   â”‚   â”œâ”€â”€ auth.service.ts  # èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ chat.service.ts  # ä¼šè©±ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â””â”€â”€ websocket.service.ts # WebSocketã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”œâ”€â”€ authSlice.ts     # Reduxèªè¨¼ã‚¹ãƒ©ã‚¤ã‚¹
â”‚   â”‚   â”œâ”€â”€ chatSlice.ts     # Reduxä¼šè©±ã‚¹ãƒ©ã‚¤ã‚¹
â”‚   â”‚   â””â”€â”€ store.ts         # Redux Store
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â””â”€â”€ useChat.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ auth.types.ts
â”‚   â”‚   â”œâ”€â”€ chat.types.ts
â”‚   â”‚   â””â”€â”€ memory.types.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ localStorage.ts
â”‚   â”‚   â””â”€â”€ formatters.ts
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ index.tsx
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

#### 3.1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆpackage.jsonï¼‰

```json
{
  "name": "llmmultichat3-frontend",
  "version": "4.0.0",
  "type": "module",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@reduxjs/toolkit": "^2.0.0",
    "react-redux": "^9.0.0",
    "axios": "^1.6.0",
    "@tanstack/react-query": "^5.10.0",
    "socket.io-client": "^4.6.0",
    "recharts": "^2.10.0",
    "react-markdown": "^9.0.0",
    "lucide-react": "^0.292.0",
    "tailwindcss": "^3.3.0",
    "clsx": "^2.0.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "cypress": "^13.6.0",
    "@testing-library/react": "^14.1.0"
  }
}
```

#### 3.1.3 ä¸»è¦å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

**1. API Clientï¼ˆ150è¡Œï¼‰**

```typescript
// src/services/api.ts
import axios, { AxiosInstance } from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000';

class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: API_BASE_URL,
      timeout: 30000,
      headers: { 'Content-Type': 'application/json' },
    });

    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆJWTè‡ªå‹•ä»˜ä¸ï¼‰
    this.client.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('access_token');
        if (token) config.headers.Authorization = `Bearer ${token}`;
        return config;
      }
    );

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ï¼‰
    this.client.interceptors.response.use(
      (response) => response,
      async (error) => {
        const originalRequest = error.config;
        if (error.response?.status === 401 && !originalRequest._retry) {
          originalRequest._retry = true;
          const refreshToken = localStorage.getItem('refresh_token');
          if (refreshToken) {
            const { data } = await this.client.post('/api/v1/auth/refresh', { refresh_token: refreshToken });
            localStorage.setItem('access_token', data.access_token);
            originalRequest.headers.Authorization = `Bearer ${data.access_token}`;
            return this.client(originalRequest);
          }
        }
        return Promise.reject(error);
      }
    );
  }

  get client() { return this.client; }
}

export const apiClient = new ApiClient().client;
```

**2. èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ300è¡Œï¼‰**

```typescript
// src/services/auth.service.ts
import { apiClient } from './api';
import { LoginCredentials, RegisterData, User } from '../types/auth.types';

export class AuthService {
  async register(data: RegisterData): Promise<{ user_id: string }> {
    const response = await apiClient.post('/api/v1/auth/register', data);
    return response.data;
  }

  async login(credentials: LoginCredentials): Promise<{
    access_token: string;
    refresh_token: string;
  }> {
    const response = await apiClient.post('/api/v1/auth/login', credentials);
    const { access_token, refresh_token } = response.data;
    localStorage.setItem('access_token', access_token);
    localStorage.setItem('refresh_token', refresh_token);
    return response.data;
  }

  async logout(): Promise<void> {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
  }

  async getProfile(): Promise<User> {
    const response = await apiClient.get('/api/v1/auth/profile');
    return response.data;
  }

  isAuthenticated(): boolean {
    return !!localStorage.getItem('access_token');
  }
}

export const authService = new AuthService();
```

**3. Redux Auth Sliceï¼ˆ250è¡Œï¼‰**

```typescript
// src/store/authSlice.ts
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { authService } from '../services/auth.service';
import { User, LoginCredentials } from '../types/auth.types';

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  error: string | null;
}

export const loginAsync = createAsyncThunk(
  'auth/login',
  async (credentials: LoginCredentials, { rejectWithValue }) => {
    try {
      await authService.login(credentials);
      return await authService.getProfile();
    } catch (error: any) {
      return rejectWithValue(error.response?.data?.detail || 'Login failed');
    }
  }
);

const authSlice = createSlice({
  name: 'auth',
  initialState: {
    user: null,
    isAuthenticated: authService.isAuthenticated(),
    isLoading: false,
    error: null,
  } as AuthState,
  reducers: {
    logout: (state) => {
      authService.logout();
      state.user = null;
      state.isAuthenticated = false;
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(loginAsync.fulfilled, (state, action) => {
        state.isAuthenticated = true;
        state.user = action.payload;
      });
  },
});

export const { logout } = authSlice.actions;
export default authSlice.reducer;
```

### 3.2 Week 2: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¼šè©±UI

#### 3.2.1 WebSocketã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ400è¡Œï¼‰

```typescript
// src/services/websocket.service.ts
import { io, Socket } from 'socket.io-client';

export class WebSocketService {
  private socket: Socket | null = null;
  private messageHandlers: ((message: any) => void)[] = [];

  connect(token: string): void {
    this.socket = io('ws://localhost:8000', {
      path: '/ws/chat',
      auth: { token },
      transports: ['websocket'],
    });

    this.socket.on('message', (data) => {
      this.messageHandlers.forEach((handler) => handler(data));
    });
  }

  disconnect(): void {
    if (this.socket) {
      this.socket.disconnect();
      this.socket = null;
    }
  }

  sendMessage(message: string, sessionId: string): void {
    if (this.socket) {
      this.socket.emit('chat', {
        type: 'chat',
        user_input: message,
        session_id: sessionId,
      });
    }
  }

  onMessage(handler: (message: any) => void): void {
    this.messageHandlers.push(handler);
  }
}

export const websocketService = new WebSocketService();
```

#### 3.2.2 ãƒãƒ£ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆ500è¡Œï¼‰

```typescript
// src/components/chat/ChatWindow.tsx
import React, { useEffect, useState } from 'react';
import { useDispatch } from 'react-redux';
import { websocketService } from '../../services/websocket.service';
import { addMessage } from '../../store/chatSlice';
import { MessageList } from './MessageList';
import { MessageInput } from './MessageInput';

export const ChatWindow: React.FC = () => {
  const dispatch = useDispatch();
  const [isTyping, setIsTyping] = useState(false);

  useEffect(() => {
    const handleMessage = (data: any) => {
      if (data.type === 'chunk') {
        setIsTyping(true);
        dispatch(addMessage({
          id: Date.now().toString(),
          content: data.content,
          role: 'assistant',
          timestamp: new Date().toISOString(),
        }));
        setTimeout(() => setIsTyping(false), 1000);
      }
    };

    websocketService.onMessage(handleMessage);
    return () => { /* cleanup */ };
  }, [dispatch]);

  const handleSendMessage = (content: string) => {
    dispatch(addMessage({
      id: Date.now().toString(),
      content,
      role: 'user',
      timestamp: new Date().toISOString(),
    }));
    websocketService.sendMessage(content, 'session-001');
  };

  return (
    <div className="flex flex-col h-screen">
      <div className="flex-1 overflow-y-auto p-4">
        <MessageList messages={[]} />
        {isTyping && <div>å…¥åŠ›ä¸­...</div>}
      </div>
      <MessageInput onSend={handleSendMessage} />
    </div>
  );
};
```

### 3.3 Week 3: è¨˜æ†¶ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

#### 3.3.1 è¨˜æ†¶çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆ400è¡Œï¼‰

```typescript
// src/components/dashboard/MemoryDashboard.tsx
import React, { useEffect, useState } from 'react';
import { apiClient } from '../../services/api';
import { BarChart, Bar, XAxis, YAxis, Tooltip } from 'recharts';

export const MemoryDashboard: React.FC = () => {
  const [stats, setStats] = useState<any>(null);

  useEffect(() => {
    const fetchStats = async () => {
      const response = await apiClient.get('/api/v1/memory/stats');
      setStats(response.data);
    };
    fetchStats();
  }, []);

  if (!stats) return <div>Loading...</div>;

  return (
    <div className="p-4">
      <h2 className="text-2xl font-bold mb-4">è¨˜æ†¶çµ±è¨ˆ</h2>
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white p-4 rounded shadow">
          <h3>ç·è¨˜æ†¶æ•°</h3>
          <p className="text-3xl">{stats.total_memories}</p>
        </div>
        <div className="bg-white p-4 rounded shadow">
          <h3>éšå±¤åˆ¥è¨˜æ†¶</h3>
          <BarChart width={300} height={200} data={Object.entries(stats.by_layer).map(([k, v]) => ({ name: k, value: v }))}>
            <XAxis dataKey="name" />
            <YAxis />
            <Tooltip />
            <Bar dataKey="value" fill="#0ea5e9" />
          </BarChart>
        </div>
      </div>
    </div>
  );
};
```

### 3.4 Week 4: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

#### 3.4.1 E2Eãƒ†ã‚¹ãƒˆï¼ˆCypressï¼‰

```typescript
// cypress/e2e/auth.cy.ts
describe('èªè¨¼ãƒ•ãƒ­ãƒ¼', () => {
  it('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', () => {
    cy.visit('/login');
    cy.get('input[type="email"]').type('test@example.com');
    cy.get('input[type="password"]').type('password123');
    cy.get('button[type="submit"]').click();
    cy.url().should('include', '/chat');
  });

  it('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ', () => {
    cy.visit('/chat');
    cy.get('[data-testid="logout-button"]').click();
    cy.url().should('include', '/login');
  });
});
```

```typescript
// cypress/e2e/chat.cy.ts
describe('ä¼šè©±ãƒ•ãƒ­ãƒ¼', () => {
  beforeEach(() => {
    cy.login('test@example.com', 'password123');
  });

  it('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡', () => {
    cy.visit('/chat');
    cy.get('[data-testid="message-input"]').type('ã“ã‚“ã«ã¡ã¯');
    cy.get('[data-testid="send-button"]').click();
    cy.contains('ã“ã‚“ã«ã¡ã¯').should('be.visible');
  });
});
```

#### 3.4.2 Dockerãƒ‡ãƒ—ãƒ­ã‚¤

```dockerfile
# Dockerfile.frontend
FROM node:18-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.frontend
    ports:
      - "3000:80"
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on:
      - backend

  backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/llm
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
```

---

## 4. Part B: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é«˜åº¦æ©Ÿèƒ½ï¼ˆWeek 5-8ï¼‰

### 4.1 Week 5-6: é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ 

#### 4.1.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: `docks/ä»•æ§˜æ›¸/05_ä¼šè©±LLM_é€£æƒ³è¨˜æ†¶ä»•æ§˜.md`

**ä¸»è¦æ©Ÿèƒ½**:
1. **SQLite Graphå®Ÿè£…**
   - ãƒãƒ¼ãƒ‰ç®¡ç†ï¼ˆæ¦‚å¿µãƒ»ãƒˆãƒ”ãƒƒã‚¯ãƒ»æ„Ÿæƒ…ï¼‰
   - ã‚¨ãƒƒã‚¸ç®¡ç†ï¼ˆé–¢é€£æ€§ãƒ»å¼·åº¦ï¼‰
   - å†å¸°CTEé€£æƒ³æ¤œç´¢

2. **å­¦ç¿’ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **
   - ãƒ˜ãƒƒãƒ–ã®æ³•å‰‡ï¼ˆå…±èµ·å¼·åŒ–ï¼‰
   - æ™‚é–“çš„è¿‘æ¥æ€§å­¦ç¿’
   - æ„Ÿæƒ…çš„é–¢é€£å­¦ç¿’

3. **å¿˜å´æ›²ç·š**
   - æœªä½¿ç”¨è¨˜æ†¶ã®æ¸›è¡°
   - å¼±ã„é–¢é€£æ€§ã®è‡ªå‹•å‰Šé™¤

#### 4.1.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```python
# memory/associative.py (400è¡Œ)
class AssociativeMemory:
    """é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ."""
    
    def __init__(self, db_path: str = "memory/associative.db"):
        self.db = SQLiteGraph(db_path)
    
    def add_concept(
        self,
        concept: str,
        embedding: List[float],
        metadata: Dict[str, Any]
    ) -> str:
        """æ¦‚å¿µè¿½åŠ ."""
        return self.db.create_node(
            label="concept",
            properties={
                "name": concept,
                "embedding": embedding,
                "metadata": metadata,
                "created_at": time.time(),
                "activation_count": 0
            }
        )
    
    def link_concepts(
        self,
        concept_a: str,
        concept_b: str,
        relationship_type: str,
        strength: float = 1.0
    ) -> str:
        """æ¦‚å¿µé–¢é€£ä»˜ã‘."""
        return self.db.create_relationship(
            from_node=concept_a,
            to_node=concept_b,
            rel_type=relationship_type,
            properties={"strength": strength, "co_occurrence": 1}
        )
    
    def retrieve_associated_concepts(
        self,
        trigger: str,
        depth: int = 3,
        threshold: float = 0.3
    ) -> List[Dict[str, Any]]:
        """é€£æƒ³æ¤œç´¢."""
        return self.db.find_associated_concepts(
            start_concept=trigger,
            depth=depth,
            threshold=threshold
        )
    
    def strengthen_association(
        self,
        concept_a: str,
        concept_b: str,
        delta: float = 0.1
    ) -> None:
        """ãƒ˜ãƒƒãƒ–ã®æ³•å‰‡: å…±èµ·å¼·åŒ–."""
        edge = self.db.get_edge(concept_a, concept_b)
        new_strength = min(edge['strength'] + delta, 10.0)
        self.db.update_edge(edge['id'], {"strength": new_strength})
    
    def decay_inactive_associations(
        self,
        days_threshold: int = 30,
        decay_rate: float = 0.1
    ) -> int:
        """å¿˜å´æ›²ç·šå‡¦ç†."""
        cutoff = time.time() - (days_threshold * 86400)
        inactive_edges = self.db.query("""
            SELECT id, strength FROM edges
            WHERE last_activated < ? AND strength > 0.1
        """, (cutoff,))
        
        for edge in inactive_edges:
            new_strength = max(edge['strength'] - decay_rate, 0.0)
            if new_strength < 0.1:
                self.db.delete_edge(edge['id'])
            else:
                self.db.update_edge(edge['id'], {"strength": new_strength})
        
        return len(inactive_edges)


class SQLiteGraph:
    """SQLite-based graph database."""
    
    def __init__(self, db_path: str):
        self.conn = sqlite3.connect(db_path)
        self._init_schema()
    
    def _init_schema(self):
        """ã‚¹ã‚­ãƒ¼ãƒåˆæœŸåŒ–."""
        self.conn.executescript("""
            CREATE TABLE IF NOT EXISTS nodes (
                id INTEGER PRIMARY KEY,
                name TEXT UNIQUE,
                type TEXT,
                metadata JSON,
                created_at INTEGER,
                activation_count INTEGER DEFAULT 0,
                emotional_valence REAL DEFAULT 0.0
            );
            
            CREATE TABLE IF NOT EXISTS edges (
                id INTEGER PRIMARY KEY,
                from_id INTEGER,
                to_id INTEGER,
                rel_type TEXT,
                strength REAL DEFAULT 1.0,
                co_occurrence INTEGER DEFAULT 1,
                last_activated INTEGER,
                FOREIGN KEY(from_id) REFERENCES nodes(id),
                FOREIGN KEY(to_id) REFERENCES nodes(id)
            );
            
            CREATE INDEX IF NOT EXISTS idx_nodes_name ON nodes(name);
            CREATE INDEX IF NOT EXISTS idx_edges_from ON edges(from_id);
            CREATE INDEX IF NOT EXISTS idx_edges_to ON edges(to_id);
        """)
    
    def find_associated_concepts(
        self,
        start_concept: str,
        depth: int,
        threshold: float
    ) -> List[Dict[str, Any]]:
        """å†å¸°CTEé€£æƒ³æ¤œç´¢."""
        query = """
            WITH RECURSIVE associated AS (
                -- ãƒ™ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
                SELECT n.id, n.name, n.type, 0 AS depth, 1.0 AS strength
                FROM nodes n
                WHERE n.name = ?
                
                UNION
                
                -- å†å¸°ã‚±ãƒ¼ã‚¹
                SELECT n.id, n.name, n.type, a.depth + 1, e.strength
                FROM associated a
                JOIN edges e ON a.id = e.from_id
                JOIN nodes n ON e.to_id = n.id
                WHERE a.depth < ? AND e.strength >= ?
            )
            SELECT DISTINCT name, type, depth, strength
            FROM associated
            ORDER BY depth, strength DESC
        """
        
        cursor = self.conn.execute(query, (start_concept, depth, threshold))
        return [dict(zip(['name', 'type', 'depth', 'strength'], row)) for row in cursor.fetchall()]
```

#### 4.1.3 APIè¿½åŠ 

```python
# api/routes/memory.py ã«è¿½åŠ 

from memory.associative import AssociativeMemory

associative_memory = AssociativeMemory()

@router.post("/api/v1/memory/associate")
async def create_association(
    concept_a: str,
    concept_b: str,
    strength: float = 1.0,
    current_user: User = Depends(get_current_user)
):
    """2ã¤ã®æ¦‚å¿µã‚’é–¢é€£ä»˜ã‘."""
    edge_id = associative_memory.link_concepts(
        concept_a=concept_a,
        concept_b=concept_b,
        relationship_type="semantic",
        strength=strength
    )
    return {"edge_id": edge_id, "status": "created"}

@router.get("/api/v1/memory/associations/{concept}")
async def get_associations(
    concept: str,
    depth: int = 3,
    threshold: float = 0.3,
    current_user: User = Depends(get_current_user)
):
    """é€£æƒ³æ¤œç´¢."""
    results = associative_memory.retrieve_associated_concepts(
        trigger=concept,
        depth=depth,
        threshold=threshold
    )
    return {"concept": concept, "associations": results, "count": len(results)}
```

#### 4.1.4 ãƒ†ã‚¹ãƒˆï¼ˆ20ä»¶ï¼‰

```python
# tests/test_associative_memory.py

def test_add_concept():
    """æ¦‚å¿µè¿½åŠ ãƒ†ã‚¹ãƒˆ."""
    memory = AssociativeMemory(":memory:")
    concept_id = memory.add_concept("Python", [0.1, 0.2], {"category": "programming"})
    assert concept_id is not None

def test_link_concepts():
    """é–¢é€£ä»˜ã‘ãƒ†ã‚¹ãƒˆ."""
    memory = AssociativeMemory(":memory:")
    memory.add_concept("Python", [0.1], {})
    memory.add_concept("AI", [0.2], {})
    edge_id = memory.link_concepts("Python", "AI", "used_for", 0.9)
    assert edge_id is not None

def test_retrieve_associated_concepts():
    """é€£æƒ³æ¤œç´¢ãƒ†ã‚¹ãƒˆ."""
    memory = AssociativeMemory(":memory:")
    memory.add_concept("Python", [0.1], {})
    memory.add_concept("AI", [0.2], {})
    memory.link_concepts("Python", "AI", "used_for", 0.9)
    results = memory.retrieve_associated_concepts("Python", depth=2, threshold=0.5)
    assert len(results) > 0
    assert any(r['name'] == 'AI' for r in results)

def test_strengthen_association():
    """é–¢é€£æ€§å¼·åŒ–ãƒ†ã‚¹ãƒˆï¼ˆãƒ˜ãƒƒãƒ–ã®æ³•å‰‡ï¼‰."""
    memory = AssociativeMemory(":memory:")
    memory.add_concept("A", [0.1], {})
    memory.add_concept("B", [0.2], {})
    memory.link_concepts("A", "B", "related", 0.5)
    memory.strengthen_association("A", "B", delta=0.2)
    # å¼·åº¦ãŒ0.7ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

def test_decay_inactive_associations():
    """å¿˜å´å‡¦ç†ãƒ†ã‚¹ãƒˆ."""
    memory = AssociativeMemory(":memory:")
    memory.add_concept("Old", [0.1], {})
    memory.add_concept("Forgotten", [0.2], {})
    memory.link_concepts("Old", "Forgotten", "weak", 0.2)
    decayed = memory.decay_inactive_associations(days_threshold=1, decay_rate=0.3)
    assert decayed >= 0

# ... ä»–15ä»¶ï¼ˆã‚°ãƒ©ãƒ•æ¢ç´¢ã€æœ€çŸ­ãƒ‘ã‚¹ã€æ„Ÿæƒ…è¨˜æ†¶ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ç­‰ï¼‰
```

### 4.2 Week 7-8: æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«åŸºç›¤

#### 4.2.1 å®Ÿè£…å†…å®¹

**å‚ç…§**: `docks/ä»•æ§˜æ›¸/04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md`

**ä¸»è¦æ©Ÿèƒ½**:
1. **8åŸºæœ¬æ„Ÿæƒ…ç®¡ç†**ï¼ˆPlutchikã®æ„Ÿæƒ…ã®è¼ªï¼‰
   - å–œã³ã€ä¿¡é ¼ã€æã‚Œã€é©šãã€æ‚²ã—ã¿ã€å«Œæ‚ªã€æ€’ã‚Šã€æœŸå¾…

2. **æ„Ÿæƒ…ã®è‡ªç„¶ãªæ¸›è¡°**
   - ãƒ›ãƒ¡ã‚ªã‚¹ã‚¿ã‚·ã‚¹ï¼ˆä¸­ç«‹å€¤0.5ã¸ï¼‰
   - æ™‚é–“çµŒéã«ã‚ˆã‚‹è‡ªå‹•æ¸›è¡°

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ„Ÿæƒ…åˆ†æ**
   - sentiment analysisçµ±åˆ
   - å…±æ„Ÿçš„å¿œç­”ï¼ˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ï¼‰

#### 4.2.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```python
# core/emotion.py (300è¡Œ)
from typing import Dict, List
import time
from textblob import TextBlob

class EmotionalState:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ„Ÿæƒ…çŠ¶æ…‹ç®¡ç†."""
    
    EMOTIONS = ['joy', 'trust', 'fear', 'surprise', 'sadness', 'disgust', 'anger', 'anticipation']
    
    def __init__(self, character_name: str):
        self.character_name = character_name
        # å…¨æ„Ÿæƒ…ã‚’ä¸­ç«‹å€¤0.5ã§åˆæœŸåŒ–
        self.emotions: Dict[str, float] = {e: 0.5 for e in self.EMOTIONS}
        self.mood_history: List[Dict] = []
    
    def update_from_conversation(
        self,
        user_input: str,
        context: Dict
    ) -> None:
        """ä¼šè©±ã‹ã‚‰æ„Ÿæƒ…æ›´æ–°."""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ„Ÿæƒ…åˆ†æ
        user_sentiment = self._analyze_sentiment(user_input)
        
        # å…±æ„Ÿçš„å¿œç­”ï¼ˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ï¼‰
        if user_sentiment > 0.5:
            self.emotions['joy'] = min(self.emotions['joy'] + 0.1, 1.0)
            self.emotions['trust'] = min(self.emotions['trust'] + 0.05, 1.0)
        elif user_sentiment < -0.5:
            self.emotions['sadness'] = min(self.emotions['sadness'] + 0.1, 1.0)
        
        # å±¥æ­´è¨˜éŒ²
        self.mood_history.append({
            'timestamp': time.time(),
            'emotions': self.emotions.copy(),
            'dominant': self.get_dominant_emotion()
        })
        
        # è‡ªå‹•æ¸›è¡°
        self._decay_emotions(rate=0.05)
    
    def _analyze_sentiment(self, text: str) -> float:
        """ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆåˆ†æï¼ˆ-1.0 ~ 1.0ï¼‰."""
        blob = TextBlob(text)
        return blob.sentiment.polarity
    
    def _decay_emotions(self, rate: float = 0.05) -> None:
        """æ„Ÿæƒ…æ¸›è¡°ï¼ˆãƒ›ãƒ¡ã‚ªã‚¹ã‚¿ã‚·ã‚¹ï¼‰."""
        for emotion in self.emotions:
            if self.emotions[emotion] > 0.5:
                self.emotions[emotion] = max(self.emotions[emotion] - rate, 0.5)
            elif self.emotions[emotion] < 0.5:
                self.emotions[emotion] = min(self.emotions[emotion] + rate, 0.5)
    
    def get_dominant_emotion(self) -> str:
        """æ”¯é…çš„æ„Ÿæƒ…å–å¾—."""
        return max(self.emotions, key=self.emotions.get)
    
    def generate_emotional_modifier(self) -> str:
        """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿®é£¾å­ç”Ÿæˆ."""
        dominant = self.get_dominant_emotion()
        intensity = self.emotions[dominant] - 0.5  # 0.0 ~ 0.5
        
        if intensity > 0.3:
            return f"ï¼ˆç¾åœ¨ã€{dominant}ã®æ„Ÿæƒ…ãŒå¼·ã„çŠ¶æ…‹ã§ã™ï¼‰"
        elif intensity > 0.1:
            return f"ï¼ˆã‚„ã‚„{dominant}ãªæ°—æŒã¡ã§ã™ï¼‰"
        else:
            return ""
    
    def analyze_mood_trend(self, hours: int = 24) -> Dict[str, str]:
        """æ„Ÿæƒ…ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ."""
        cutoff = time.time() - (hours * 3600)
        recent_moods = [m for m in self.mood_history if m['timestamp'] > cutoff]
        
        if not recent_moods:
            return {"trend": "neutral", "description": "ãƒ‡ãƒ¼ã‚¿ä¸è¶³"}
        
        # æœ€é »æ„Ÿæƒ…
        dominant_emotions = [m['dominant'] for m in recent_moods]
        most_common = max(set(dominant_emotions), key=dominant_emotions.count)
        
        return {
            "trend": most_common,
            "description": f"éå»{hours}æ™‚é–“ã€{most_common}ãŒå„ªå‹¢",
            "sample_count": len(recent_moods)
        }
```

#### 4.2.3 APIè¿½åŠ 

```python
# api/routes/chat.py ã«è¿½åŠ 

from core.emotion import EmotionalState

# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã”ã¨ã®æ„Ÿæƒ…çŠ¶æ…‹
character_emotions = {
    "lumina": EmotionalState("lumina"),
    "clarisse": EmotionalState("clarisse"),
    "nox": EmotionalState("nox")
}

@router.get("/api/v1/character/{name}/emotion")
async def get_character_emotion(
    name: str,
    current_user: User = Depends(get_current_user)
):
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ„Ÿæƒ…çŠ¶æ…‹å–å¾—."""
    if name not in character_emotions:
        raise HTTPException(status_code=404, detail="Character not found")
    
    emotion_state = character_emotions[name]
    return {
        "character": name,
        "emotions": emotion_state.emotions,
        "dominant": emotion_state.get_dominant_emotion(),
        "mood_trend": emotion_state.analyze_mood_trend(hours=24),
        "modifier": emotion_state.generate_emotional_modifier()
    }
```

#### 4.2.4 ãƒ†ã‚¹ãƒˆï¼ˆ15ä»¶ï¼‰

```python
# tests/test_emotion.py

def test_emotional_state_init():
    """åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ."""
    state = EmotionalState("lumina")
    assert all(v == 0.5 for v in state.emotions.values())

def test_update_from_conversation():
    """æ„Ÿæƒ…æ›´æ–°ãƒ†ã‚¹ãƒˆ."""
    state = EmotionalState("lumina")
    state.update_from_conversation("ç´ æ™´ã‚‰ã—ã„ï¼", {})
    assert state.emotions['joy'] > 0.5

def test_decay_emotions():
    """æ¸›è¡°ãƒ†ã‚¹ãƒˆ."""
    state = EmotionalState("lumina")
    state.emotions['joy'] = 1.0
    state._decay_emotions(rate=0.1)
    assert state.emotions['joy'] < 1.0

def test_get_dominant_emotion():
    """æ”¯é…çš„æ„Ÿæƒ…ãƒ†ã‚¹ãƒˆ."""
    state = EmotionalState("lumina")
    state.emotions['anger'] = 0.9
    assert state.get_dominant_emotion() == 'anger'

def test_sentiment_analysis():
    """ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆåˆ†æãƒ†ã‚¹ãƒˆ."""
    state = EmotionalState("lumina")
    pos_score = state._analyze_sentiment("I love this!")
    neg_score = state._analyze_sentiment("I hate this!")
    assert pos_score > 0
    assert neg_score < 0

# ... ä»–10ä»¶ï¼ˆå±¥æ­´è¨˜éŒ²ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€ä¿®é£¾å­ç”Ÿæˆç­‰ï¼‰
```

---

## 5. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 5.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ç”¨é€” |
|---------|------|------|
| **Framework** | React 18 + TypeScript | UIæ§‹ç¯‰ |
| **Build Tool** | Vite 5 | é«˜é€Ÿãƒ“ãƒ«ãƒ‰ |
| **Stateç®¡ç†** | Redux Toolkit | ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ |
| **HTTP Client** | Axios | REST APIé€šä¿¡ |
| **WebSocket** | socket.io-client | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ |
| **UI Library** | Tailwind CSS | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| **Chart** | Recharts | è¨˜æ†¶çµ±è¨ˆå¯è¦–åŒ– |
| **Testing** | Cypress + Vitest | E2E + Unit |

### 5.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPart Bè¿½åŠ ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ç”¨é€” |
|---------|------|------|
| **Graph DB** | SQLiteï¼ˆå†å¸°CTEï¼‰ | é€£æƒ³è¨˜æ†¶ |
| **NLP** | TextBlob | æ„Ÿæƒ…åˆ†æ |

---

## 6. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 6.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React SPA (Port 3000)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ LoginPage  â”‚  â”‚ ChatPage   â”‚  â”‚ Dashboard  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚        â”‚               â”‚               â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         Redux Store                          â”‚        â”‚
â”‚  â”‚  - authSlice (èªè¨¼çŠ¶æ…‹)                      â”‚        â”‚
â”‚  â”‚  - chatSlice (ä¼šè©±å±¥æ­´)                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚        â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Services                           â”‚                 â”‚
â”‚  â”‚  - api.ts (Axios + JWT Interceptor)â”‚                 â”‚
â”‚  â”‚  - websocket.service.ts             â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ REST: POST /api/v1/auth/login
         â”œâ”€ REST: GET /api/v1/chat/history
         â””â”€ WebSocket: /ws/chat
```

### 6.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ‹¡å¼µæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               FastAPI Backend (Port 8000)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 3 REST/WebSocket API                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 1-3çµ±åˆã‚µãƒ¼ãƒ“ã‚¹                         â”‚    â”‚
â”‚  â”‚  - ChatService                                 â”‚    â”‚
â”‚  â”‚  - MemoryService                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 4æ‹¡å¼µï¼ˆPart Bï¼‰                         â”‚    â”‚
â”‚  â”‚  - AssociativeMemory (SQLite Graph)            â”‚    â”‚
â”‚  â”‚  - EmotionalState (8æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«)                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 1 LangGraph Core                        â”‚    â”‚
â”‚  â”‚  - MultiLLMChat                                â”‚    â”‚
â”‚  â”‚  - MemoryManager (5éšå±¤)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 7.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆPart Aï¼‰

| ã‚«ãƒ†ã‚´ãƒª | ãƒ„ãƒ¼ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | å†…å®¹ |
|---------|--------|---------|------|
| **Unit** | Vitest | 50ä»¶ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»Service |
| **E2E** | Cypress | 20ä»¶ | èªè¨¼ãƒ»ä¼šè©±ãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |

```typescript
// cypress/e2e/auth.cy.ts
describe('èªè¨¼ãƒ•ãƒ­ãƒ¼', () => {
  it('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', () => { /* ... */ });
  it('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ', () => { /* ... */ });
});

// cypress/e2e/chat.cy.ts
describe('ä¼šè©±ãƒ•ãƒ­ãƒ¼', () => {
  it('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡', () => { /* ... */ });
  it('WebSocketã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°', () => { /* ... */ });
});
```

### 7.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPart Bï¼‰

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | å†…å®¹ |
|---------|---------|------|
| **é€£æƒ³è¨˜æ†¶** | 20ä»¶ | æ¦‚å¿µè¿½åŠ ã€ãƒªãƒ³ã‚¯ã€æ¤œç´¢ã€å¼·åŒ–ã€å¿˜å´ |
| **æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«** | 15ä»¶ | åˆæœŸåŒ–ã€æ›´æ–°ã€æ¸›è¡°ã€åˆ†æ |

---

## 8. ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### 8.1 Docker Composeæ§‹æˆ

```yaml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports: ["3000:80"]
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on: [backend]

  backend:
    build: .
    ports: ["8000:8000"]
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/llm
      - REDIS_URL=redis://redis:6379
    depends_on: [db, redis]
    volumes:
      - ./memory:/app/memory  # é€£æƒ³è¨˜æ†¶DBæ°¸ç¶šåŒ–

  db:
    image: postgres:15
    volumes: [postgres_data:/var/lib/postgresql/data]

  redis:
    image: redis:7-alpine
    volumes: [redis_data:/data]

volumes:
  postgres_data:
  redis_data:
```

### 8.2 ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
cd frontend && npm run build

# 2. Docker Composeèµ·å‹•
docker-compose up -d

# 3. åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
docker-compose exec backend python -m scripts.init_db

# 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/health
curl http://localhost:3000
```

---

## Phase 4 æˆæœç‰©ã¾ã¨ã‚

### Part A: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆWeek 1-4ï¼‰

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰**:
- React SPA: ç´„3,000è¡Œï¼ˆTypeScriptï¼‰
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: 30å€‹
- ãƒšãƒ¼ã‚¸: 15ç”»é¢

**ãƒ†ã‚¹ãƒˆ**:
- Unit: 50ä»¶
- E2E: 20ä»¶

### Part B: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é«˜åº¦æ©Ÿèƒ½ï¼ˆWeek 5-8ï¼‰

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰**:
- é€£æƒ³è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ : 400è¡Œï¼ˆPythonï¼‰
- æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«: 300è¡Œï¼ˆPythonï¼‰
- **åˆè¨ˆ**: 700è¡Œ

**ãƒ†ã‚¹ãƒˆ**:
- é€£æƒ³è¨˜æ†¶: 20ä»¶
- æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«: 15ä»¶
- **åˆè¨ˆ**: 35ä»¶

### ç·è¨ˆ

- **ã‚³ãƒ¼ãƒ‰**: 3,700è¡Œï¼ˆTS 3,000 + Py 700ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: 105ä»¶ï¼ˆFE 70 + BE 35ï¼‰
- **æœŸé–“**: 8é€±é–“

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Phase 5ä»¥é™

Phase 4å®Œäº†å¾Œã®å±•æœ›:

- **Phase 5**: å¯¾è©±ã‚¹ã‚¿ã‚¤ãƒ«é©å¿œãƒ»è‡ªå·±çœå¯Ÿï¼ˆ4é€±é–“ï¼‰
- **Phase 6**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ãƒ»MCPå¯¾å¿œï¼ˆ4é€±é–“ï¼‰
- **Phase 7**: 3Då¯è¦–åŒ–ãƒ»è‡ªå¾‹ã‚µãƒ¼ãƒï¼ˆ4é€±é–“ï¼‰
- **Phase 8**: LoRAãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆ3é€±é–“ï¼‰

**å‚ç…§**: `docks/å®Ÿè£…ä»•æ§˜/Phase4-8_å®Ÿè£…è¨ˆç”».md`