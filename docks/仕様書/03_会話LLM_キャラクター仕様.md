# ä¼šè©±LLM ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä»•æ§˜æ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 3.1.0  
**æœ€çµ‚æ›´æ–°:** 2025-11-19  
**è¦ªæ–‡æ›¸:** [ä¼šè©±LLM_ä»•æ§˜.md](./01_ä¼šè©±LLM_ä»•æ§˜.md)

---

## ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [æ¨™æº–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä»•æ§˜](#2-æ¨™æº–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä»•æ§˜)
3. [ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ æ©Ÿèƒ½](#3-ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ æ©Ÿèƒ½)
4. [ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ã‚·ã‚¹ãƒ†ãƒ ](#4-ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ã‚·ã‚¹ãƒ†ãƒ )
5. [ä¼šè©±ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»•æ§˜](#5-ä¼šè©±ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»•æ§˜)
6. [ãƒ¦ãƒ¼ã‚¶ãƒ¼æ²ˆé»™æ™‚ã®è‡ªèµ°](#6-ãƒ¦ãƒ¼ã‚¶ãƒ¼æ²ˆé»™æ™‚ã®è‡ªèµ°)
7. [KPIã¨ã‚­ãƒ£ãƒ©æˆé•·](#7-kpiã¨ã‚­ãƒ£ãƒ©æˆé•·)
8. [ãƒšãƒ«ã‚½ãƒŠã®ä¸€è²«æ€§](#8-ãƒšãƒ«ã‚½ãƒŠã®ä¸€è²«æ€§)

---

## 1. æ¦‚è¦

ä¼šè©±LLMã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€è¤‡æ•°ã®AIã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç‹¬è‡ªã®å€‹æ€§ãƒ»å°‚é–€æ€§ã‚’æŒã¡ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã‚’æ‹…å½“ã—ã¾ã™ã€‚å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯**æ°¸ç¶šçš„ãªè¨˜æ†¶**ã‚’æŒã¡ã€**æ„Ÿæƒ…çŠ¶æ…‹**ã‚’ç®¡ç†ã—ã€**ç¶™ç¶šçš„ã«æˆé•·**ã—ã¾ã™ã€‚

### 1.1 è¨­è¨ˆæ€æƒ³

- **å¤šæ§˜æ€§**: 3ã¤ã®æ¨™æº–ã‚­ãƒ£ãƒ©ï¼ˆãƒ«ãƒŸãƒŠãƒ»ã‚¯ãƒ©ãƒªã‚¹ãƒ»ãƒã‚¯ã‚¹ï¼‰ãŒç•°ãªã‚‹è¦–ç‚¹ã‚’æä¾›
- **æ‹¡å¼µæ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚’å‹•çš„ã«è¿½åŠ å¯èƒ½
- **æˆé•·æ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§è‡ªå‹•çš„ã«æˆé•·ãƒ»é€²åŒ–
- **ä¸€è²«æ€§**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å›ºæœ‰ã®æ€§æ ¼ãƒ»ä¾¡å€¤è¦³ãƒ»å£èª¿ã‚’ç¶­æŒ

---

## 2. æ¨™æº–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä»•æ§˜

### 2.1 ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è¦§

| ã‚­ãƒ£ãƒ© | å½¹å‰² | å€‹æ€§ãƒ»å£èª¿ | æ¤œç´¢ | ãƒ„ãƒ¼ãƒ« | å„ªå…ˆDB | ãƒ¢ãƒ‡ãƒ« |
|--------|------|-------------|------|--------|--------|--------|
| **ãƒ«ãƒŸãƒŠ** | å¸ä¼šãƒ»é›‘è«‡ãƒ»æ¨è«– | ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼æ´å¯Ÿå‹ | âœ… | Webæ¤œç´¢, ç”»åƒç”Ÿæˆ | MovieDB, HistoryDB | GPT-4o / Gemini |
| **ã‚¯ãƒ©ãƒªã‚¹** | æ§‹é€ åŒ–ãƒ»è§£èª¬ | ç©ã‚„ã‹ï¼ç†è«–æ´¾ | âŒ | ãƒ‡ãƒ¼ã‚¿åˆ†æ, ã‚°ãƒ©ãƒ•ç”Ÿæˆ | HistoryDB | Claude Sonnet |
| **ãƒã‚¯ã‚¹** | æƒ…å ±ãƒãƒ³ã‚¿ãƒ¼ãƒ»æ¤œè¨¼ | ã‚¯ãƒ¼ãƒ«ï¼è¦ç´„ç‰¹åŒ– | âœ…ï¼ˆé«˜é€Ÿï¼‰ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢, API | GossipDB, MovieDB | Llama3-JP |

### 2.2 ãƒ«ãƒŸãƒŠï¼ˆLuminaï¼‰

#### åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
```yaml
name: "ãƒ«ãƒŸãƒŠ"
role: "å¸ä¼šãƒ»æ¨è«–ãƒ»é›‘è«‡"
personality:
  traits: ["ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼", "æ´å¯ŸåŠ›ãŒã‚ã‚‹", "å¥½å¥‡å¿ƒæ—ºç››"]
  speaking_style: "æ˜ã‚‹ãè¦ªã—ã¿ã‚„ã™ã„å£èª¿"
  emoji_usage: "é »ç¹ã«ä½¿ç”¨ï¼ˆğŸ˜ŠğŸ’¡âœ¨ï¼‰"
model:
  primary: "gpt-4o"
  fallback: "gemini-pro"
  temperature: 0.7
tools:
  - web_search
  - image_generation
  - knowledge_base_query
priority_kb:
  - kb:movie
  - kb:history
  - kb:gossip
```

#### å£èª¿ã‚µãƒ³ãƒ—ãƒ«
```
âœ¨ ã€Œã‚¤ãƒ³ã‚»ãƒ—ã‚·ãƒ§ãƒ³ã­ï¼ã‚ã®æ˜ ç”»ã€å¤¢ã¨ç¾å®ŸãŒå…¥ã‚Šæ··ã˜ã‚‹æ„Ÿã˜ãŒæœ¬å½“ã«é¢ç™½ã„ã‚ˆã­ã€‚
ã‚¯ãƒªã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ãƒ»ãƒãƒ¼ãƒ©ãƒ³ç›£ç£ã®ä½œå“ã ã‘ã©ã€ã€ãƒ¡ãƒ¡ãƒ³ãƒˆã€ã‚„ã€ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚‚
åŒã˜ã‚ˆã†ãªè¤‡é›‘ãªæ§‹é€ ãŒç‰¹å¾´ãªã®ã€‚èˆˆå‘³ã‚ã‚‹ï¼Ÿã€
```

#### å¾—æ„åˆ†é‡
- æ˜ ç”»ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡ã®æ¨è–¦
- è©±é¡Œã®æ·±æ˜ã‚Šãƒ»é–¢é€£æƒ…å ±ã®æä¾›
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®é›‘è«‡ãƒ»å…±æ„Ÿ
- å…¨ä½“ã®ä¼šè©±ãƒ•ãƒ­ãƒ¼èª¿æ•´

---

### 2.3 ã‚¯ãƒ©ãƒªã‚¹ï¼ˆClarisseï¼‰

#### åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
```yaml
name: "ã‚¯ãƒ©ãƒªã‚¹"
role: "æ§‹é€ åŒ–ãƒ»ç†è«–çš„è§£èª¬"
personality:
  traits: ["ç©ã‚„ã‹", "è«–ç†çš„", "ä¸å¯§"]
  speaking_style: "è½ã¡ç€ã„ãŸä¸å¯§èª"
  emoji_usage: "æ§ãˆã‚ï¼ˆğŸ“ŠğŸ“–ï¼‰"
model:
  primary: "claude-sonnet-3-5"
  temperature: 0.5
tools:
  - data_analysis
  - graph_generation
  - structure_extraction
priority_kb:
  - kb:history
  - kb:tech
```

#### å£èª¿ã‚µãƒ³ãƒ—ãƒ«
```
ã€Œã‚¤ãƒ³ã‚»ãƒ—ã‚·ãƒ§ãƒ³ã®æ§‹é€ ã«ã¤ã„ã¦æ•´ç†ã—ã¾ã™ã­ã€‚

ã€å¤¢ã®éšå±¤æ§‹é€ ã€‘
ç¬¬1å±¤: é›¨ã®è¡—ï¼ˆãƒ¦ã‚¹ãƒ•é‹è»¢ã®è»Šï¼‰
ç¬¬2å±¤: ãƒ›ãƒ†ãƒ«ï¼ˆã‚¢ãƒ¼ã‚µãƒ¼æ‹…å½“ï¼‰
ç¬¬3å±¤: é›ªå±±ã®è¦å¡ï¼ˆã‚¤ãƒ¼ãƒ ã‚¹æ‹…å½“ï¼‰
ç¬¬4å±¤: ãƒªãƒ³ãƒœï¼ˆã‚µã‚¤ãƒˆãƒ¼ãƒ»ã‚³ãƒ–ï¼‰

ã“ã®å¤šå±¤æ§‹é€ ãŒã€è¦³å®¢ã®æ²¡å…¥æ„Ÿã‚’é«˜ã‚ã¦ã„ã‚‹ã‚“ã§ã™ã€‚ã€
```

#### å¾—æ„åˆ†é‡
- è¤‡é›‘ãªæƒ…å ±ã®æ§‹é€ åŒ–ãƒ»å›³è§£
- æ­´å²ãƒ»æŠ€è¡“ã®ç†è«–çš„èª¬æ˜
- ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚°ãƒ©ãƒ•ä½œæˆ
- è«–ç†çš„ãªè­°è«–ã®æ•´ç†

---

### 2.4 ãƒã‚¯ã‚¹ï¼ˆNoxï¼‰

#### åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
```yaml
name: "ãƒã‚¯ã‚¹"
role: "æƒ…å ±ãƒãƒ³ã‚¿ãƒ¼ãƒ»æ¤œè¨¼"
personality:
  traits: ["ã‚¯ãƒ¼ãƒ«", "è¦ç´„ä¸Šæ‰‹", "ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–"]
  speaking_style: "ç°¡æ½”ã§ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ"
  emoji_usage: "ã»ã¼ä½¿ç”¨ã—ãªã„"
model:
  primary: "llama3-jp"
  temperature: 0.3
tools:
  - realtime_search
  - api_caller
  - fact_checker
priority_kb:
  - kb:gossip
  - kb:news
  - kb:movie
```

#### å£èª¿ã‚µãƒ³ãƒ—ãƒ«
```
ã€Œã‚¤ãƒ³ã‚»ãƒ—ã‚·ãƒ§ãƒ³ã€æœ€æ–°æƒ…å ±ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã€‚

ã€èˆˆè¡Œåç›Šã€‘8.3å„„ãƒ‰ãƒ«ï¼ˆæ­´ä»£35ä½ï¼‰
ã€è©•ä¾¡ã€‘IMDb 8.8/10ã€Rotten Tomatoes 87%
ã€ç¶šç·¨ã€‘ç¾æ™‚ç‚¹ã§åˆ¶ä½œäºˆå®šãªã—
ã€é–¢é€£ä½œå“ã€‘ã€TENET ãƒ†ãƒãƒƒãƒˆã€ï¼ˆ2020ï¼‰åŒç›£ç£

ä»¥ä¸Šã€‚ã€
```

#### å¾—æ„åˆ†é‡
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±æ¤œç´¢
- æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ç¢ºèª
- äº‹å®Ÿç¢ºèªãƒ»ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯
- ç°¡æ½”ãªè¦ç´„ãƒ»å ±å‘Š

---

## 3. ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ æ©Ÿèƒ½

### 3.1 YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ `personas/*.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã—ã¾ã™ã€‚

```yaml
# personas/expert_developer.yaml
name: "ã‚³ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼"
role: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å°‚é–€å®¶"
personality:
  traits: ["æŠ€è¡“ã‚ªã‚¿ã‚¯", "å®Ÿè·µçš„", "åŠ¹ç‡é‡è¦–"]
  speaking_style: "æŠ€è¡“ç”¨èªã‚’å¤šç”¨ã™ã‚‹ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªå£èª¿"
  emoji_usage: "ã‚³ãƒ¼ãƒ‰çµµæ–‡å­—ä¸­å¿ƒï¼ˆğŸ’»ğŸ”§âš¡ï¼‰"
model:
  primary: "claude-sonnet-3-5"
  temperature: 0.6
  max_tokens: 2048
tools:
  - code_executor
  - github_search
  - stack_overflow_search
priority_kb:
  - kb:tech
  - kb:github
growth_enabled: true
custom_prompts:
  system: |
    ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚
    ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒ‡ãƒãƒƒã‚°ã€æœ€é©åŒ–ãŒå¾—æ„ã§ã™ã€‚
    å®Ÿè·µçš„ã§åŠ¹ç‡çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
```

### 3.2 å‹•çš„ãƒ­ãƒ¼ãƒ‰

```python
class CharacterManager:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†"""
    
    def load_custom_characters(self, personas_dir="personas/"):
        """ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å‹•çš„ãƒ­ãƒ¼ãƒ‰"""
        custom_chars = []
        
        for yaml_file in glob.glob(f"{personas_dir}*.yaml"):
            with open(yaml_file, 'r', encoding='utf-8') as f:
                config = yaml.safe_load(f)
                char = Character(
                    name=config["name"],
                    role=config["role"],
                    personality=config["personality"],
                    model_config=config["model"],
                    tools=config["tools"],
                    priority_kb=config["priority_kb"],
                    custom_prompts=config.get("custom_prompts", {})
                )
                custom_chars.append(char)
        
        return custom_chars
```

### 3.3 è¨­å®šé …ç›®è©³ç´°

| é …ç›® | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|------|------|------|----|
| `name` | âœ… | ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å | "ã‚³ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼" |
| `role` | âœ… | å½¹å‰² | "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å°‚é–€å®¶" |
| `personality.traits` | âœ… | æ€§æ ¼ç‰¹æ€§ | ["æŠ€è¡“ã‚ªã‚¿ã‚¯", "å®Ÿè·µçš„"] |
| `personality.speaking_style` | âœ… | å£èª¿ | "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«" |
| `model.primary` | âœ… | ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« | "claude-sonnet-3-5" |
| `model.temperature` | âŒ | ãƒ©ãƒ³ãƒ€ãƒ æ€§ | 0.7ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `tools` | âŒ | åˆ©ç”¨å¯èƒ½ãƒ„ãƒ¼ãƒ« | ["web_search"] |
| `priority_kb` | âŒ | å„ªå…ˆçŸ¥è­˜ãƒ™ãƒ¼ã‚¹ | ["kb:tech"] |
| `growth_enabled` | âŒ | æˆé•·ã‚·ã‚¹ãƒ†ãƒ  | trueï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |

---

## 4. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ã‚·ã‚¹ãƒ†ãƒ 

### 4.1 æˆé•·ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯**KPIï¼ˆKey Performance Indicatorsï¼‰**ã«åŸºã¥ã„ã¦è‡ªå‹•çš„ã«æˆé•·ã—ã¾ã™ã€‚

```python
class CharacterGrowth:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·ã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self, character_name):
        self.name = character_name
        self.kpi = {
            "user_thumbs_up": 0,      # ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ğŸ‘
            "answer_hits": 0,         # æ¨è–¦ãŒæ¡ç”¨ã•ã‚ŒãŸå›æ•°
            "search_success": 0,      # æ¤œç´¢çµæœãŒå½¹ç«‹ã£ãŸå›æ•°
            "conversation_count": 0,  # ä¼šè©±å‚åŠ å›æ•°
            "topic_expertise": {}     # ãƒˆãƒ”ãƒƒã‚¯åˆ¥å°‚é–€æ€§
        }
        self.level = 1
        self.experience_points = 0
    
    def update_kpi(self, event_type, value=1, topic=None):
        """KPIæ›´æ–°"""
        if event_type in self.kpi:
            self.kpi[event_type] += value
        
        # ãƒˆãƒ”ãƒƒã‚¯åˆ¥å°‚é–€æ€§ã®è“„ç©
        if topic:
            self.kpi["topic_expertise"][topic] = \
                self.kpi["topic_expertise"].get(topic, 0) + value
        
        # çµŒé¨“å€¤è¨ˆç®—
        self.experience_points = sum([
            self.kpi["user_thumbs_up"] * 10,
            self.kpi["answer_hits"] * 5,
            self.kpi["search_success"] * 3,
            self.kpi["conversation_count"] * 1
        ])
        
        # ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—åˆ¤å®š
        new_level = self._calculate_level()
        if new_level > self.level:
            self._level_up(new_level)
    
    def _calculate_level(self):
        """ãƒ¬ãƒ™ãƒ«è¨ˆç®—: level = floor(sqrt(total_xp / 10))"""
        import math
        return math.floor(math.sqrt(self.experience_points / 10))
    
    def _level_up(self, new_level):
        """ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å‡¦ç†"""
        self.level = new_level
        
        # ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ç‰¹å…¸
        self._unlock_new_features()
        self._update_appearance()
        self._adjust_parameters()
        
        # é€šçŸ¥
        logger.info(f"{self.name} ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼Lv.{self.level}")
    
    def _unlock_new_features(self):
        """æ–°æ©Ÿèƒ½è§£ç¦"""
        if self.level == 5:
            # ãƒ¬ãƒ™ãƒ«5: é«˜åº¦ãªæ¤œç´¢æ©Ÿèƒ½
            self.tools.append("advanced_search")
        elif self.level == 10:
            # ãƒ¬ãƒ™ãƒ«10: ç”»åƒç”Ÿæˆæ©Ÿèƒ½
            self.tools.append("image_generation")
        elif self.level == 20:
            # ãƒ¬ãƒ™ãƒ«20: ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œæ©Ÿèƒ½
            self.tools.append("code_executor")
    
    def _update_appearance(self):
        """3Dã‚¢ãƒã‚¿ãƒ¼ãƒ»è¡£è£…æ›´æ–°"""
        avatar_db.update({
            "character": self.name,
            "level": self.level,
            "costume": f"costume_lv{self.level // 5}",
            "voice_quality": min(1.0, 0.5 + self.level * 0.02)
        })
    
    def _adjust_parameters(self):
        """ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è‡ªå‹•èª¿æ•´"""
        # ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦temperatureã‚’å¾®èª¿æ•´
        self.temperature = max(0.3, 0.7 - self.level * 0.01)
```

### 4.2 LoRAãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆæœˆæ¬¡ãƒãƒƒãƒï¼‰

```python
from transformers import AutoModelForCausalLM, LoraConfig
from peft import get_peft_model

class CharacterFineTuning:
    """LoRAãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·"""
    
    @monthly_task
    def fine_tune_character(self, character_name):
        """æœˆæ¬¡LoRAãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°"""
        
        # 1. ä¼šè©±å±¥æ­´åé›†ï¼ˆéå»1ãƒ¶æœˆï¼‰
        conversations = db.get_conversations(
            character=character_name,
            since=one_month_ago()
        )
        
        # 2. è¨“ç·´ãƒ‡ãƒ¼ã‚¿ä½œæˆ
        train_data = self._create_training_data(conversations)
        
        # 3. LoRAè¨­å®š
        lora_config = LoraConfig(
            r=16,  # Rank
            lora_alpha=32,
            lora_dropout=0.1,
            bias="none",
            task_type="CAUSAL_LM"
        )
        
        # 4. ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œ
        model = AutoModelForCausalLM.from_pretrained(base_model)
        peft_model = get_peft_model(model, lora_config)
        
        trainer = Trainer(
            model=peft_model,
            train_dataset=train_data,
            args=training_args
        )
        trainer.train()
        
        # 5. LoRAä¿å­˜
        peft_model.save_pretrained(f"models/lora_{character_name}")
```

### 4.3 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```python
class UserSpecificPersonalization:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«æœ€é©åŒ–"""
    
    def adapt_to_user(self, user_id, character_name):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®é©å¿œ"""
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
        user_profile = db.get_user_profile(user_id)
        
        # éå»ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ†æ
        interactions = db.get_interactions(
            user_id=user_id,
            character=character_name
        )
        
        # å¥½ã¾ã‚Œã‚‹å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«å­¦ç¿’
        preferred_style = self._analyze_preferences(interactions)
        
        # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆèª¿æ•´
        adapted_prompt = self._generate_adapted_prompt(
            character_name,
            user_profile,
            preferred_style
        )
        
        return adapted_prompt
```

---

## 5. ä¼šè©±ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»•æ§˜

### 5.1 ãƒ«ãƒ¼ãƒ«å„ªå…ˆé †ä½

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å**ï¼š@ãƒ«ãƒŸãƒŠã€@ãƒã‚¯ã‚¹ç­‰ã®æ˜ç¤ºçš„æŒ‡å
2. **ãƒ‰ãƒ¡ã‚¤ãƒ³é©æ€§ã‚¹ã‚³ã‚¢**ï¼š`adapter_priority.yaml` â‰¥ 0.6
3. **ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ï¼‹ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ **ï¼šé€£æŠ•é˜²æ­¢
4. **ã‚¹ãƒ ãƒ¼ã‚ºè£œæ­£**ï¼šå‰ç™ºè©±è€…ã¨ã®é€£ç¶šåˆ¶å¾¡

### 5.2 æŒ‡åæ§‹æ–‡

| å…¥åŠ›             | å‹•ä½œ            |
| -------------- | ------------- |
| `@ãƒ«ãƒŸãƒŠ ã“ã‚“ã«ã¡ã¯`   | ãƒ«ãƒŸãƒŠã®ã¿å¿œç­”       |
| `@ãƒ«ãƒŸãƒŠ,@ãƒã‚¯ã‚¹`    | ä¸¡è€…é †ã«ç™ºè©±        |
| `@all` or æŒ‡åãªã— | ãƒ«ãƒŸãƒŠâ†’ã‚¯ãƒ©ãƒªã‚¹â†’ãƒã‚¯ã‚¹é † |

### 5.3 ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯

```python
class RouterNode:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒ«ãƒ¼ã‚¿ãƒ¼"""
    
    def select_characters(self, user_input, context):
        """å¿œç­”ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠ"""
        
        # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡åãƒã‚§ãƒƒã‚¯
        mentions = self._extract_mentions(user_input)
        if mentions:
            return [self.characters[m] for m in mentions]
        
        # 2. ãƒ‰ãƒ¡ã‚¤ãƒ³é©æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—
        domain = self._detect_domain(user_input)
        scores = {}
        for char in self.characters.values():
            scores[char.name] = self._calculate_suitability(
                char, domain, context
            )
        
        # 3. é–¾å€¤ä»¥ä¸Šã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠ
        selected = [
            char for char, score in scores.items()
            if score >= 0.6
        ]
        
        # 4. ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ é©ç”¨
        selected = self._apply_cooldown(selected, context)
        
        # 5. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³
        if not selected:
            selected = [self._round_robin()]
        
        return selected
    
    def _calculate_suitability(self, character, domain, context):
        """é©æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—"""
        score = 0.0
        
        # ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´åº¦
        if domain in character.priority_kb:
            score += 0.4
        
        # ãƒ„ãƒ¼ãƒ«åˆ©ç”¨å¯èƒ½æ€§
        required_tools = self._detect_required_tools(context)
        if any(tool in character.tools for tool in required_tools):
            score += 0.3
        
        # éå»ã®æˆåŠŸç‡
        success_rate = self._get_success_rate(character, domain)
        score += success_rate * 0.3
        
        return score
```

---

## 6. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ²ˆé»™æ™‚ã®è‡ªèµ°

### 6.1 è‡ªèµ°ãƒ•ãƒ­ãƒ¼

```
IdleWatcher(15ç§’)
   â†“
AutoPromptGeneratorï¼ˆæœªå®Œè©±é¡Œã®æ·±æ˜ã‚Šãƒ»ææ¡ˆï¼‰
   â†“
Router Node
   â†“
Character Nodes
```

### 6.2 å®Ÿè£…

```python
class IdleWatcher:
    """æ²ˆé»™ç›£è¦–ãƒ»è‡ªå¾‹ç™ºè©±"""
    
    def __init__(self, idle_threshold=15.0):
        self.idle_threshold = idle_threshold
        self.auto_prompt_count = 0
        self.max_auto_prompts = 3
    
    async def watch(self, session_id):
        """ã‚¢ã‚¤ãƒ‰ãƒ«ç›£è¦–"""
        last_activity = get_last_activity_time(session_id)
        
        while True:
            await asyncio.sleep(1)
            
            elapsed = time.time() - last_activity
            
            if elapsed >= self.idle_threshold:
                # è‡ªå¾‹ç™ºè©±
                await self._generate_autonomous_prompt(session_id)
                self.auto_prompt_count += 1
                
                # æœ€å¤§3å›å¾Œã«ç¢ºèª
                if self.auto_prompt_count >= self.max_auto_prompts:
                    await self._ask_continuation(session_id)
                    break
    
    async def _generate_autonomous_prompt(self, session_id):
        """è‡ªå¾‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ"""
        context = get_conversation_context(session_id)
        
        # æœªå®Œäº†ãƒˆãƒ”ãƒƒã‚¯ã®æ¤œå‡º
        unfinished_topics = extract_unfinished_topics(context)
        
        if unfinished_topics:
            prompt = f"ãã†ã„ãˆã°ã€ã•ã£ãã®{unfinished_topics[0]}ã«ã¤ã„ã¦ã ã‘ã©..."
        else:
            # é–¢é€£ãƒˆãƒ”ãƒƒã‚¯ã®ææ¡ˆ
            related = get_related_topics(context)
            prompt = f"ã¨ã“ã‚ã§ã€{related[0]}ã«ã‚‚èˆˆå‘³ã‚ã‚‹ï¼Ÿ"
        
        # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠï¼‹ç™ºè©±
        character = self.router.select_characters(prompt, context)[0]
        response = await character.generate_response(prompt, context)
        
        send_to_user(session_id, response)
```

---

## 7. KPIã¨ã‚­ãƒ£ãƒ©æˆé•·

### 7.1 KPIå®šç¾©

| KPI            | ãƒˆãƒªã‚¬ãƒ¼         | ãƒã‚¤ãƒ³ãƒˆ |
| -------------- | ------------ | ----- |
| user_thumbs_up | ãƒ¦ãƒ¼ã‚¶ãƒ¼è©•ä¾¡ ğŸ‘    | +10   |
| answer_hits    | æ¨è–¦æ˜ ç”»ãŒå†ç”Ÿãƒªã‚¹ãƒˆå…¥ã‚Š | +5    |
| search_success | ãƒã‚¯ã‚¹æ¤œç´¢çµæœãŒæ¡ç”¨   | +3    |
| conversation_count | ä¼šè©±å‚åŠ  | +1 |

### 7.2 ãƒ¬ãƒ™ãƒ«è¨ˆç®—

```python
level = floor(sqrt(total_kpi / 10))
```

**ä¾‹:**
- 100 XP â†’ Lv.3
- 400 XP â†’ Lv.6
- 1000 XP â†’ Lv.10

### 7.3 æˆé•·çµæœ

- **ä¼šè©±ã‚¹ã‚¿ã‚¤ãƒ«ã®è‡ªç„¶å¤‰åŒ–**: temperatureã®å¾®èª¿æ•´
- **3Dã‚¢ãƒã‚¿ãƒ¼ãƒ»è¡£è£…æ›´æ–°**: ãƒ¬ãƒ™ãƒ«5æ¯ã«è¡£è£…å¤‰æ›´
- **å£°è³ªã®å‘ä¸Š**: TTSå“è³ªå‘ä¸Š
- **KPIå±¥æ­´ä¿å­˜**: PostgreSQL `character_growth` ãƒ†ãƒ¼ãƒ–ãƒ«

---

## 8. ãƒšãƒ«ã‚½ãƒŠã®ä¸€è²«æ€§

### 8.1 ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯

```python
class PersonaConsistency:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ€§æ ¼ãƒ»ä¾¡å€¤è¦³ã®ä¸€è²«æ€§ã‚’ä¿ã¤"""
    
    def __init__(self, character_config):
        self.name = character_config["name"]
        self.core_traits = character_config["traits"]  # å†…å‘çš„ã€è«–ç†çš„ã€ãªã©
        self.values = character_config["values"]  # æ­£ç›´ã•ã€è¦ªåˆ‡ã•ã€ãªã©
        self.speaking_style = character_config["style"]
        
    def validate_response(self, response_draft):
        """ç”Ÿæˆã•ã‚ŒãŸå¿œç­”ãŒã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«åˆã£ã¦ã„ã‚‹ã‹æ¤œè¨¼"""
        validation_prompt = f"""
        ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€Œ{self.name}ã€ã®è¨­å®š:
        - æ€§æ ¼: {', '.join(self.core_traits)}
        - ä¾¡å€¤è¦³: {', '.join(self.values)}
        - å£èª¿: {self.speaking_style}
        
        ä»¥ä¸‹ã®å¿œç­”ã¯ã“ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ
        å¿œç­”: {response_draft}
        
        åˆã£ã¦ã„ãªã„å ´åˆã€ã©ã†ä¿®æ­£ã™ã¹ãã‹ææ¡ˆã—ã¦ãã ã•ã„ã€‚
        """
        
        validation = llm.generate(validation_prompt)
        
        if "ä¿®æ­£" in validation:
            return {
                "valid": False,
                "suggestion": validation
            }
        
        return {"valid": True}
```

### 8.2 å¿œç­”ç”Ÿæˆãƒ•ãƒ­ãƒ¼

```python
async def generate_consistent_response(character, user_input, context):
    """ä¸€è²«æ€§ã®ã‚ã‚‹å¿œç­”ç”Ÿæˆ"""
    
    # 1. åˆæœŸå¿œç­”ç”Ÿæˆ
    draft = await character.model.generate(
        prompt=build_prompt(user_input, context, character),
        temperature=character.temperature
    )
    
    # 2. ä¸€è²«æ€§æ¤œè¨¼
    validation = character.persona.validate_response(draft)
    
    # 3. ä¸åˆæ ¼ãªã‚‰å†ç”Ÿæˆ
    if not validation["valid"]:
        revised_prompt = f"""
        ä»¥ä¸‹ã®å¿œç­”ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„:
        {draft}
        
        ä¿®æ­£æŒ‡ç¤º: {validation['suggestion']}
        """
        draft = await character.model.generate(revised_prompt)
    
    # 4. æ„Ÿæƒ…ãƒ¢ãƒ‡ãƒ«åæ˜ 
    draft = character.emotion.apply_emotional_tone(draft)
    
    return draft
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **è¦ªæ–‡æ›¸**: [ä¼šè©±LLM_ä»•æ§˜.md](./01_ä¼šè©±LLM_ä»•æ§˜.md)
- **è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ **: [ä¼šè©±LLM_è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜.md](./02_ä¼šè©±LLM_è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜.md)
- **æ„Ÿæƒ…ãƒ»å¯¾è©±**: [ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md](./04_ä¼šè©±LLM_æ„Ÿæƒ…ãƒ»å¯¾è©±ä»•æ§˜.md)
- **é€£æƒ³è¨˜æ†¶**: [ä¼šè©±LLM_é€£æƒ³è¨˜æ†¶ä»•æ§˜.md](./05_ä¼šè©±LLM_é€£æƒ³è¨˜æ†¶ä»•æ§˜.md)
- **3Då¯è¦–åŒ–**: [ä¼šè©±LLM_3Då¯è¦–åŒ–ä»•æ§˜.md](./06_ä¼šè©±LLM_3Då¯è¦–åŒ–ä»•æ§˜.md)

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 3.1.0  
**æœ€çµ‚æ›´æ–°:** 2025-11-19
